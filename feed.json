{
    "version": "https://jsonfeed.org/version/1",
    "title": "沉鱼的博客",
    "subtitle": "了解自我，超越自我",
    "icon": "https://scottalive.github.io/images/favicon.ico",
    "description": "编程笔记 & 资料分享",
    "home_page_url": "https://scottalive.github.io",
    "items": [
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/100.Python%E9%9D%A2%E8%AF%95%E9%A2%98%E5%AE%9E%E5%BD%95/",
            "url": "https://scottalive.github.io/computer-science/python/basic/100.Python%E9%9D%A2%E8%AF%95%E9%A2%98%E5%AE%9E%E5%BD%95/",
            "title": "Python面试题实录",
            "date_published": "2025-04-24T07:07:49.000Z",
            "content_html": "<h2 id=\"python面试题实录\"><a class=\"anchor\" href=\"#python面试题实录\">#</a> Python 面试题实录</h2>\n<blockquote>\n<p><strong>温馨提示</strong>：请访问我的另一个项目<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9QeXRob24tSW50ZXJ2aWV3LUJpYmxl\"> “Python 面试宝典”</span>。</p>\n</blockquote>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/76.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-2/",
            "url": "https://scottalive.github.io/computer-science/python/basic/76.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-2/",
            "title": "数据可视化-2",
            "date_published": "2025-04-24T05:07:49.000Z",
            "content_html": "<h2 id=\"数据可视化-2\"><a class=\"anchor\" href=\"#数据可视化-2\">#</a> 数据可视化 - 2</h2>\n<p>通过前面的学习，我们已经对数据可视化工具 matplotlib 有一个初步的认知。大家可能也会发现了，matplotlib 提供的函数虽然强大，但是参数太多，要想对图表进行深度的定制就需要修改一系列的参数，这一点对新手并不友好。另一方面，使用 matplotlib 定制的统计图是静态图表，可能在某些需要交互效果的场景下并不合适。为了解决这两个问题，我们为大家介绍两个新的可视化工具，一个是 seaborn，一个是 pyecharts。</p>\n<h3 id=\"seaborn\"><a class=\"anchor\" href=\"#seaborn\">#</a> Seaborn</h3>\n<p>Seaborn 是建立在 matplotlib 之上的数据可视化工具，它相当于是对 matplotlib 进行了更高级的封装，而且 seaborn 也能跟 pandas 无缝整合，让我们可以用更少的代码构建出更好的统计图表，帮助我们探索和理解数据。Seaborn 包含但不局限于以下描述的功能：</p>\n<ol>\n<li>面向数据集的 API，可用于检查多个变量之间的关系。</li>\n<li>支持使用分类变量来显示观察结果或汇总统计数据。</li>\n<li>能够可视化单变量或双变量分布以及在数据子集之间进行比较的选项</li>\n<li>各类因变量线性回归模型的自动估计与作图。</li>\n<li>集成调色板和主题，轻松定制统计图表的视觉效果。</li>\n</ol>\n<p>可以使用 Python 的包管理工具 pip 来安装 seaborn。</p>\n<pre><code class=\"language-Bash\">pip install seaborn\n</code></pre>\n<p>在 Jupyter 中，可以直接使用魔法指令进行安装，如下所示。</p>\n<pre><code class=\"language-Bash\">%pip install seaborn\n</code></pre>\n<p>下面，我们用 seaborn 自带的数据集为例，为大家简单的展示 seaborn 的用法和强大之处，想要深入研究 seaborn 的读者可以自行阅读官方<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWFib3JuLnB5ZGF0YS5vcmcvdHV0b3JpYWwuaHRtbA==\">文档</span>和并查看官方作品集中的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWFib3JuLnB5ZGF0YS5vcmcvZXhhbXBsZXMvaW5kZXguaHRtbA==\">示例。</span>根据官方示例来编写自己的代码是一个不错的选择，简单的说就是保留官方代码，将数据换成自己的数据即可。下图展示了 seaborn 绘制图表的函数，可以看出，seaborn 的这些函数主要支持我们通过绘制图表来探索数据的关系、分布和分类。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTE1MDA1LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502115005.png</span>&quot; style=&quot;zoom:75%;&quot;&gt;</p>\n<p>使用 seaborn，首先需要导入该库并设置主题，代码如下所示。</p>\n<pre><code class=\"language-Python\">import seaborn as sns\n\nsns.set_theme()\n</code></pre>\n<p>如果需要在图表上显示中文，还需要用之前讲过的方法修改 matplotlib 的配置参数，代码如下所示。</p>\n<pre><code class=\"language-Python\">import matplotlib.pyplot as plt\n\nplt.rcParams['font.sans-serif'] = ['SimHei', ]\nplt.rcParams['axes.unicode_minus'] = False\n</code></pre>\n<blockquote>\n<p><strong>注意</strong>：上面的代码必须放在调用 set_theme 函数之后，否则调用 set_theme 函数时又会重新修改 matplotlib 配置参数中的字体设置。</p>\n</blockquote>\n<p>加载官方的 Tips 数据集（就餐小费数据）。</p>\n<pre><code class=\"language-Python\">tips_df = sns.load_dataset('tips')\ntips_df.info()\n</code></pre>\n<p>运行结果如下所示，其中 total_bill 表示账单总金额，tip 表示小费的金额，sex 是顾客的性别，smoker 表示顾客是否抽样，day 代表星期几，time 代表是午餐还是晚餐，size 是就餐人数。</p>\n<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;\nRangeIndex: 244 entries, 0 to 243\nData columns (total 7 columns):\n #   Column      Non-Null Count  Dtype   \n---  ------      --------------  -----   \n 0   total_bill  244 non-null    float64 \n 1   tip         244 non-null    float64 \n 2   sex         244 non-null    category\n 3   smoker      244 non-null    category\n 4   day         244 non-null    category\n 5   time        244 non-null    category\n 6   size        244 non-null    int64   \ndtypes: category(4), float64(2), int64(1)\nmemory usage: 7.4 KB\n</code></pre>\n<p>由于数据集是联网加载的，上述代码可能因为 SSL 的原因无法获取到数据，可以尝试先运行下面的代码，然后再加载数据集。</p>\n<pre><code class=\"language-Python\">import ssl\n\nssl._create_default_https_context = ssl._create_unverified_context\n</code></pre>\n<p>如果我们希望了解账单金额的分布，可以使用下面的代码来绘制分布图。</p>\n<pre><code class=\"language-Python\">sns.histplot(data=tips_df, x='total_bill', kde=True)\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTE1NTMxLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502115531.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果想了解变量之间的两两关系，我们可以绘制点对图，代码和效果如下所示。</p>\n<pre><code class=\"language-Python\">sns.pairplot(data=tips_df, hue='sex')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIwMjM2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502120236.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果对上面图表的颜色不满意，还可以通过 palette 参数选择 seaborn 自带的 “调色板” 来修改颜色，这种方式相比于自行指定颜色或使用随机颜色方便和靠谱了很多，下图为大家展示了部分 seaborn 自带的 “调色板”。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIwNzQ5LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502120749.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>我们可以将上面的代码稍作修改，看看运行结果有什么差别。</p>\n<pre><code class=\"language-Python\">sns.pairplot(data=tips_df, hue='sex', palette='Dark2')\n</code></pre>\n<p>接下来，我们为 total_bill 和 tip 两组数据绘制联合分布图，代码如下所示。</p>\n<pre><code class=\"language-Python\">sns.jointplot(data=tips_df, x='total_bill', y='tip', hue='sex')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIxMjI2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502121226.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>上面清晰的展示了，total_bill 和 tip 之间存在正相关关系，这一点我们也可以通过 DataFrame 对象的 corr 方法进行验证。接下来，我们可以建立回归模型来拟合这些数据点，而 seaborn 的线性回归模型图已经帮我们实现了这项功能，代码如下所示。</p>\n<pre><code class=\"language-Python\">sns.lmplot(data=tips_df, x='total_bill', y='tip', hue='sex')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIxNjU2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502121656.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果我们希望了解账单金额的集中和离散趋势，可以绘制箱线图或小提琴图，代码如下所示，我们将数据按星期四、星期五、星期六和星期天分别进行展示。</p>\n<pre><code class=\"language-Python\">sns.boxplot(data=tips_df, x='day', y='total_bill')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIyMTA2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502122106.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<pre><code class=\"language-Python\">sns.violinplot(data=tips_df, x='day', y='total_bill')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTIyMTQ0LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502122144.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<blockquote>\n<p><strong>说明</strong>：相较于箱线图，小提琴图没有标注异常点而是显示了数据的整个范围，另一方面，小提琴图很好的展示了数据的分布（密度轨迹）。</p>\n</blockquote>\n<h3 id=\"pyecharts\"><a class=\"anchor\" href=\"#pyecharts\">#</a> Pyecharts</h3>\n<p>Echarts 原来是百度开发的一个前端图表库，2018 年 1 月 16 日，ECharts 进入 Apache Incubator 进行孵化，目前已经是 Apache 软件基金会的顶级项目。凭借着良好的交互性和精巧的图表设计，ECharts 得到了众多开发者的认可，而 pyecharts 就是基于 Python 语言对 ECharts 进行了包装，让 Python 开发者也可以使用 ECharts 绘制外观精美且交互性强的统计图表。</p>\n<p>可以使用 Python 的包管理工具 pip 来安装 pyecharts。</p>\n<pre><code class=\"language-Bash\">pip install pyecharts\n</code></pre>\n<p>在 Jupyter 中，可以直接使用魔法指令进行安装，如下所示。</p>\n<pre><code class=\"language-Bash\">%pip install pyecharts\n</code></pre>\n<p>接下来，我们通过来自于 pyecharts 官方网站新手教程中的一个例子，来认识 pyecharts。当然，我们对官网的例子进行一些调整，代码如下所示。</p>\n<pre><code class=\"language-Python\">from pyecharts.charts import Bar\nfrom pyecharts import options\nfrom pyecharts.globals import ThemeType\n\n# 创建柱状图对象并设置初始参数（宽度、高度、主题）\nbar = Bar(init_opts=options.InitOpts(\n    width='600px',\n    height='450px',\n    theme=ThemeType.CHALK\n))\n# 设置横轴数据\nbar.add_xaxis([&quot;衬衫&quot;, &quot;羊毛衫&quot;, &quot;雪纺衫&quot;, &quot;裤子&quot;, &quot;高跟鞋&quot;, &quot;袜子&quot;])\n# 设置纵轴数据（第一组）\nbar.add_yaxis(\n    &quot;商家A&quot;,\n    [25, 20, 36, 10, 75, 90],\n)\n# 设置纵轴数据（第二组）\nbar.add_yaxis(\n    &quot;商家B&quot;,\n    [15, 12, 30, 20, 45, 60]\n)\n# 设置纵轴数据（第三组）\nbar.add_yaxis(\n    &quot;商家C&quot;,\n    [12, 32, 40, 52, 35, 26]\n)\n# 添加全局配置参数\nbar.set_global_opts(\n    # 横轴相关的参数\n    xaxis_opts=options.AxisOpts(\n        axislabel_opts=options.LabelOpts(\n            color='white'\n        )\n    ),\n    # 纵轴相关的参数（标签、最小值、最大值、间隔）\n    yaxis_opts=options.AxisOpts(\n        axislabel_opts=options.LabelOpts(\n            color='white'\n        ),\n        min_=0,\n        max_=100,\n        interval=10\n    ),\n    # 标题相关的参数（内容、链接、位置、文本样式）\n    title_opts=options.TitleOpts(\n        title='2021年销售数据展示',\n        title_link='http://www.qfedu.com',\n        pos_left='2%',\n        title_textstyle_opts=options.TextStyleOpts(\n            color='white',\n            font_size=16,\n            font_family='SimHei',\n            font_weight='bold'\n        )\n    ),\n    # 工具箱相关的参数\n    toolbox_opts=options.ToolboxOpts(\n        orient='vertical',\n        pos_left='right'\n    )\n)\n# 在Jupyter Notebook中渲染图表\nbar.render_notebook()\n</code></pre>\n<p>上面代码的运行效果如下图所示。值得一提的是，下图中的标题、图例、右侧的工具箱都是可以点击的，大家可以点击它们看看会有什么样的效果，ECharts 的魅力就在于它的交互效果，大家一定要试一试。如果要将下面的统计图表保存成一个网页，可以将上面最后一行代码修改为 <code>bar.render('index.html')</code>  即可。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTg1NjUwLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502185650.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>接下来，我们也是通过一个官方示例，看看如何绘制饼图。</p>\n<pre><code class=\"language-Python\">import pyecharts.options as opts\nfrom pyecharts.charts import Pie\n\n# 准备饼图需要的数据\nx_data = [&quot;直接访问&quot;, &quot;邮件营销&quot;, &quot;联盟广告&quot;, &quot;视频广告&quot;, &quot;搜索引擎&quot;]\ny_data = [335, 310, 234, 135, 1548]\ndata = [(x, y) for x, y in zip(x_data, y_data)]\n\n# 创建饼图对象并设置初始化参数\npie = Pie(init_opts=opts.InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;))\n# 向饼图添加数据\npie.add(\n    '', \n    data_pair=data,\n    radius=[&quot;50%&quot;, &quot;75%&quot;],\n    label_opts=opts.LabelOpts(is_show=False),\n)\n# 设置全局配置项\npie.set_global_opts(\n    # 配置图例相关的参数\n    legend_opts=opts.LegendOpts(\n        pos_left=&quot;legft&quot;,\n        orient=&quot;vertical&quot;\n    )\n)\n# 设置数据系列配置参数\npie.set_series_opts(\n    # 设置不显示工具提示\n    tooltip_opts=opts.TooltipOpts(is_show=False),\n    # 设置饼图标签的样式\n    label_opts=opts.LabelOpts(formatter=&quot;&#123;b&#125;(&#123;c&#125;): &#123;d&#125;%&quot;)\n)\npie.render_notebook()\n</code></pre>\n<p>运行上面的代码，效果如下图所示。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTkwNTU4LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502190558.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>需要提醒大家注意的是，pyecharts 并不能直接使用 NumPy 的 ndarray 和 Pandas 的 Series、DataFrame 为其提供数据，它需要的是 Python 原生的数据类型。可能大家也注意到了，上面的代码中，我们使用的都是列表、元组这样的数据类型。</p>\n<p>最后，我们来看看如何绘制地图，绘制地图首先需要安装额外的依赖库来获取地图相关信息，命令如下所示。</p>\n<pre><code class=\"language-Bash\">pip install echarts-countries-pypkg echarts-china-provinces-pypkg echarts-china-cities-pypkg echarts-china-counties-pypkg\n</code></pre>\n<p>在 Jupyter 中，可以直接使用魔法指令进行安装，如下所示。</p>\n<pre><code class=\"language-Bash\">%pip install echarts-countries-pypkg\n%pip install echarts-china-provinces-pypkg\n%pip install echarts-china-cities-pypkg\n%pip install echarts-china-counties-pypkg\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的四个库分别包含了世界各国、中国省级行政区域、中国市级行政区域、中国区 / 县级行政区域的数据。</p>\n</blockquote>\n<p>然后，我们将全国各省抖音大 V 的数据放在一个列表中，代码如下所示。</p>\n<pre><code class=\"language-Python\">data = [\n    ('广东', 594), ('浙江', 438), ('四川', 316), ('北京', 269), ('山东', 248),\n    ('江苏', 234), ('湖南', 196), ('福建', 166), ('河南', 153), ('辽宁', 152),\n    ('上海', 138), ('河北', 86), ('安徽', 79), ('湖北', 75), ('黑龙江', 70), \n    ('陕西', 63), ('吉林', 59), ('江西', 56), ('重庆', 46), ('贵州', 39),\n    ('山西', 37), ('云南', 33), ('广西', 24), ('天津', 22), ('新疆', 21),\n    ('海南', 18), ('内蒙古', 14), ('台湾', 11), ('甘肃', 7), ('广西壮族自治区', 4),\n    ('香港', 4), ('青海', 3), ('新疆维吾尔自治区', 3), ('内蒙古自治区', 3), ('宁夏', 1)\n]\n</code></pre>\n<p>接下来，我们使用 pyecharts 在地图上标记各省抖音大 V 人数。</p>\n<pre><code class=\"language-Python\">from pyecharts.charts import Map\n\nmap_chart = Map()\nmap_chart.add('', data, 'china', is_roam=False)\nmap_chart.render_notebook()\n</code></pre>\n<p>代码的运行效果如下图所示，将鼠标置于地图上时，会高亮对应的省并看到相关的信息。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMTkyMTQyLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502192142.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>和 seaborn 一样，我们建议大家参考官方提供的示例来使用 pyecharts，我们可以在 pyecharts <span class=\"exturl\" data-url=\"aHR0cHM6Ly9weWVjaGFydHMub3JnLyMvemgtY24v\">官方网站</span>的左侧导航栏中找到 “图表类型” 选项，下面每种类型的图表都有对应的官方示例，很多代码是可以直接使用的，我们需要做的就是将数据换成自己的数据。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/75.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-1/",
            "url": "https://scottalive.github.io/computer-science/python/basic/75.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-1/",
            "title": "数据可视化-1",
            "date_published": "2025-04-24T04:07:49.000Z",
            "content_html": "<h2 id=\"数据可视化-1\"><a class=\"anchor\" href=\"#数据可视化-1\">#</a> 数据可视化 - 1</h2>\n<p>在完成了对数据的透视之后，我们可以将数据透视的结果通过可视化的方式呈现出来，简单的说，就是将数据变成漂亮的统计图表，然后进一步发现和解读数据背后隐藏的商业价值。在之前的课程中，我们已经为大家展示过用使用 <code>Series</code>  或 <code>DataFrame</code>  对象的 <code>plot</code>  方法生成可视化图表的操作，本章我们为大家讲解 <code>plot</code>  方法的基石，它就是大名鼎鼎的 <code>matplotlib</code>  库。</p>\n<h3 id=\"常用的图表类型\"><a class=\"anchor\" href=\"#常用的图表类型\">#</a> 常用的图表类型</h3>\n<p>常用的图表类型及其应用场景如下图所示。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwMzE1MTkzMzI2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220315193326.png</span>&quot; style=&quot;zoom:65%&quot;&gt;</p>\n<h3 id=\"matplotlib-的安装和导入\"><a class=\"anchor\" href=\"#matplotlib-的安装和导入\">#</a> Matplotlib 的安装和导入</h3>\n<p>如果还没有安装 <code>matplotlib</code>  库，可以使用 Python 的包管理工具 pip 来安装，命令如下所示。</p>\n<pre><code class=\"language-Shell\">pip install matplotlib\n</code></pre>\n<p>在 Notebook 中，我们可以用下面的方式导入 <code>matplotlib</code> 。为了解决图表中文显示的问题，我们可以通过 <code>pyplot</code>  模块的 <code>rcParams</code>  属性修改配置参数，具体的操作如下所示。</p>\n<pre><code class=\"language-Python\">import matplotlib.pyplot as plt\n\nplt.rcParams['font.sans-serif'] = ['SimHei', 'Songti SC']\nplt.rcParams['axes.unicode_minus'] = False\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面代码中的 <code>SimHei</code>  是字体名称，大家可以通过百度云盘下载并安装该字体，链接地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2clRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODE6ZTdiNCVFRiVCQyU5Qg==\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码:e7b4；</span> <code>Songti SC</code>  是我的 macOS 上自带的字体，对于 macOS 或 Windows 系统，字体的名字都可以在用户主目录下的 <code>.matplotlib</code>  文件夹下的 <code>fontlist-v330.json</code>  文件中找到。值得注意的是，使用中文字体后坐标轴上的负号会显示不出来，所以需要将 <code>axes.unicode_minus</code>  参数设置为 <code>False</code> ，这样才能让坐标轴上的负号正常显示。</p>\n</blockquote>\n<p>通过下面的魔法指令，我们可以在绘图时生成<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU3JTlGJUEyJUU5JTg3JThGJUU1JTlCJUJFJUU1JUJEJUEy\">矢量图</span>（SVG - Scalable Vector Graphics）。</p>\n<pre><code class=\"language-Python\">%config InlineBackend.figure_format='svg'\n</code></pre>\n<h3 id=\"绘图的流程\"><a class=\"anchor\" href=\"#绘图的流程\">#</a> 绘图的流程</h3>\n<h4 id=\"创建画布\"><a class=\"anchor\" href=\"#创建画布\">#</a> 创建画布</h4>\n<p><code>pyplot</code>  模块的 <code>figure</code>  函数可以用来创建画布，创建画布时，可以通过 <code>figsize</code>  参数指定画布的尺寸（默认值是 <code>[6.4, 4.8]</code> ）；可以通过 <code>dpi</code>  参数设置绘图的分辨率，因为 <code>dpi</code>  代表了每英寸的像素点数量。除此之外，还可以通过 <code>facecolor</code>  参数设置画布的背景色。 <code>figure</code>  函数的返回值是一个 <code>Figure</code>  对象，它代表了绘图使用的画布，我们可以基于画布来创建绘图使用的坐标系。</p>\n<pre><code class=\"language-Python\">plt.figure(figsize=(8, 4), dpi=120, facecolor='darkgray')\n</code></pre>\n<h4 id=\"创建坐标系\"><a class=\"anchor\" href=\"#创建坐标系\">#</a> 创建坐标系</h4>\n<p>可以直接使用 <code>pyplot</code>  模块的 <code>subplot</code>  函数来创建坐标系，该函数会返回 <code>Axes</code>  对象。 <code>subplot</code>  的前三个参数分别用来指定整个画布分成几行几列以及当前坐标系的索引，这三个参数的默认值都是 <code>1</code> 。如果需要在画布上创建多个坐标系，就需要使用该函数，否则就直接使用默认的也是唯一的坐标系。当然，也可以通过上面创建的 <code>Figure</code>  对象的 <code>add_subplot</code>  方法或 <code>add_axes</code>  方法来创建坐标系，前者跟 <code>subplot</code>  函数的作用一致，后者会产生嵌套的坐标系。</p>\n<pre><code class=\"language-Python\">plt.subplot(2, 2, 1)\n</code></pre>\n<h4 id=\"绘制图像\"><a class=\"anchor\" href=\"#绘制图像\">#</a> 绘制图像</h4>\n<h5 id=\"折线图\"><a class=\"anchor\" href=\"#折线图\">#</a> 折线图</h5>\n<p>在绘图时，如果没有先调用 <code>figure</code>  函数和 <code>subplot</code>  函数，我们将使用默认的画布和坐标系，如果要绘制折线图，可以使用 <code>pyplot</code>  模块的 <code>plot</code>  函数，并指定横轴和纵轴的数据。折线图最适合用来观察数据的趋势，尤其是当横坐标代表时间的情况下。我们可以使用 <code>plot</code>  函数的 <code>color</code>  参数来定制折线的颜色，可以使用 <code>marker</code>  参数来定制数据点的标记（例如： <code>*</code>  表示五角星， <code>^</code>  表示三角形， <code>o</code>  表示小圆圈等），可以使用 <code>linestyle</code>  参数来定制折线的样式（例如： <code>-</code>  表示实线， <code>--</code>  表示虚线， <code>:</code>  表示点线等），可以使用 <code>linewidth</code>  参数来定制折线的粗细。 下面的代码绘制了一条正弦曲线，其中 <code>marker='*'</code>  会将数据点的标记设置为五角星形状，而 <code>color='red'</code>  会将折线绘制为红色。</p>\n<pre><code class=\"language-Python\">import numpy as np\n\nx = np.linspace(-2 * np.pi, 2 * np.pi, 120)\ny = np.sin(x)\n\n# 创建画布\nplt.figure(figsize=(8, 4), dpi=120)\n# 绘制折线图\nplt.plot(x, y, linewidth=2, marker='*', color='red')\n# 显示绘图\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTczMzQ0LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501173344.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果要在一个坐标系上同时绘制正弦和余弦曲线，可以对上面的代码稍作修改。</p>\n<pre><code class=\"language-Python\">x = np.linspace(-2 * np.pi, 2 * np.pi, 120)\ny1, y2 = np.sin(x), np.cos(x)\n\nplt.figure(figsize=(8, 4), dpi=120)\nplt.plot(x, y1, linewidth=2, marker='*', color='red')\nplt.plot(x, y2, linewidth=2, marker='^', color='blue')\n# 定制图表的标注，其中的arrowprops是定制箭头样式的参数\nplt.annotate('sin(x)', xytext=(0.5, -0.75), xy=(0, -0.25), fontsize=12, arrowprops=&#123;\n    'arrowstyle': '-&gt;', 'color': 'darkgreen', 'connectionstyle': 'angle3, angleA=90, angleB=0'\n&#125;)\nplt.annotate('cos(x)', xytext=(-3, 0.75), xy=(-1.25, 0.5), fontsize=12, arrowprops=&#123;\n    'arrowstyle': '-&gt;', 'color': 'darkgreen', 'connectionstyle': 'arc3, rad=0.35'\n&#125;)\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMDk1OTQ5LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502095949.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果要使用两个坐标系分别绘制正弦和余弦，可以用上面提到的 <code>subplot</code>  函数来创建坐标系，然后再绘图。</p>\n<pre><code class=\"language-Python\">plt.figure(figsize=(8, 4), dpi=120)\n# 创建坐标系（第1个图）\nplt.subplot(2, 1, 1)\nplt.plot(x, y1, linewidth=2, marker='*', color='red')\n# 创建坐标系（第2个图）\nplt.subplot(2, 1, 2)\nplt.plot(x, y2, linewidth=2, marker='^', color='blue')\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTczNDQ2LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501173446.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>当然也可以像下面这么做，大家可以运行代码看看跟上面的图有什么区别。</p>\n<pre><code class=\"language-Python\">plt.figure(figsize=(8, 4), dpi=120)\nplt.subplot(1, 2, 1)\nplt.plot(x, y1, linewidth=2, marker='*', color='red')\nplt.subplot(1, 2, 2)\nplt.plot(x, y2, linewidth=2, marker='^', color='blue')\nplt.show()\n</code></pre>\n<p>然后，再试一试下面这个代码，看看运行效果如何。</p>\n<pre><code class=\"language-Python\">fig = plt.figure(figsize=(10, 4), dpi=120)\nplt.plot(x, y1, linewidth=2, marker='*', color='red')\n# 用Figure对象的add_axes方法在现有坐标系中嵌套一个新的坐标系\n# 该方法的参数是一个四元组，代表了新坐标系在原坐标系中的位置\n# 前两个值是左下角的位置，后两个值是坐标系的宽度和高度\nax = fig.add_axes((0.595, 0.6, 0.3,0.25))\nax.plot(x, y2, marker='^', color='blue')\nax = fig.add_axes((0.155, 0.2, 0.3,0.25))\nax.plot(x, y2, marker='^', color='green')\nplt.show()\n</code></pre>\n<h5 id=\"散点图\"><a class=\"anchor\" href=\"#散点图\">#</a> 散点图</h5>\n<p>散点图可以帮助我们了解两个变量的关系，如果需要了解三个变量的关系，可以将散点图升级为气泡图。下面的代码中， <code>x</code>  和 <code>y</code>  两个数组分别表示每个月的收入和每个月网购的支出，如果我们想了解 <code>x</code>  和 <code>y</code>  是否存在相关关系，就可以绘制如下所示的散点图。</p>\n<pre><code class=\"language-Python\">x = np.array([5550,7500,10500,15000,20000,25000,30000,40000])\ny = np.array([800,1800,1250,2000,1800,2100,2500,3500])\n\nplt.figure(figsize=(6, 4), dpi=120)\nplt.scatter(x, y)\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTczMDM0LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501173034.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<h5 id=\"柱状图\"><a class=\"anchor\" href=\"#柱状图\">#</a> 柱状图</h5>\n<p>在对比数据的差异时，柱状图是非常棒的选择，我们可以使用 <code>pyplot</code>  模块的 <code>bar</code>  函数来生成柱状图，也可以使用 <code>barh</code>  函数来生成水平柱状图。我们先为柱状图准备一些数据，代码如下所示。</p>\n<pre><code class=\"language-Python\">x = np.arange(4)\ny1 = np.random.randint(20, 50, 4)\ny2 = np.random.randint(10, 60, 4)\n</code></pre>\n<p>绘制柱状图的代码。</p>\n<pre><code class=\"language-Python\">plt.figure(figsize=(6, 4), dpi=120)\n# 通过横坐标的偏移，让两组数据对应的柱子分开\n# width参数控制柱子的粗细，label参数为柱子添加标签\nplt.bar(x - 0.1, y1, width=0.2, label='销售A组')\nplt.bar(x + 0.1, y2, width=0.2, label='销售B组')\n# 定制横轴的刻度\nplt.xticks(x, labels=['Q1', 'Q2', 'Q3', 'Q4'])\n# 定制显示图例\nplt.legend()\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTczNTU3LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501173557.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果想绘制堆叠柱状图，可以对上面的代码稍作修改，如下所示。</p>\n<pre><code class=\"language-Python\">labels = ['Q1', 'Q2', 'Q3', 'Q4']\nplt.figure(figsize=(6, 4), dpi=120)\nplt.bar(labels, y1, width=0.4, label='销售A组')\n# 注意：堆叠柱状图的关键是将之前的柱子作为新柱子的底部\n# 可以通过bottom参数指定底部数据，新柱子绘制在底部数据之上\nplt.bar(labels, y2, width=0.4, bottom=y1, label='销售B组')\nplt.legend(loc='lower right')\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTczNjQ1LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501173645.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<h5 id=\"饼状图\"><a class=\"anchor\" href=\"#饼状图\">#</a> 饼状图</h5>\n<p>饼状图通常简称为饼图，是一个将数据划分为几个扇形区域的统计图表，它主要用于描述数量、频率等之间的相对关系。在饼图中，每个扇形区域的大小就是其所表示的数量的比例，这些扇形区域合在一起刚好是一个完整的饼。在需要展示数据构成的场景下，饼状图、树状图和瀑布图是不错的选择，我们可以使用 <code>pyplot</code>  模块的 <code>pie</code>  函数来绘制饼图，代码如下所示。</p>\n<pre><code class=\"language-Python\">data = np.random.randint(100, 500, 7)\nlabels = ['苹果', '香蕉', '桃子', '荔枝', '石榴', '山竹', '榴莲']\n\nplt.figure(figsize=(5, 5), dpi=120)\nplt.pie(\n    data,\n    # 自动显示百分比\n    autopct='%.1f%%',\n    # 饼图的半径\n    radius=1,\n    # 百分比到圆心的距离\n    pctdistance=0.8,\n    # 颜色（随机生成）\n    colors=np.random.rand(7, 3),\n    # 分离距离\n    # explode=[0.05, 0, 0.1, 0, 0, 0, 0],\n    # 阴影效果\n    # shadow=True,\n    # 字体属性\n    textprops=dict(fontsize=8, color='black'),\n    # 楔子属性（生成环状饼图的关键）\n    wedgeprops=dict(linewidth=1, width=0.35),\n    # 标签\n    labels=labels\n)\n# 定制图表的标题\nplt.title('水果销售额占比')\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMDk0MTI4LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502094128.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<blockquote>\n<p><strong>说明</strong>：大家可以试一试将上面代码中被注释的部分恢复，看看有什么样的效果。</p>\n</blockquote>\n<h5 id=\"直方图\"><a class=\"anchor\" href=\"#直方图\">#</a> 直方图</h5>\n<p>在统计学中，直方图是一种展示数据分布情况的图形，是一种二维统计图表，它的两个坐标分别是统计样本和该样本对应的某个属性的度量。下面的数据是某学校 100 名男学生的身高，如果我们想知道数据的分布，就可以使用直方图。</p>\n<pre><code class=\"language-Python\">heights = np.array([\n    170, 163, 174, 164, 159, 168, 165, 171, 171, 167, \n    165, 161, 175, 170, 174, 170, 174, 170, 173, 173, \n    167, 169, 173, 153, 165, 169, 158, 166, 164, 173, \n    162, 171, 173, 171, 165, 152, 163, 170, 171, 163, \n    165, 166, 155, 155, 171, 161, 167, 172, 164, 155, \n    168, 171, 173, 169, 165, 162, 168, 177, 174, 178, \n    161, 180, 155, 155, 166, 175, 159, 169, 165, 174, \n    175, 160, 152, 168, 164, 175, 168, 183, 166, 166, \n    182, 174, 167, 168, 176, 170, 169, 173, 177, 168, \n    172, 159, 173, 185, 161, 170, 170, 184, 171, 172\n])\n</code></pre>\n<p>可以使用 <code>pyplot</code>  模块的 <code>hist</code>  函数来绘制直方图，代码如下所示。</p>\n<pre><code class=\"language-Python\"># 将身高数据分到以下8个组中\nbins = np.array([150, 155, 160, 165, 170, 175, 180, 185, 190])\n\nplt.figure(figsize=(6, 4), dpi=120)\n# density参数默认值为False，表示纵轴显示频数\n# 将density参数设置为True，纵轴会显示概率密度\nplt.hist(heights, bins, density=True)\n# 定制横轴标签\nplt.xlabel('身高')\n# 定制纵轴标签\nplt.ylabel('概率密度')\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAyMDkzOTI0LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220502093924.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<h5 id=\"箱线图\"><a class=\"anchor\" href=\"#箱线图\">#</a> 箱线图</h5>\n<p>箱线图又叫箱型图或盒须图，是一种用于展示一组数据分散情况的统计图表，如下所示。因图形如箱子，而且在上下四分位数之外有线条像胡须延伸出去而得名。在箱线图中，箱子的上边界是上四分位数（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">Q_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>）的位置，箱子的下边界是下四分位数（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">Q_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>）的位置，箱子中间的线条是中位数（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">Q_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>）的位置，而箱子的长度就是四分位距离（IQR）。除此之外，箱子上方线条的边界是最大值，箱子下方线条的边界是最小值，这两条线之外的点就是离群值（outlier）。所谓离群值，是指数据小于<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><mo>−</mo><mn>1.5</mn><mo>×</mo><mi>I</mi><mi>Q</mi><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">Q_1 - 1.5 \\times IQR</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">Q</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> 或数据大于<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mn>3</mn></msub><mo>+</mo><mn>1.5</mn><mo>×</mo><mi>I</mi><mi>Q</mi><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">Q_3 + 1.5 \\times IQR</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">Q</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> 的值，公式中的 <code>1.5</code>  还可以替换为 <code>3</code>  来发现极端离群值（extreme outlier），而介于 <code>1.5</code>  到 <code>3</code>  之间的离群值通常称之为适度离群值（mild outlier）。</p>\n<p>可以使用 <code>pyplot</code>  模块的 <code>boxplot</code>  函数来绘制箱线图，代码如下所示。</p>\n<pre><code class=\"language-Python\"># 数组中有47个[0, 100)范围的随机数\ndata = np.random.randint(0, 100, 47)\n# 向数组中添加三个可能是离群点的数据\ndata = np.append(data, 160)\ndata = np.append(data, 200)\ndata = np.append(data, -50)\n\nplt.figure(figsize=(6, 4), dpi=120)\n# whis参数的默认值是1.5，将其设置为3可以检测极端离群值\n# showmeans=True表示在图中标记均值的位置\nplt.boxplot(data, whis=1.5, showmeans=True, notch=True)\n# 定制纵轴的取值范围\nplt.ylim([-100, 250])\n# 定制横轴的刻度\nplt.xticks([1], labels=['data'])\nplt.show()\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjIwNTAxMTcyODAyLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20220501172802.png</span>&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<blockquote>\n<p><strong>说明</strong>：由于数据是随机生成的，所以大家运行上面的代码生成的图可能跟我这里并不相同。</p>\n</blockquote>\n<h4 id=\"显示或保存图像\"><a class=\"anchor\" href=\"#显示或保存图像\">#</a> 显示或保存图像</h4>\n<p>可以使用 <code>pyplot</code>  模块的 <code>show</code>  函数来显示绘制的图表，我们在上面的代码中使用过这个函数。如果希望保存图表，可以使用 <code>savefig</code>  函数。需要注意的是，如果要同时显示和保存图表，应该先执行 <code>savefig</code>  函数，再执行 <code>show</code>  函数，因为在调用 <code>show</code>  函数时，图表已经被释放，位于 <code>show</code>  函数之后的 <code>savefig</code>  保存的只是一个空白的区域。</p>\n<pre><code class=\"language-Python\">plt.savefig('chart.png')\nplt.show()\n</code></pre>\n<h3 id=\"其他图表\"><a class=\"anchor\" href=\"#其他图表\">#</a> 其他图表</h3>\n<p>使用 matplotlib，我们还可以绘制出其他的统计图表（如：雷达图、玫瑰图、热力图等），但实际工作中，使用频率最高的几类图表我们在上面已经为大家完整的展示出来了。此外，matplotlib 还有很多对统计图表进行定制的细节，例如定制坐标轴、定制图表上的文字和标签等。如果想了解如何用 matplotlib 绘制和定制更多的统计图表，可以直接查看 matplotlib 官方网站上的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvdHV0b3JpYWxzL2luZGV4Lmh0bWw=\">文档</span>和<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvZ2FsbGVyeS9pbmRleC5odG1s\">示例</span>。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/74.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-5/",
            "url": "https://scottalive.github.io/computer-science/python/basic/74.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-5/",
            "title": "Pandas的应用-5",
            "date_published": "2025-04-24T03:07:49.000Z",
            "content_html": "<h2 id=\"pandas的应用-5\"><a class=\"anchor\" href=\"#pandas的应用-5\">#</a> Pandas 的应用 - 5</h2>\n<h3 id=\"dataframe的应用\"><a class=\"anchor\" href=\"#dataframe的应用\">#</a> DataFrame 的应用</h3>\n<h4 id=\"窗口计算\"><a class=\"anchor\" href=\"#窗口计算\">#</a> 窗口计算</h4>\n<p><code>DataFrame</code>  对象的 <code>rolling</code>  方法允许我们将数据置于窗口中，然后就可以使用函数对窗口中的数据进行运算和处理。例如，我们获取了某只股票近期的数据，想制作 5 日均线和 10 日均线，那么就需要先设置窗口再进行运算。我们可以使用三方库 <code>pandas-datareader</code>  来获取指定的股票在某个时间段内的数据，具体的操作如下所示。</p>\n<p>安装 <code>pandas-datareader</code>  三方库。</p>\n<pre><code class=\"language-Bash\">pip install pandas-datareader\n</code></pre>\n<p>通过 <code>pandas-datareader</code>  提供的 <code>get_data_stooq</code>  从 Stooq 网站获取百度（股票代码：BIDU）近期股票数据。</p>\n<pre><code class=\"language-Python\">import pandas_datareader as pdr\n\nbaidu_df = pdr.get_data_stooq('BIDU', start='2021-11-22', end='2021-12-7')\nbaidu_df.sort_index(inplace=True)\nbaidu_df\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjA1NzEwLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208205710.png</span>&quot; style=&quot;zoom:38%;&quot;&gt;</p>\n<p>上面的 <code>DataFrame</code>  有 <code>Open</code> 、 <code>High</code> 、 <code>Low</code> 、 <code>Close</code> 、 <code>Volume</code>  五个列，分别代码股票的开盘价、最高价、最低价、收盘价和成交量，接下来我们对百度的股票数据进行窗口计算。</p>\n<pre><code class=\"language-Python\">baidu_df.rolling(5).mean()\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjA1OTMyLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208205932.png</span>&quot; style=&quot;zoom:38%;&quot;&gt;</p>\n<p>上面的 <code>Close</code>  列的数据就是我们需要的 5 日均线，当然，我们也可以用下面的方法，直接在 <code>Close</code>  列对应的 <code>Series</code>  对象上计算 5 日均线。</p>\n<pre><code class=\"language-Python\">baidu_df.Close.rolling(5).mean()\n</code></pre>\n<p>输出：</p>\n<pre><code>Date\n2021-11-22        NaN\n2021-11-23        NaN\n2021-11-24        NaN\n2021-11-26        NaN\n2021-11-29    150.608\n2021-11-30    151.014\n2021-12-01    150.682\n2021-12-02    150.196\n2021-12-03    147.062\n2021-12-06    146.534\n2021-12-07    146.544\nName: Close, dtype: float64\n</code></pre>\n<h4 id=\"相关性判定\"><a class=\"anchor\" href=\"#相关性判定\">#</a> 相关性判定</h4>\n<p>在统计学中，我们通常使用协方差（covariance）来衡量两个随机变量的联合变化程度。如果变量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的较大值主要与另一个变量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 的较大值相对应，而两者较小值也相对应，那么两个变量倾向于表现出相似的行为，协方差为正。如果一个变量的较大值主要对应于另一个变量的较小值，则两个变量倾向于表现出相反的行为，协方差为负。简单的说，协方差的正负号显示着两个变量的相关性。方差是协方差的一种特殊情况，即变量与自身的协方差。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>c</mi><mi>o</mi><mi>v</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>E</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mi>X</mi><mo>−</mo><mi>μ</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>Y</mi><mo>−</mo><mi>υ</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>=</mo><mi>E</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo>⋅</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>μ</mi><mi>υ</mi></mrow><annotation encoding=\"application/x-tex\">cov(X,Y) = E((X - \\mu)(Y - \\upsilon)) = E(X \\cdot Y) - \\mu\\upsilon\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">υ</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">υ</span></span></span></span></span></p>\n<p>如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 是统计独立的，那么二者的协方差为 0，这是因为在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 独立的情况下：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>E</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo>⋅</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>E</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>⋅</mo><mi>E</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>μ</mi><mi>υ</mi></mrow><annotation encoding=\"application/x-tex\">E(X \\cdot Y) = E(X) \\cdot E(Y) = \\mu\\upsilon\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">υ</span></span></span></span></span></p>\n<p>协方差的数值大小取决于变量的大小，通常是不容易解释的，但是正态形式的协方差大小可以显示两变量线性关系的强弱。在统计学中，皮尔逊积矩相关系数就是正态形式的协方差，它用于度量两个变量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 之间的相关程度（线性相关），其值介于 <code>-1</code>  到 <code>1</code>  之间。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>ρ</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>v</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\rho{X,Y} = \\frac {cov(X, Y)} {\\sigma_{X}\\sigma_{Y}}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.263em;vertical-align:-0.8360000000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.3139999999999996em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8360000000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>估算样本的协方差和标准差，可以得到样本皮尔逊系数，通常用希腊字母 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">ρ</span></span></span></span> 表示。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>ρ</mi><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>−</mo><mover accent=\"true\"><mi>X</mi><mo>ˉ</mo></mover><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>−</mo><mover accent=\"true\"><mi>Y</mi><mo>ˉ</mo></mover><mo stretchy=\"false\">)</mo></mrow><mrow><msqrt><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>−</mo><mover accent=\"true\"><mi>X</mi><mo>ˉ</mo></mover><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></msqrt><msqrt><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>−</mo><mover accent=\"true\"><mi>Y</mi><mo>ˉ</mo></mover><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></msqrt></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\rho = \\frac {\\sum_{i=1}^{n}(X_i - \\bar{X})(Y_i - \\bar{Y})} {\\sqrt{\\sum_{i=1}^{n}(X_i - \\bar{X})^2} \\sqrt{\\sum_{i=1}^{n}(Y_i - \\bar{Y})^2}}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.2398200000000004em;vertical-align:-1.7300000000000004em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.50982em;\"><span style=\"top:-2.11em;\"><span class=\"pstrut\" style=\"height:3.2452em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2452em;\"><span class=\"svg-align\" style=\"top:-3.8em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8201099999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.2051999999999996em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.8800000000000001em;\"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90\nl0 -0\nc4,-6.7,10,-10,18,-10 H400000v40\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5948000000000001em;\"><span></span></span></span></span></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2452em;\"><span class=\"svg-align\" style=\"top:-3.8em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8201099999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.2051999999999996em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.8800000000000001em;\"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90\nl0 -0\nc4,-6.7,10,-10,18,-10 H400000v40\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5948000000000001em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.4752em;\"><span class=\"pstrut\" style=\"height:3.2452em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.9349100000000004em;\"><span class=\"pstrut\" style=\"height:3.2452em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8201099999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8201099999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.7300000000000004em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>我们用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">ρ</span></span></span></span> 值判断指标的相关性时遵循以下两个步骤。</p>\n<ol>\n<li>判断指标间是正相关、负相关，还是不相关。\n<ul>\n<li>当 $ \\rho \\gt 0 $，认为变量之间是正相关，也就是两者的趋势一致。</li>\n<li>当 $ \\rho \\lt 0 $，认为变量之间是负相关，也就是两者的趋势相反。</li>\n<li>当 $ \\rho = 0 $，认为变量之间是不相关的，但并不代表两个指标是统计独立的。</li>\n</ul>\n</li>\n<li>判断指标间的相关程度。\n<ul>\n<li>当 $ \\rho $ 的绝对值在 $ [0.6,1] $ 之间，认为变量之间是强相关的。</li>\n<li>当 $ \\rho $ 的绝对值在 $ [0.1,0.6) $ 之间，认为变量之间是弱相关的。</li>\n<li>当 $ \\rho $ 的绝对值在 $ [0,0.1) $ 之间，认为变量之间没有相关性。</li>\n</ul>\n</li>\n</ol>\n<p>皮尔逊相关系数适用于：</p>\n<ol>\n<li>两个变量之间是线性关系，都是连续数据。</li>\n<li>两个变量的总体是正态分布，或接近正态的单峰分布。</li>\n<li>两个变量的观测值是成对的，每对观测值之间相互独立。</li>\n</ol>\n<p><code>DataFrame</code>  对象的 <code>cov</code>  方法和 <code>corr</code>  方法分别用于计算协方差和相关系数， <code>corr</code>  方法的第一个参数 <code>method</code>  的默认值是 <code>pearson</code> ，表示计算皮尔逊相关系数；除此之外，还可以指定 <code>kendall</code>  或 <code>spearman</code>  来获得肯德尔系数或斯皮尔曼等级相关系数。</p>\n<p>接下来，我们从名为 <code>boston_house_price.csv</code>  的文件中获取著名的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGV5d2hhbGUuY29tL213L2RhdGFzZXQvNTkwYmQ1OTU4MTJlZGUzMmI3M2Y1NWYy\">波士顿房价数据集</span>来创建一个 <code>DataFrame</code> ，我们通过 <code>corr</code>  方法计算可能影响房价的 <code>13</code>  个因素中，哪些跟房价是正相关或负相关的，代码如下所示。</p>\n<pre><code class=\"language-Python\">boston_df = pd.read_csv('data/csv/boston_house_price.csv')\nboston_df.corr()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 CSV 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2c=\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g</span>，提取码：e7b4。</p>\n</blockquote>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjEzMzI1LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208213325.png</span>&quot;&gt;</p>\n<p>斯皮尔曼相关系数对数据条件的要求没有皮尔逊相关系数严格，只要两个变量的观测值是成对的等级评定资料，或者是由连续变量观测资料转化得到的等级资料，不论两个变量的总体分布形态、样本容量的大小如何，都可以用斯皮尔曼等级相关系数来进行研究。我们通过下面的方式来计算斯皮尔曼相关系数。</p>\n<pre><code class=\"language-Python\">boston_df.corr('spearman')\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjEzNTE4LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208213518.png</span>&quot;&gt;</p>\n<p>在 Notebook 或 JupyterLab 中，我们可以为 <code>PRICE</code>  列添加渐变色，用颜色直观的展示出跟房价负相关、正相关、不相关的列， <code>DataFrame</code>  对象 <code>style</code>  属性的 <code>background_gradient</code>  方法可以完成这个操作，代码如下所示。</p>\n<pre><code class=\"language-Python\">boston_df.corr('spearman').style.background_gradient('RdYlBu', subset=['PRICE'])\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjE1MjI4LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208215228.png</span>&quot;&gt;</p>\n<p>上面代码中的 <code>RdYlBu</code>  代表的颜色如下所示，相关系数的数据值越接近 <code>1</code> ，颜色越接近红色；数据值越接近 <code>1</code> ，颜色越接近蓝色；数据值在 <code>0</code>  附件则是黄色。</p>\n<pre><code class=\"language-Python\">plt.get_cmap('RdYlBu')\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjE1MDU3LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208215057.png</span>&quot;&gt;</p>\n<h3 id=\"index的应用\"><a class=\"anchor\" href=\"#index的应用\">#</a> Index 的应用</h3>\n<p>我们再来看看 <code>Index</code>  类型，它为 <code>Series</code>  和 <code>DataFrame</code>  对象提供了索引服务，常用的 <code>Index</code>  有以下几种。</p>\n<h4 id=\"范围索引rangeindex\"><a class=\"anchor\" href=\"#范围索引rangeindex\">#</a> 范围索引（RangeIndex）</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">sales_data = np.random.randint(400, 1000, 12)\nmonth_index = pd.RangeIndex(1, 13, name='月份')\nser = pd.Series(data=sales_data, index=month_index)\nser\n</code></pre>\n<p>输出：</p>\n<pre><code>月份\n1     703\n2     705\n3     557\n4     943\n5     961\n6     615\n7     788\n8     985\n9     921\n10    951\n11    874\n12    609\ndtype: int64\n</code></pre>\n<h4 id=\"分类索引categoricalindex\"><a class=\"anchor\" href=\"#分类索引categoricalindex\">#</a> 分类索引（CategoricalIndex）</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">cate_index = pd.CategoricalIndex(\n    ['苹果', '香蕉', '苹果', '苹果', '桃子', '香蕉'],\n    ordered=True,\n    categories=['苹果', '香蕉', '桃子']\n)\nser = pd.Series(data=amount, index=cate_index)\nser\n</code></pre>\n<p>输出：</p>\n<pre><code>苹果    6\n香蕉    6\n苹果    7\n苹果    6\n桃子    8\n香蕉    6\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser.groupby(level=0).sum()\n</code></pre>\n<p>输出：</p>\n<pre><code>苹果    19\n香蕉    12\n桃子     8\ndtype: int64\n</code></pre>\n<h4 id=\"多级索引multiindex\"><a class=\"anchor\" href=\"#多级索引multiindex\">#</a> 多级索引（MultiIndex）</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ids = np.arange(1001, 1006)\nsms = ['期中', '期末']\nindex = pd.MultiIndex.from_product((ids, sms), names=['学号', '学期'])\ncourses = ['语文', '数学', '英语']\nscores = np.random.randint(60, 101, (10, 3))\ndf = pd.DataFrame(data=scores, columns=courses, index=index)\ndf\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码使用了 <code>MultiIndex</code>  的类方法 <code>from_product</code> ，该方法通过 <code>ids</code>  和 <code>sms</code>  两组数据的笛卡尔积构造了多级索引。</p>\n</blockquote>\n<p>输出：</p>\n<pre><code>             语文 数学 英语\n学号\t学期\t\t\t\n1001  期中\t93\t77\t60\n      期末\t93\t98\t84\n1002  期中\t64\t78\t71\n      期末\t70\t71\t97\n1003  期中\t72\t88\t97\n      期末\t99\t100\t63\n1004  期中\t80\t71\t61\n      期末\t91\t62\t72\n1005  期中\t82\t95\t67\n      期末\t84\t78\t86\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 计算每个学生的成绩，期中占25%，期末占75%\ndf.groupby(level=0).agg(lambda x: x.values[0] * 0.25 + x.values[1] * 0.75)\n</code></pre>\n<p>输出：</p>\n<pre><code>        语文    数学    英语\n学号\t\t\t\n1001\t93.00\t92.75\t78.00\n1002\t68.50\t72.75\t90.50\n1003\t92.25\t97.00\t71.50\n1004\t88.25\t64.25\t69.25\n1005\t83.50\t82.25\t81.25\n</code></pre>\n<h4 id=\"日期时间索引datetimeindex\"><a class=\"anchor\" href=\"#日期时间索引datetimeindex\">#</a> 日期时间索引（DatetimeIndex）</h4>\n<ol>\n<li>\n<p>通过 <code>date_range()</code>  函数，我们可以创建日期时间索引，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">pd.date_range('2021-1-1', '2021-6-1', periods=10)\n</code></pre>\n<p>输出：</p>\n<pre><code>DatetimeIndex(['2021-01-01 00:00:00', '2021-01-17 18:40:00',\n               '2021-02-03 13:20:00', '2021-02-20 08:00:00',\n               '2021-03-09 02:40:00', '2021-03-25 21:20:00',\n               '2021-04-11 16:00:00', '2021-04-28 10:40:00',\n               '2021-05-15 05:20:00', '2021-06-01 00:00:00'],\n              dtype='datetime64[ns]', freq=None)\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">pd.date_range('2021-1-1', '2021-6-1', freq='W')\n</code></pre>\n<p>输出：</p>\n<pre><code>DatetimeIndex(['2021-01-03', '2021-01-10', '2021-01-17', '2021-01-24',\n               '2021-01-31', '2021-02-07', '2021-02-14', '2021-02-21',\n               '2021-02-28', '2021-03-07', '2021-03-14', '2021-03-21',\n               '2021-03-28', '2021-04-04', '2021-04-11', '2021-04-18',\n               '2021-04-25', '2021-05-02', '2021-05-09', '2021-05-16',\n               '2021-05-23', '2021-05-30'],\n              dtype='datetime64[ns]', freq='W-SUN')\n</code></pre>\n</li>\n<li>\n<p>通过 <code>DateOffset</code>  类型，我们可以设置时间差并和 <code>DatetimeIndex</code>  进行运算，具体的操作如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">index = pd.date_range('2021-1-1', '2021-6-1', freq='W')\nindex - pd.DateOffset(days=2)\n</code></pre>\n<p>输出：</p>\n<pre><code>DatetimeIndex(['2021-01-01', '2021-01-08', '2021-01-15', '2021-01-22',\n               '2021-01-29', '2021-02-05', '2021-02-12', '2021-02-19',\n               '2021-02-26', '2021-03-05', '2021-03-12', '2021-03-19',\n               '2021-03-26', '2021-04-02', '2021-04-09', '2021-04-16',\n               '2021-04-23', '2021-04-30', '2021-05-07', '2021-05-14',\n               '2021-05-21', '2021-05-28'],\n              dtype='datetime64[ns]', freq=None)\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">index + pd.DateOffset(days=2)\n</code></pre>\n<p>输出：</p>\n<pre><code>DatetimeIndex(['2021-01-05', '2021-01-12', '2021-01-19', '2021-01-26',\n               '2021-02-02', '2021-02-09', '2021-02-16', '2021-02-23',\n               '2021-03-02', '2021-03-09', '2021-03-16', '2021-03-23',\n               '2021-03-30', '2021-04-06', '2021-04-13', '2021-04-20',\n               '2021-04-27', '2021-05-04', '2021-05-11', '2021-05-18',\n               '2021-05-25', '2021-06-01'],\n              dtype='datetime64[ns]', freq=None)\n</code></pre>\n</li>\n<li>\n<p>可以使用 <code>DatatimeIndex</code>  类型的相关方法来处理数据，具体包括：</p>\n<ul>\n<li>\n<p><code>shift()</code>  方法：通过时间前移或后移数据，我们仍然以上面百度股票数据为例，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.shift(3, fill_value=0)\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIwNTUxLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208220551.png</span>&quot; style=&quot;zoom:150%;&quot;&gt;</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.shift(-1, fill_value=0)\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIwNzEzLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208220713.png</span>&quot; style=&quot;zoom:150%;&quot;&gt;</p>\n</li>\n<li>\n<p><code>asfreq()</code>  方法：指定一个时间频率抽取对应的数据，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.asfreq('5D')\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIxMjAyLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208221202.png</span>&quot;&gt;</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.asfreq('5D', method='ffill')\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIxMjQ5LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208221249.png</span>&quot; style=&quot;zoom:150%;&quot;&gt;</p>\n</li>\n<li>\n<p><code>resample()</code>  方法：基于时间对数据进行重采样，相当于根据时间周期对数据进行了分组操作，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.resample('1M').mean()\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIxNDI5LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208221429.png</span>&quot;&gt;</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>说明</strong>：上面的代码中， <code>W</code>  表示一周， <code>5D</code>  表示 <code>5</code>  天， <code>1M</code>  表示 <code>1</code>  个月。</p>\n</blockquote>\n</li>\n<li>\n<p>时区转换</p>\n<ul>\n<li>\n<p>获取时区信息。</p>\n<pre><code class=\"language-Python\">import pytz\n\npytz.common_timezones\n</code></pre>\n</li>\n<li>\n<p><code>tz_localize()</code>  方法：将日期时间本地化。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df = baidu_df.tz_localize('Asia/Chongqing')\nbaidu_df\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIxOTQ3LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208221947.png</span>&quot;&gt;</p>\n</li>\n<li>\n<p><code>tz_convert()</code>  方法：转换时区。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">baidu_df.tz_convert('America/New_York')\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMjA4MjIyNDA0LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211208222404.png</span>&quot;&gt;</p>\n</li>\n</ul>\n</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/73.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-4/",
            "url": "https://scottalive.github.io/computer-science/python/basic/73.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-4/",
            "title": "Pandas的应用-4",
            "date_published": "2025-04-24T02:07:49.000Z",
            "content_html": "<h2 id=\"pandas的应用-4\"><a class=\"anchor\" href=\"#pandas的应用-4\">#</a> Pandas 的应用 - 4</h2>\n<h3 id=\"dataframe的应用\"><a class=\"anchor\" href=\"#dataframe的应用\">#</a> DataFrame 的应用</h3>\n<h4 id=\"数据分析\"><a class=\"anchor\" href=\"#数据分析\">#</a> 数据分析</h4>\n<p>经过前面的学习，我们已经将数据准备就绪而且变成了我们想要的样子，接下来就是最为重要的数据分析阶段了。当我们拿到一大堆数据的时候，如何从数据中迅速的解读出有价值的信息，这就是数据分析要解决的问题。首先，我们可以获取数据的描述性统计信息，通过描述性统计信息，我们可以了解数据的集中趋势和离散趋势。</p>\n<p>例如，我们有如下所示的学生成绩表。</p>\n<pre><code class=\"language-Python\">import numpy as np\nimport pandas as pd\n\nscores = np.random.randint(50, 101, (5, 3))\nnames = ('关羽', '张飞', '赵云', '马超', '黄忠')\ncourses = ('语文', '数学', '英语')\ndf = pd.DataFrame(data=scores, columns=courses, index=names)\ndf\n</code></pre>\n<p>输出：</p>\n<pre><code>     语文   数学   英语\n关羽  96    72    73\n张飞  72    70\t97\n赵云  74    51\t79\n马超  100   54\t54\n黄忠  89    100\t88\n</code></pre>\n<p>我们可以通过 <code>DataFrame</code>  对象的方法 <code>mean</code> 、 <code>max</code> 、 <code>min</code> 、 <code>std</code> 、 <code>var</code>  等方法分别获取每个学生或每门课程的平均分、最高分、最低分、标准差、方差等信息，也可以直接通过 <code>describe</code>  方法直接获取描述性统计信息，代码如下所示。</p>\n<p>计算每门课程成绩的平均分。</p>\n<pre><code class=\"language-Python\">df.mean()\n</code></pre>\n<p>输出：</p>\n<pre><code>语文    86.2\n数学    69.4\n英语    78.2\ndtype: float64\n</code></pre>\n<p>计算每个学生成绩的平均分。</p>\n<pre><code class=\"language-Python\">df.mean(axis=1)\n</code></pre>\n<p>输出：</p>\n<pre><code>关羽    80.333333\n张飞    79.666667\n赵云    68.000000\n马超    69.333333\n黄忠    92.333333\ndtype: float64\n</code></pre>\n<p>计算每门课程成绩的方差。</p>\n<pre><code class=\"language-Python\">df.var()\n</code></pre>\n<p>输出：</p>\n<pre><code>语文    161.2\n数学    379.8\n英语    265.7\ndtype: float64\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：通过方差可以看出，数学成绩波动最大，最不稳定。</p>\n</blockquote>\n<p>获取每门课程的描述性统计信息。</p>\n<pre><code class=\"language-Python\">df.describe()\n</code></pre>\n<p>输出：</p>\n<pre><code>        语文        数学         英语\ncount   5.000000\t5.000000\t5.000000\nmean    86.200000\t69.400000\t78.200000\nstd     12.696456\t19.488458\t16.300307\nmin     72.000000\t51.000000\t54.000000\n25%     74.000000\t54.000000\t73.000000\n50%     89.000000\t70.000000\t79.000000\n75%     96.000000\t72.000000\t88.000000\nmax     100.000000\t100.000000\t97.000000\n</code></pre>\n<h5 id=\"排序和top-n\"><a class=\"anchor\" href=\"#排序和top-n\">#</a> 排序和 Top-N</h5>\n<p>如果需要对数据进行排序，可以使用 <code>DataFrame</code>  对象的 <code>sort_values</code>  方法，该方法的 <code>by</code>  参数可以指定根据哪个列或哪些列进行排序，而 <code>ascending</code>  参数可以指定升序或是降序。例如，下面的代码展示了如何将学生表按语文成绩排降序。</p>\n<pre><code class=\"language-Python\">df.sort_values(by='语文', ascending=False)\n</code></pre>\n<p>输出：</p>\n<pre><code>      语文   数学   英语\n马超\t100    54\t  54\n关羽\t96     72     73\n黄忠\t89     100    88\n赵云\t74     51     79\n张飞\t72     70     97\n</code></pre>\n<p>如果 <code>DataFrame</code>  数据量很大，排序将是一个非常耗费时间的操作。有的时候我们只需要获得排前 N 名或后 N 名的数据，这个时候其实没有必要对整个数据进行排序，而是直接利用堆结构找出 Top-N 的数据。 <code>DataFrame</code>  的 <code>nlargest</code>  和 <code>nsmallest</code>  方法就提供对 Top-N 操作的支持，代码如下所示。</p>\n<p>找出语文成绩前 3 名的学生信息。</p>\n<pre><code class=\"language-Python\">df.nlargest(3, '语文')\n</code></pre>\n<p>输出：</p>\n<pre><code>      语文   数学   英语\n马超\t100    54\t  54\n关羽\t96     72     73\n黄忠\t89     100    88\n</code></pre>\n<p>找出数学成绩最低的 3 名学生的信息。</p>\n<pre><code class=\"language-Python\">df.nsmallest(3, '数学')\n</code></pre>\n<p>输出：</p>\n<pre><code>      语文  数学  英语\n赵云  74    51\t79\n马超  100   54\t54\n张飞  72    70\t97\n</code></pre>\n<h5 id=\"分组聚合操作\"><a class=\"anchor\" href=\"#分组聚合操作\">#</a> 分组聚合操作</h5>\n<p>我们先从 Excel 文件中读取一组销售数据，然后再为大家演示如何进行分组聚合操作。</p>\n<pre><code class=\"language-Python\">df = pd.read_excel('2020年销售数据.xlsx')\ndf.head()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过百度云盘进行获取。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMU5oV3RZY3BGekY3MmN4Y3NvRG9YalE/cHdkPXN3ZzElRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUFzd2cxJUUzJTgwJTgy\">https://pan.baidu.com/s/1NhWtYcpFzF72cxcsoDoXjQ?pwd=swg1，提取码：swg1。</span></p>\n</blockquote>\n<p>输出：</p>\n<pre><code>    销售日期\t 销售区域   销售渠道  销售订单     品牌    售价  销售数量\n0   2020-01-01  上海       拼多多    182894-455  八匹马  99    83\n1   2020-01-01  上海       抖音      205635-402  八匹马  219   29\n2   2020-01-01  上海       天猫      205654-021  八匹马  169   85\n3   2020-01-01  上海       天猫      205654-519  八匹马  169   14\n4   2020-01-01  上海       天猫      377781-010  皮皮虾  249   61\n</code></pre>\n<p>如果我们要统计每个销售区域的销售总额，可以先通过 “售价” 和 “销售数量” 计算出销售额，为 <code>DataFrame</code>  添加一个列，代码如下所示。</p>\n<pre><code class=\"language-Python\">df['销售额'] = df['售价'] * df['销售数量']\ndf.head()\n</code></pre>\n<p>输出：</p>\n<pre><code>    销售日期\t 销售区域   销售渠道  销售订单     品牌    售价  销售数量  销售额\n0   2020-01-01  上海       拼多多    182894-455  八匹马  99    83        8217\n1   2020-01-01  上海       抖音      205635-402  八匹马  219   29        6351\n2   2020-01-01  上海       天猫      205654-021  八匹马  169   85        14365\n3   2020-01-01  上海       天猫      205654-519  八匹马  169   14        2366\n4   2020-01-01  上海       天猫      377781-010  皮皮虾  249   61        15189\n</code></pre>\n<p>然后再根据 “销售区域” 列对数据进行分组，这里我们使用的是 <code>DataFrame</code>  对象的 <code>groupby</code>  方法。分组之后，我们取 “销售额” 这个列在分组内进行求和处理，代码和结果如下所示。</p>\n<pre><code class=\"language-Python\">df.groupby('销售区域').销售额.sum()\n</code></pre>\n<p>输出：</p>\n<pre><code>销售区域\n上海    11610489\n北京    12477717\n南京     1767301\n安徽      895463\n广东     1617949\n江苏      537079\n浙江      687862\n福建    10178227\nName: 销售额, dtype: int64\n</code></pre>\n<p>如果我们要统计每个月的销售总额，我们可以将 “销售日期” 作为 groupby` 方法的参数，当然这里需要先将 “销售日期” 处理成月，代码和结果如下所示。</p>\n<pre><code class=\"language-Python\">df.groupby(df['销售日期'].dt.month).销售额.sum()\n</code></pre>\n<p>输出：</p>\n<pre><code>销售日期\n1     5409855\n2     4608455\n3     4164972\n4     3996770\n5     3239005\n6     2817936\n7     3501304\n8     2948189\n9     2632960\n10    2375385\n11    2385283\n12    1691973\nName: 销售额, dtype: int64\n</code></pre>\n<p>接下来我们将难度升级，统计每个销售区域每个月的销售总额，这又该如何处理呢？事实上， <code>groupby</code>  方法的第一个参数可以是一个列表，列表中可以指定多个分组的依据，大家看看下面的代码和输出结果就明白了。</p>\n<pre><code class=\"language-Python\">df.groupby(['销售区域', df['销售日期'].dt.month]).销售额.sum()\n</code></pre>\n<p>输出：</p>\n<pre><code>销售区域  销售日期\n上海      1       1679125\n          2       1689527\n          3       1061193\n          4       1082187\n          5        841199\n          6        785404\n          7        863906\n          8        734937\n          9       1107693\n         10       412108\n         11       825169\n         12       528041\n北京     1       1878234\n         2       1807787\n         3       1360666\n         4       1205989\n         5        807300\n         6       1216432\n         7       1219083\n         8        645727\n         9        390077\n        10       671608\n        11       678668\n        12       596146\n南京     7        841032\n        10       710962\n        12       215307\n安徽     4        341308\n         5        554155\n广东     3        388180\n         8        469390\n         9        365191\n        11       395188\n江苏     4        537079\n浙江     3        248354\n         8        439508\n福建     1       1852496\n         2       1111141\n         3       1106579\n         4        830207\n         5       1036351\n         6        816100\n         7        577283\n         8        658627\n         9        769999\n        10       580707\n        11       486258\n        12       352479\nName: 销售额, dtype: int64\n</code></pre>\n<p>如果希望统计出每个区域的销售总额以及每个区域单笔金额的最高和最低，我们可以在 <code>DataFrame</code>  或 <code>Series</code>  对象上使用 <code>agg</code>  方法并指定多个聚合函数，代码和结果如下所示。</p>\n<pre><code class=\"language-Python\">df.groupby('销售区域').销售额.agg(['sum', 'max', 'min'])\n</code></pre>\n<p>输出：</p>\n<pre><code>          sum        max        min\n销售区域\t\t\t\n上海      11610489   116303     948\n北京      12477717   133411     690\n南京      1767301    87527      1089\n安徽      895463     68502      1683\n广东      1617949    120807     990\n江苏      537079     114312     3383\n浙江      687862     90909      3927\n福建      10178227   87527      897\n</code></pre>\n<p>如果希望自定义聚合后的列的名字，可以使用如下所示的方法。</p>\n<pre><code class=\"language-Python\">df.groupby('销售区域').销售额.agg(销售总额='sum', 单笔最高='max', 单笔最低='min')\n</code></pre>\n<p>输出：</p>\n<pre><code>          销售总额   单笔最高    单笔最低\n销售区域\t\t\t\n上海      11610489   116303     948\n北京      12477717   133411     690\n南京      1767301    87527      1089\n安徽      895463     68502      1683\n广东      1617949    120807     990\n江苏      537079     114312     3383\n浙江      687862     90909      3927\n福建      10178227   87527      897\n</code></pre>\n<p>如果需要对多个列使用不同的聚合函数，例如 “统计每个销售区域销售额的平均值以及销售数量的最低值和最高值”，我们可以按照下面的方式来操作。</p>\n<pre><code class=\"language-Python\">df.groupby('销售区域')[['销售额', '销售数量']].agg(&#123;\n    '销售额': 'mean', '销售数量': ['max', 'min']\n&#125;)\n</code></pre>\n<p>输出：</p>\n<pre><code>         销售额        销售数量\n         mean          max    min\n销售区域\t\t\t\n上海     20622.538188  100    10\n北京     20125.350000  100    10\n南京     22370.898734  100    11\n安徽     26337.147059  98     16\n广东     32358.980000  98     10\n江苏     29837.722222  98     15\n浙江     27514.480000  95     20\n福建     18306.163669  100    10\n</code></pre>\n<h5 id=\"透视表和交叉表\"><a class=\"anchor\" href=\"#透视表和交叉表\">#</a> 透视表和交叉表</h5>\n<p>上面的例子中，“统计每个销售区域每个月的销售总额” 会产生一个看起来很长的结果，在实际工作中我们通常把那些行很多列很少的表成为 “窄表”，如果我们不想得到这样的一个 “窄表”，可以使用 <code>DataFrame</code>  的 <code>pivot_table</code>  方法或者是 <code>pivot_table</code>  函数来生成透视表。透视表的本质就是对数据进行分组聚合操作，<strong>根据 A 列对 B 列进行统计</strong>，如果大家有使用 Excel 的经验，相信对透视表这个概念一定不会陌生。例如，我们要 “统计每个销售区域的销售总额”，那么 “销售区域” 就是我们的 A 列，而 “销售额” 就是我们的 B 列，在 <code>pivot_table</code>  函数中分别对应 <code>index</code>  和 <code>values</code>  参数，这两个参数都可以是单个列或者多个列。</p>\n<pre><code class=\"language-Python\">pd.pivot_table(df, index='销售区域', values='销售额', aggfunc='sum')\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMTA2MTgwOTEyLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211106180912.png</span>&quot; style=&quot;zoom:50%&quot;&gt;</p>\n<blockquote>\n<p><strong>注意</strong>：上面的结果操作跟之前用 <code>groupby</code>  的方式得到的结果有一些区别， <code>groupby</code>  操作后，如果对单个列进行聚合，得到的结果是一个 <code>Series</code>  对象，而上面的结果是一个 <code>DataFrame</code>  对象。</p>\n</blockquote>\n<p>如果要统计每个销售区域每个月的销售总额，也可以使用 <code>pivot_table</code>  函数，代码如下所示。</p>\n<pre><code class=\"language-Python\">pd.pivot_table(df, index=['销售区域', df['销售日期'].dt.month], values='销售额', aggfunc='sum')\n</code></pre>\n<p>上面的操作结果是一个 <code>DataFrame</code> ，但也是一个长长的 “窄表”，如果希望做成一个行比较少列比较多的 “宽表”，可以将 <code>index</code>  参数中的列放到 <code>columns</code>  参数中，代码如下所示。</p>\n<pre><code class=\"language-Python\">pd.pivot_table(\n    df, index='销售区域', columns=df['销售日期'].dt.month, \n    values='销售额', aggfunc='sum', fill_value=0\n)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>： <code>pivot_table</code>  函数的 <code>fill_value=0</code>  会将空值处理为 <code>0</code> 。</p>\n</blockquote>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMTA2MTA0NTUxLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211106104551.png</span>&quot; style=&quot;zoom:50%&quot;&gt;</p>\n<p>使用 <code>pivot_table</code>  函数时，还可以通过添加 <code>margins</code>  和 <code>margins_name</code>  参数对分组聚合的结果做一个汇总，具体的操作和效果如下所示。</p>\n<pre><code class=\"language-Python\">df['月份'] = df['销售日期'].dt.month\npd.pivot_table(\n    df, index='销售区域', columns='月份',\n    values='销售额', aggfunc='sum', fill_value=0, \n    margins=True, margins_name='总计'\n)\n</code></pre>\n<p>输出：</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211106181707.png\" alt=\"image-20211106181707655\" /></p>\n<p>交叉表就是一种特殊的透视表，它不需要先构造一个 <code>DataFrame</code>  对象，而是直接通过数组或 <code>Series</code>  对象指定两个或多个因素进行运算得到统计结果。例如，我们要统计每个销售区域的销售总额，也可以按照如下所示的方式来完成，我们先准备三组数据。</p>\n<pre><code class=\"language-Python\">sales_area, sales_month, sales_amount = df['销售区域'], df['月份'], df['销售额']\n</code></pre>\n<p>使用 <code>crosstab</code>  函数生成交叉表。</p>\n<pre><code class=\"language-Python\">pd.crosstab(\n    index=sales_area, columns=sales_month, values=sales_amount, aggfunc='sum'\n).fillna(0).applymap(int)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码使用了 <code>DataFrame</code>  对象的 <code>fillna</code>  方法将空值处理为 0，再使用 <code>applymap</code>  方法将数据类型处理成整数。</p>\n</blockquote>\n<h4 id=\"数据可视化\"><a class=\"anchor\" href=\"#数据可视化\">#</a> 数据可视化</h4>\n<p>一图胜千言，我们对数据进行透视的结果，最终要通过图表的方式呈现出来，因为图表具有极强的表现力，能够让我们迅速的解读数据中隐藏的价值。和 <code>Series</code>  一样， <code>DataFrame</code>  对象提供了 <code>plot</code>  方法来支持绘图，底层仍然是通过 <code>matplotlib</code>  库实现图表的渲染。关于 <code>matplotlib</code>  的内容，我们在下一个章节进行详细的探讨，这里我们只简单的讲解 <code>plot</code>  方法的用法。</p>\n<p>例如，我们想通过一张柱状图来比较 “每个销售区域的销售总额”，可以直接在透视表上使用 <code>plot</code>  方法生成柱状图。我们先导入 <code>matplotlib.pyplot</code>  模块，通过修改绘图的参数使其支持中文显示。</p>\n<pre><code class=\"language-Python\">import matplotlib.pyplot as plt\n\nplt.rcParams['font.sans-serif'] = 'FZJKai-Z03S'\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的 <code>FZJKai-Z03S</code>  是我电脑上已经安装的一种支持中文的字体的名称，字体的名称可以通过查看用户主目录下 <code>.matplotlib</code>  文件夹下名为 <code>fontlist-v330.json</code>  的文件来获得，而这个文件在执行上面的命令后就会生成。</p>\n</blockquote>\n<p>使用魔法指令配置生成矢量图。</p>\n<pre><code class=\"language-Python\">%config InlineBackend.figure_format = 'svg'\n</code></pre>\n<p>绘制 “每个销售区域销售总额” 的柱状图。</p>\n<pre><code class=\"language-Python\">temp = pd.pivot_table(df, index='销售区域', values='销售额', aggfunc='sum')\ntemp.plot(figsize=(8, 4), kind='bar')\nplt.xticks(rotation=0)\nplt.show()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的第 3 行代码会将横轴刻度上的文字旋转到 0 度，第 4 行代码会显示图像。</p>\n</blockquote>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMTA2MTk1MDQwLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211106195040.png</span>&quot; style=&quot;zoom:50%&quot;&gt;</p>\n<p>如果要绘制饼图，可以修改 <code>plot</code>  方法的 <code>kind</code>  参数为 <code>pie</code> ，然后使用定制饼图的参数对图表加以定制，代码如下所示。</p>\n<pre><code class=\"language-Python\">temp.sort_values(by='销售额', ascending=False).plot(\n    figsize=(6, 6), kind='pie', y='销售额', \n    autopct='%.2f%%', pctdistance=0.8,\n    wedgeprops=dict(linewidth=1, width=0.35)\n)\nplt.legend(loc='center')\nplt.show()\n</code></pre>\n<p>输出：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMTA2MjAxNTUwLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211106201550.png</span>&quot; style=&quot;zoom:50%&quot;&gt;</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/72.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3/",
            "url": "https://scottalive.github.io/computer-science/python/basic/72.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3/",
            "title": "Pandas的应用-3",
            "date_published": "2025-04-24T01:07:49.000Z",
            "content_html": "<h2 id=\"pandas的应用-3\"><a class=\"anchor\" href=\"#pandas的应用-3\">#</a> Pandas 的应用 - 3</h2>\n<h3 id=\"dataframe的应用\"><a class=\"anchor\" href=\"#dataframe的应用\">#</a> DataFrame 的应用</h3>\n<h4 id=\"数据清洗\"><a class=\"anchor\" href=\"#数据清洗\">#</a> 数据清洗</h4>\n<p>通常，我们从 Excel、CSV 或数据库中获取到的数据并不是非常完美的，里面可能因为系统或人为的原因混入了重复值或异常值，也可能在某些字段上存在缺失值；再者， <code>DataFrame</code>  中的数据也可能存在格式不统一、量纲不统一等各种问题。因此，在开始数据分析之前，对数据进行清洗就显得特别重要。</p>\n<h5 id=\"缺失值\"><a class=\"anchor\" href=\"#缺失值\">#</a> 缺失值</h5>\n<p>可以使用 <code>DataFrame</code>  对象的 <code>isnull</code>  或 <code>isna</code>  方法来找出数据表中的缺失值，如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.isnull()\n</code></pre>\n<p>或者</p>\n<pre><code class=\"language-Python\">emp_df.isna()\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename   job\t    mgr     sal     comm    dno\neno\t\t\t\t\t\t\n1359\tFalse\tFalse\tFalse\tFalse\tFalse\tFalse\n2056\tFalse\tFalse\tFalse\tFalse\tFalse\tFalse\n3088\tFalse\tFalse\tFalse\tFalse\tFalse\tFalse\n3211\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n3233\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n3244\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n3251\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n3344\tFalse\tFalse\tFalse\tFalse\tFalse\tFalse\n3577\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n3588\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n4466\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n5234\tFalse\tFalse\tFalse\tFalse\tTrue\tFalse\n5566\tFalse\tFalse\tFalse\tFalse\tFalse\tFalse\n7800\tFalse\tFalse\tTrue\tFalse\tFalse\tFalse\n</code></pre>\n<p>相对应的， <code>notnull</code>  和 <code>notna</code>  方法可以将非空的值标记为 <code>True</code> 。如果想删除这些缺失值，可以使用 <code>DataFrame</code>  对象的 <code>dropna</code>  方法，该方法的 <code>axis</code>  参数可以指定沿着 0 轴还是 1 轴删除，也就是说当遇到空值时，是删除整行还是删除整列，默认是沿 0 轴进行删除的，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.dropna()\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename   job      mgr\t sal    comm     dno\neno\t\t\t\t\t\t\n1359\t胡一刀  销售员\t3344.0\t1800   200.0\t30\n2056\t乔峰    架构师\t 7800.0\t 5000\t1500.0\t 20\n3088\t李莫愁  设计师\t2056.0\t3500   800.0\t20\n3344\t黄蓉    销售主管\t7800.0\t3000   800.0\t30\n5566\t宋远桥  会计师\t7800.0\t4000   1000.0\t10\n</code></pre>\n<p>如果要沿着 1 轴进行删除，可以使用下面的代码。</p>\n<pre><code class=\"language-Python\">emp_df.dropna(axis=1)\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job      sal    dno\neno\t\t\t\t\n1359\t胡一刀   销售员    1800\t30\n2056\t乔峰     架构师\t  5000\t 20\n3088\t李莫愁   设计师    3500\t20\n3211\t张无忌   程序员    3200\t20\n3233\t丘处机   程序员    3400\t20\n3244\t欧阳锋   程序员    3200\t20\n3251\t张翠山   程序员    4000\t20\n3344\t黄蓉     销售主管  3000\t30\n3577\t杨过     会计\t   2200\t  10\n3588\t朱九真   会计\t  2500\t 10\n4466\t苗人凤   销售员\t 2500   30\n5234\t郭靖     出纳      2000   10\n5566\t宋远桥   会计师    4000   10\n7800\t张三丰   总裁      9000   20\n</code></pre>\n<blockquote>\n<p><strong>注意</strong>： <code>DataFrame</code>  对象的很多方法都有一个名为 <code>inplace</code>  的参数，该参数的默认值为 <code>False</code> ，表示我们的操作不会修改原来的 <code>DataFrame</code>  对象，而是将处理后的结果通过一个新的 <code>DataFrame</code>  对象返回。如果将该参数的值设置为 <code>True</code> ，那么我们的操作就会在原来的 <code>DataFrame</code>  上面直接修改，方法的返回值为 <code>None</code> 。简单的说，上面的操作并没有修改 <code>emp_df</code> ，而是返回了一个新的 <code>DataFrame</code>  对象。</p>\n</blockquote>\n<p>在某些特定的场景下，我们可以对空值进行填充，对应的方法是 <code>fillna</code> ，填充空值时可以使用指定的值（通过 <code>value</code>  参数进行指定），也可以用表格中前一个单元格（通过设置参数 <code>method=ffill</code> ）或后一个单元格（通过设置参数 <code>method=bfill</code> ）的值进行填充，当代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.fillna(value=0)\n</code></pre>\n<blockquote>\n<p><strong>注意</strong>：填充的值如何选择也是一个值得探讨的话题，实际工作中，可能会使用某种统计量（如：均值、众数等）进行填充，或者使用某种插值法（如：随机插值法、拉格朗日插值法等）进行填充，甚至有可能通过回归模型、贝叶斯模型等对缺失数据进行填充。</p>\n</blockquote>\n<p>输出：</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n1359\t胡一刀    销售员\t   3344.0\t1800\t200.0\t30\n2056\t乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3088\t李莫愁\t   设计师\t   2056.0\t3500\t800.0\t20\n3211\t张无忌\t   程序员\t   2056.0\t3200\t0.0     20\n3233\t丘处机\t   程序员\t   2056.0\t3400\t0.0\t    20\n3244\t欧阳锋\t   程序员\t   3088.0\t3200\t0.0     20\n3251\t张翠山\t   程序员\t   2056.0\t4000\t0.0\t    20\n3344\t黄蓉\t    销售主管   7800.0\t3000\t800.0\t30\n3577\t杨过\t    会计\t     5566.0\t  2200\t  0.0\t  10\n3588\t朱九真\t   会计\t    5566.0\t 2500\t 0.0\t 10\n4466\t苗人凤\t   销售员\t   3344.0\t2500\t0.0\t    30\n5234\t郭靖\t    出纳\t     5566.0\t  2000\t  0.0\t  10\n5566\t宋远桥\t   会计师\t   7800.0\t4000\t1000.0\t10\n7800\t张三丰\t   总裁\t    0.0      9000\t 1200.0\t 20\n</code></pre>\n<h5 id=\"重复值\"><a class=\"anchor\" href=\"#重复值\">#</a> 重复值</h5>\n<p>接下来，我们先给之前的部门表添加两行数据，让部门表中名为 “研发部” 和 “销售部” 的部门各有两个。</p>\n<pre><code class=\"language-Python\">dept_df.loc[50] = &#123;'dname': '研发部', 'dloc': '上海'&#125;\ndept_df.loc[60] = &#123;'dname': '销售部', 'dloc': '长沙'&#125;\ndept_df\n</code></pre>\n<p>输出:</p>\n<pre><code>    dname  dloc\ndno\t\t\n10\t会计部\t北京\n20\t研发部\t成都\n30\t销售部\t重庆\n40\t运维部\t天津\n50\t研发部\t上海\n60\t销售部\t长沙\n</code></pre>\n<p>现在，我们的数据表中有重复数据了，我们可以通过 <code>DataFrame</code>  对象的 <code>duplicated</code>  方法判断是否存在重复值，该方法在不指定参数时默认判断行索引是否重复，我们也可以指定根据部门名称 <code>dname</code>  判断部门是否重复，代码如下所示。</p>\n<pre><code class=\"language-Python\">dept_df.duplicated('dname')\n</code></pre>\n<p>输出：</p>\n<pre><code>dno\n10    False\n20    False\n30    False\n40    False\n50     True\n60     True\ndtype: bool\n</code></pre>\n<p>从上面的输出可以看到， <code>50</code>  和 <code>60</code>  两个部门从部门名称上来看是重复的，如果要删除重复值，可以使用 <code>drop_duplicates</code>  方法，该方法的 <code>keep</code>  参数可以控制在遇到重复值时，保留第一项还是保留最后一项，或者多个重复项一个都不用保留，全部删除掉。</p>\n<pre><code class=\"language-Python\">dept_df.drop_duplicates('dname')\n</code></pre>\n<p>输出：</p>\n<pre><code>\tdname\tdloc\ndno\t\t\n10\t会计部\t北京\n20\t研发部\t成都\n30\t销售部\t重庆\n40\t运维部\t天津\n</code></pre>\n<p>将 <code>keep</code>  参数的值修改为 <code>last</code> 。</p>\n<pre><code class=\"language-Python\">dept_df.drop_duplicates('dname', keep='last')\n</code></pre>\n<p>输出：</p>\n<pre><code>\tdname\tdloc\ndno\t\t\n10\t会计部\t北京\n40\t运维部\t天津\n50\t研发部\t上海\n60\t销售部\t长沙\n</code></pre>\n<h5 id=\"异常值\"><a class=\"anchor\" href=\"#异常值\">#</a> 异常值</h5>\n<p>异常值在统计学上的全称是疑似异常值，也称作离群点（outlier），异常值的分析也称作离群点分析。异常值是指样本中出现的 “极端值”，数据值看起来异常大或异常小，其分布明显偏离其余的观测值。实际工作中，有些异常值可能是由系统或人为原因造成的，但有些异常值却不是，它们能够重复且稳定的出现，属于正常的极端值，例如很多游戏产品中头部玩家的数据往往都是离群的极端值。所以，我们既不能忽视异常值的存在，也不能简单地把异常值从数据分析中剔除。重视异常值的出现，分析其产生的原因，常常成为发现问题进而改进决策的契机。</p>\n<p>异常值的检测有 Z-score 方法、IQR 方法、DBScan 聚类、孤立森林等，这里我们对前两种方法做一个简单的介绍。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMDA0MTkyODU4LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211004192858.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>如果数据服从正态分布，依据 3σ 法则，异常值被定义与平均值的偏差超过三倍标准差的值。在正态分布下，距离平均值 3σ 之外的值出现的概率为 $ P (|x-\\mu|&gt;3\\sigma)&lt;0.003 $，属于小概率事件。如果数据不服从正态分布，那么可以用远离平均值的多少倍的标准差来描述，这里的倍数就是 Z-score。Z-score 以标准差为单位去度量某一原始分数偏离平均值的距离，公式如下所示。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>z</mi><mo>=</mo><mfrac><mrow><mi>X</mi><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">z = \\frac {X - \\mu} {\\sigma}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0463299999999998em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603299999999998em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">μ</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>Z-score 需要根据经验和实际情况来决定，通常把远离标准差 <code>3</code>  倍距离以上的数据点视为离群点，下面的代给出了如何通过 Z-score 方法检测异常值。</p>\n<pre><code class=\"language-Python\">import numpy as np\n\n\ndef detect_outliers_zscore(data, threshold=3):\n    avg_value = np.mean(data)\n    std_value = np.std(data)\n    z_score = np.abs((data - avg_value) / std_value)\n    return data[z_score &gt; threshold]\n</code></pre>\n<p>IQR 方法中的 IQR（Inter-Quartile Range）代表四分位距离，即上四分位数（Q3）和下四分位数（Q1）的差值。通常情况下，可以认为小于 $ Q1 - 1.5 \\times IQR $ 或大于 $ Q3 + 1.5 \\times IQR $ 的就是异常值，而这种检测异常值的方法也是箱线图（后面会讲到）默认使用的方法。下面的代给出了如何通过 IQR 方法检测异常值。</p>\n<pre><code class=\"language-Python\">import numpy as np\n\n\ndef detect_outliers_iqr(data, whis=1.5):\n    q1, q3 = np.quantile(data, [0.25, 0.75])\n    iqr = q3 - q1\n    lower, upper = q1 - whis * iqr, q3 + whis * iqr\n    return data[(data &lt; lower) | (data &gt; upper)]\n</code></pre>\n<p>如果要删除异常值，可以使用 <code>DataFrame</code>  对象的 <code>drop</code>  方法，该方法可以根据行索引或列索引删除指定的行或列。例如我们认为月薪低于 <code>2000</code>  或高于 <code>8000</code>  的是员工表中的异常值，可以用下面的代码删除对应的记录。</p>\n<pre><code class=\"language-Python\">emp_df.drop(emp_df[(emp_df.sal &gt; 8000) | (emp_df.sal &lt; 2000)].index)\n</code></pre>\n<p>如果要替换掉异常值，可以通过给单元格赋值的方式来实现，也可以使用 <code>replace</code>  方法将指定的值替换掉。例如我们要将月薪为 <code>1800</code>  和 <code>9000</code>  的替换为月薪的平均值，补贴为 <code>800</code>  的替换为 <code>1000</code> ，代码如下所示。</p>\n<pre><code class=\"language-Python\">avg_sal = np.mean(emp_df.sal).astype(int)\nemp_df.replace(&#123;'sal': [1800, 9000], 'comm': 800&#125;, &#123;'sal': avg_sal, 'comm': 1000&#125;)\n</code></pre>\n<h5 id=\"预处理\"><a class=\"anchor\" href=\"#预处理\">#</a> 预处理</h5>\n<p>对数据进行预处理也是一个很大的话题，它包含了对数据的拆解、变换、归约、离散化等操作。我们先来看看数据的拆解。如果数据表中的数据是一个时间日期，我们通常都需要从年、季度、月、日、星期、小时、分钟等维度对其进行拆解，如果时间日期是用字符串表示的，可以先通过 <code>pandas</code>  的 <code>to_datetime</code>  函数将其处理成时间日期。</p>\n<p>在下面的例子中，我们先读取 Excel 文件，获取到一组销售数据，其中第一列就是销售日期，我们将其拆解为 “月份”、“季度” 和 “星期”，代码如下所示。</p>\n<pre><code class=\"language-Python\">sales_df = pd.read_excel(\n    '2020年销售数据.xlsx',\n    usecols=['销售日期', '销售区域', '销售渠道', '品牌', '销售额']\n)\nsales_df.info()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2clRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUFlN2I0JUUzJTgwJTgy\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</span></p>\n</blockquote>\n<p>输出：</p>\n<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;\nRangeIndex: 1945 entries, 0 to 1944\nData columns (total 5 columns):\n #   Column  Non-Null Count  Dtype         \n---  ------  --------------  -----         \n 0   销售日期    1945 non-null   datetime64[ns]\n 1   销售区域    1945 non-null   object        \n 2   销售渠道    1945 non-null   object        \n 3   品牌        1945 non-null   object        \n 4   销售额      1945 non-null   int64         \ndtypes: datetime64[ns](1), int64(1), object(3)\nmemory usage: 76.1+ KB\n</code></pre>\n<pre><code class=\"language-Python\">sales_df['月份'] = sales_df['销售日期'].dt.month\nsales_df['季度'] = sales_df['销售日期'].dt.quarter\nsales_df['星期'] = sales_df['销售日期'].dt.weekday\nsales_df\n</code></pre>\n<p>输出：</p>\n<pre><code>\t    销售日期\t 销售区域\t销售渠道\t品牌\t  销售额\t月份\t季度\t星期\n0\t    2020-01-01\t上海\t     拼多多\t 八匹马   8217\t    1\t 1\t   2\n1\t    2020-01-01\t上海\t     抖音\t      八匹马\t6351\t 1\t  1\t    2\n2\t    2020-01-01\t上海\t     天猫\t      八匹马\t14365\t 1\t  1\t    2\n3\t    2020-01-01\t上海\t     天猫       八匹马\t2366\t 1\t  1     2\n4\t    2020-01-01\t上海\t     天猫 \t  皮皮虾\t15189\t 1\t  1     2\n...     ...         ...        ...       ...      ...     ...  ...   ...\n1940    2020-12-30\t北京\t     京东\t      花花姑娘 6994     12\t 4\t   2\n1941    2020-12-30\t福建\t     实体\t      八匹马\t7663\t 12\t  4\t    2\n1942    2020-12-31\t福建\t     实体\t      花花姑娘 14795    12\t 4\t   3\n1943    2020-12-31\t福建\t     抖音\t      八匹马\t3481\t 12\t  4\t    3\n1944    2020-12-31\t福建\t     天猫\t      八匹马\t2673\t 12\t  4\t    3\n</code></pre>\n<p>在上面的代码中，通过日期时间类型的 <code>Series</code>  对象的 <code>dt</code>  属性，获得一个访问日期时间的对象，通过该对象的 <code>year</code> 、 <code>month</code> 、 <code>quarter</code> 、 <code>hour</code>  等属性，就可以获取到年、月、季度、小时等时间信息，获取到的仍然是一个 <code>Series</code>  对象，它包含了一组时间信息，所以我们通常也将这个 <code>dt</code>  属性称为 “日期时间向量”。</p>\n<p>我们再来说一说字符串类型的数据的处理，我们先从指定的 Excel 文件中读取某招聘网站的招聘数据。</p>\n<pre><code class=\"language-Python\">jobs_df = pd.read_csv(\n    '某招聘网站招聘数据.csv',\n    usecols=['city', 'companyFullName', 'positionName', 'salary']\n)\njobs_df.info()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2clRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUFlN2I0JUUzJTgwJTgy\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</span></p>\n</blockquote>\n<p>输出：</p>\n<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;\nRangeIndex: 3140 entries, 0 to 3139\nData columns (total 4 columns):\n #   Column           Non-Null Count  Dtype \n---  ------           --------------  ----- \n 0   city             3140 non-null   object\n 1   companyFullName  3140 non-null   object\n 2   positionName     3140 non-null   object\n 3   salary           3140 non-null   object\ndtypes: object(4)\nmemory usage: 98.2+ KB\n</code></pre>\n<p>查看前 <code>5</code>  条数据。</p>\n<pre><code class=\"language-Python\">jobs_df.head()\n</code></pre>\n<p>输出：</p>\n<pre><code>    city    companyFullName              positionName    salary\n0   北京\t  达疆网络科技（上海）有限公司    数据分析岗       15k-30k\n1   北京\t  北京音娱时光科技有限公司        数据分析        10k-18k\n2   北京\t  北京千喜鹤餐饮管理有限公司\t     数据分析        20k-30k\n3   北京\t  吉林省海生电子商务有限公司\t     数据分析        33k-50k\n4   北京\t  韦博网讯科技（北京）有限公司\t数据分析        10k-15k\n</code></pre>\n<p>上面的数据表一共有 <code>3140</code>  条数据，但并非所有的职位都是 “数据分析” 的岗位，如果要筛选出数据分析的岗位，可以通过检查 <code>positionName</code>  字段是否包含 “数据分析” 这个关键词，这里需要模糊匹配，应该如何实现呢？我们可以先获取 <code>positionName</code>  列，因为这个 <code>Series</code>  对象的 <code>dtype</code>  是字符串，所以可以通过 <code>str</code>  属性获取对应的字符串向量，然后就可以利用我们熟悉的字符串的方法来对其进行操作，代码如下所示。</p>\n<pre><code class=\"language-Python\">jobs_df = jobs_df[jobs_df.positionName.str.contains('数据分析')]\njobs_df.shape\n</code></pre>\n<p>输出：</p>\n<pre><code>(1515, 4)\n</code></pre>\n<p>可以看出，筛选后的数据还有 <code>1515</code>  条。接下来，我们还需要对 <code>salary</code>  字段进行处理，如果我们希望统计所有岗位的平均工资或每个城市的平均工资，首先需要将用范围表示的工资处理成其中间值，代码如下所示。</p>\n<pre><code class=\"language-Python\">jobs_df.salary.str.extract(r'(\\d+)[kK]?-(\\d+)[kK]?')\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码通过正则表达式捕获组从字符串中抽取出两组数字，分别对应工资的下限和上限，对正则表达式不熟悉的读者，可以阅读我的知乎专栏 “从零开始学 Python” 中的<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTg5Mjk3Njc=\">《正则表达式的应用》</span>一文。</p>\n</blockquote>\n<p>输出：</p>\n<pre><code>        0     1\n0\t    15    30\n1\t    10\t  18\n2       20    30\n3       33    50\n4       10    15\n...     ...   ...\n3065    8     10\n3069    6     10\n3070    2     4\n3071    6     12\n3088    8     12\n</code></pre>\n<p>需要提醒大家的是，抽取出来的两列数据都是字符串类型的值，我们需要将其转换成 <code>int</code>  类型，才能计算平均值，对应的方法是 <code>DataFrame</code>  对象的 <code>applymap</code>  方法，该方法的参数是一个函数，而该函数会作用于 <code>DataFrame</code>  中的每个元素。完成这一步之后，我们就可以使用 <code>apply</code>  方法将上面的 <code>DataFrame</code>  处理成中间值， <code>apply</code>  方法的参数也是一个函数，可以通过指定 <code>axis</code>  参数使其作用于 <code>DataFrame</code>  对象的行或列，代码如下所示。</p>\n<pre><code class=\"language-Python\">temp_df = jobs_df.salary.str.extract(r'(\\d+)[kK]?-(\\d+)[kK]?').applymap(int)\ntemp_df.apply(np.mean, axis=1)\n</code></pre>\n<p>输出：</p>\n<pre><code>0       22.5\n1       14.0\n2       25.0\n3       41.5\n4       12.5\n        ... \n3065    9.0\n3069    8.0\n3070    3.0\n3071    9.0\n3088    10.0\nLength: 1515, dtype: float64\n</code></pre>\n<p>接下来，我们可以用上面的结果替换掉原来的 <code>salary</code>  列或者增加一个新的列来表示职位对应的工资，完整的代码如下所示。</p>\n<pre><code class=\"language-Python\">temp_df = jobs_df.salary.str.extract(r'(\\d+)[kK]?-(\\d+)[kK]?').applymap(int)\njobs_df['salary'] = temp_df.apply(np.mean, axis=1)\njobs_df.head()\n</code></pre>\n<p>输出：</p>\n<pre><code>    city    companyFullName              positionName    salary\n0   北京\t  达疆网络科技（上海）有限公司    数据分析岗       22.5\n1   北京\t  北京音娱时光科技有限公司        数据分析        14.0\n2   北京\t  北京千喜鹤餐饮管理有限公司\t     数据分析        25.0\n3   北京\t  吉林省海生电子商务有限公司\t     数据分析        41.5\n4   北京\t  韦博网讯科技（北京）有限公司\t数据分析        12.5\n</code></pre>\n<p><code>applymap</code>  和 <code>apply</code>  两个方法在数据预处理的时候经常用到， <code>Series</code>  对象也有 <code>apply</code>  方法，也是用于数据的预处理，但是 <code>DataFrame</code>  对象还有一个名为 <code>transform</code>  的方法，也是通过传入的函数对数据进行变换，类似 <code>Series</code>  对象的 <code>map</code>  方法。需要强调的是， <code>apply</code>  方法具有归约效果的，简单的说就是能将较多的数据处理成较少的数据或一条数据；而 <code>transform</code>  方法没有归约效果，只能对数据进行变换，原来有多少条数据，处理后还是有多少条数据。</p>\n<p>如果要对数据进行深度的分析和挖掘，字符串、日期时间这样的非数值类型都需要处理成数值，因为非数值类型没有办法计算相关性，也没有办法进行<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\chi^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">χ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 检验等操作。对于字符串类型，通常可以其分为以下三类，再进行对应的处理。</p>\n<ol>\n<li>有序变量（Ordinal Variable）：字符串表示的数据有顺序关系，那么可以对字符串进行序号化处理。</li>\n<li>分类变量（Categorical Variable）/ 名义变量（Nominal Variable）：字符串表示的数据没有大小关系和等级之分，那么就可以使用独热编码的方式处理成哑变量（虚拟变量）矩阵。</li>\n<li>定距变量（Scale Variable）：字符串本质上对应到一个有大小高低之分的数据，而且可以进行加减运算，那么只需要将字符串处理成对应的数值即可。</li>\n</ol>\n<p>对于第 1 类和第 3 类，我们可以用上面提到的 <code>apply</code>  或 <code>transform</code>  方法来处理，也可以利用 <code>scikit-learn</code>  中的 <code>OrdinalEncoder</code>  处理第 1 类字符串，这个我们在后续的课程中会讲到。对于第 2 类字符串，可以使用 <code>pandas</code>  的 <code>get_dummies()</code>  函数来生成哑变量（虚拟变量）矩阵，代码如下所示。</p>\n<pre><code class=\"language-Python\">persons_df = pd.DataFrame(\n    data=&#123;\n        '姓名': ['关羽', '张飞', '赵云', '马超', '黄忠'],\n        '职业': ['医生', '医生', '程序员', '画家', '教师'],\n        '学历': ['研究生', '大专', '研究生', '高中', '本科']\n    &#125;\n)\npersons_df\n</code></pre>\n<p>输出：</p>\n<pre><code>\t姓名\t职业\t学历\n0\t关羽\t医生\t研究生\n1\t张飞\t医生\t大专\n2\t赵云\t程序员\t研究生\n3\t马超\t画家\t高中\n4\t黄忠\t教师\t本科\n</code></pre>\n<p>将职业处理成哑变量矩阵。</p>\n<pre><code class=\"language-Python\">pd.get_dummies(persons_df['职业'])\n</code></pre>\n<p>输出：</p>\n<pre><code>    医生 教师  画家  程序员\n0\t1    0    0    0\n1\t1    0    0    0\n2\t0    0    0    1\n3\t0    0    1    0\n4\t0    1    0    0\n</code></pre>\n<p>将学历处理成大小不同的值。</p>\n<pre><code class=\"language-Python\">def handle_education(x):\n    edu_dict = &#123;'高中': 1, '大专': 3, '本科': 5, '研究生': 10&#125;\n    return edu_dict.get(x, 0)\n\n\npersons_df['学历'].apply(handle_education)\n</code></pre>\n<p>输出：</p>\n<pre><code>0    10\n1     3\n2    10\n3     1\n4     5\nName: 学历, dtype: int64\n</code></pre>\n<p>我们再来说说数据离散化。离散化也叫分箱，如果变量的取值是连续值，那么它的取值有无数种可能，在进行数据分组的时候就会非常的不方便，这个时候将连续变量离散化就显得非常重要。之所以把离散化叫做分箱，是因为我们可以预先设置一些箱子，每个箱子代表了数据取值的范围，这样就可以将连续的值分配到不同的箱子中，从而实现离散化。下面的例子读取了 2018 年北京积分落户数据，我们可以根据落户积分对数据进行分组，具体的做法如下所示。</p>\n<pre><code class=\"language-Python\">luohu_df = pd.read_csv('data/2018年北京积分落户数据.csv', index_col='id')\nluohu_df.score.describe()\n</code></pre>\n<p>输出：</p>\n<pre><code>count    6019.000000\nmean       95.654552\nstd         4.354445\nmin        90.750000\n25%        92.330000\n50%        94.460000\n75%        97.750000\nmax       122.590000\nName: score, dtype: float64\n</code></pre>\n<p>可以看出，落户积分的最大值是 <code>122.59</code> ，最小值是 <code>90.75</code> ，那么我们可以构造一个从 <code>90</code>  分到 <code>125</code>  分，每 <code>5</code>  分一组的 <code>7</code>  个箱子， <code>pandas</code>  的 <code>cut</code>  函数可以帮助我们首先数据分箱，代码如下所示。</p>\n<pre><code class=\"language-Python\">bins = np.arange(90, 126, 5)\npd.cut(luohu_df.score, bins, right=False)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>： <code>cut</code>  函数的 <code>right</code>  参数默认值为 <code>True</code> ，表示箱子左开右闭；修改为 <code>False</code>  可以让箱子的右边界为开区间，左边界为闭区间，大家看看下面的输出就明白了。</p>\n</blockquote>\n<p>输出：</p>\n<pre><code>id\n1       [120, 125)\n2       [120, 125)\n3       [115, 120)\n4       [115, 120)\n5       [115, 120)\n           ...    \n6015      [90, 95)\n6016      [90, 95)\n6017      [90, 95)\n6018      [90, 95)\n6019      [90, 95)\nName: score, Length: 6019, dtype: category\nCategories (7, interval[int64, left]): [[90, 95) &lt; [95, 100) &lt; [100, 105) &lt; [105, 110) &lt; [110, 115) &lt; [115, 120) &lt; [120, 125)]\n</code></pre>\n<p>我们可以根据分箱的结果对数据进行分组，然后使用聚合函数对每个组进行统计，这是数据分析中经常用到的操作，下一个章节会为大家介绍。除此之外， <code>pandas</code>  还提供了一个名为 <code>qcut</code>  的函数，可以指定分位数对数据进行分箱，有兴趣的读者可以自行研究。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/71.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-2/",
            "url": "https://scottalive.github.io/computer-science/python/basic/71.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-2/",
            "title": "Pandas的应用-2",
            "date_published": "2025-04-24T00:07:49.000Z",
            "content_html": "<h2 id=\"pandas的应用-2\"><a class=\"anchor\" href=\"#pandas的应用-2\">#</a> Pandas 的应用 - 2</h2>\n<h3 id=\"dataframe的应用\"><a class=\"anchor\" href=\"#dataframe的应用\">#</a> DataFrame 的应用</h3>\n<h4 id=\"创建dataframe对象\"><a class=\"anchor\" href=\"#创建dataframe对象\">#</a> 创建 DataFrame 对象</h4>\n<h5 id=\"通过二维数组创建dataframe对象\"><a class=\"anchor\" href=\"#通过二维数组创建dataframe对象\">#</a> 通过二维数组创建 <code>DataFrame</code>  对象</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">scores = np.random.randint(60, 101, (5, 3))\ncourses = ['语文', '数学', '英语']\nids = [1001, 1002, 1003, 1004, 1005]\ndf1 = pd.DataFrame(data=scores, columns=courses, index=ids)\ndf1\n</code></pre>\n<p>输出：</p>\n<pre><code>\t\t语文\t数学\t英语\n1001    69    80\t79\n1002    71\t  60\t100\n1003    94    81\t93\n1004    88\t  88\t67\n1005    82\t  66    60\n</code></pre>\n<h5 id=\"通过字典创建dataframe对象\"><a class=\"anchor\" href=\"#通过字典创建dataframe对象\">#</a> 通过字典创建 <code>DataFrame</code>  对象</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">scores = &#123;\n    '语文': [62, 72, 93, 88, 93],\n    '数学': [95, 65, 86, 66, 87],\n    '英语': [66, 75, 82, 69, 82],\n&#125;\nids = [1001, 1002, 1003, 1004, 1005]\ndf2 = pd.DataFrame(data=scores, index=ids)\ndf2\n</code></pre>\n<p>输出：</p>\n<pre><code>\t\t语文\t数学\t英语\n1001    69    80\t79\n1002    71\t  60\t100\n1003    94    81\t93\n1004    88\t  88\t67\n1005    82\t  66    60\n</code></pre>\n<h5 id=\"读取-csv-文件创建dataframe对象\"><a class=\"anchor\" href=\"#读取-csv-文件创建dataframe对象\">#</a> 读取 CSV 文件创建 <code>DataFrame</code>  对象</h5>\n<p>可以通过 <code>pandas</code>  模块的 <code>read_csv</code>  函数来读取 CSV 文件， <code>read_csv</code>  函数的参数非常多，下面接受几个比较重要的参数。</p>\n<ul>\n<li><code>sep</code>  /  <code>delimiter</code> ：分隔符，默认是 <code>,</code> 。</li>\n<li><code>header</code> ：表头（列索引）的位置，默认值是 <code>infer</code> ，用第一行的内容作为表头（列索引）。</li>\n<li><code>index_col</code> ：用作行索引（标签）的列。</li>\n<li><code>usecols</code> ：需要加载的列，可以使用序号或者列名。</li>\n<li><code>true_values</code>  /  <code>false_values</code> ：哪些值被视为布尔值 <code>True</code>  /  <code>False</code> 。</li>\n<li><code>skiprows</code> ：通过行号、索引或函数指定需要跳过的行。</li>\n<li><code>skipfooter</code> ：要跳过的末尾行数。</li>\n<li><code>nrows</code> ：需要读取的行数。</li>\n<li><code>na_values</code> ：哪些值被视为空值。</li>\n</ul>\n<p>代码：</p>\n<pre><code class=\"language-Python\">df3 = pd.read_csv('2018年北京积分落户数据.csv', index_col='id')\ndf3\n</code></pre>\n<p>输出：</p>\n<pre><code>     name   birthday    company       score\nid\t\t\t\t\n1    杨x    1972-12    北京利德xxxx\t  122.59\n2    纪x    1974-12    北京航天xxxx\t  121.25\n3    王x    1974-05\t  品牌联盟xxxx    118.96\n4    杨x    1975-07\t  中科专利xxxx    118.21\n5    张x    1974-11\t  北京阿里xxxx    117.79\n...  ...    ...        ...            ...\n6015 孙x    1978-08\t  华为海洋xxxx\t  90.75\n6016 刘x    1976-11\t  福斯流体xxxx    90.75\n6017 周x    1977-10\t  赢创德固xxxx    90.75\n6018 赵x\t   1979-07\t  澳科利耳xxxx    90.75\n6019 贺x\t   1981-06\t  北京宝洁xxxx    90.75\n6019 rows × 4 columns\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 CSV 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2clRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUFlN2I0JUUzJTgwJTgy\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</span></p>\n</blockquote>\n<h5 id=\"读取excel文件创建dataframe对象\"><a class=\"anchor\" href=\"#读取excel文件创建dataframe对象\">#</a> 读取 Excel 文件创建 <code>DataFrame</code>  对象</h5>\n<p>可以通过 <code>pandas</code>  模块的 <code>read_excel</code>  函数来读取 Exce l 文件，该函数与上面的 <code>read_csv</code>  非常相近，多了一个 <code>sheet_name</code>  参数来指定数据表的名称，但是不同于 CSV 文件，没有 <code>sep</code>  或 <code>delimiter</code>  这样的参数。下面的代码中， <code>read_excel</code>  函数的 <code>skiprows</code>  参数是一个 Lambda 函数，通过该 Lambda 函数指定只读取 Excel 文件的表头和其中 10% 的数据，跳过其他的数据。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">import random\n\ndf4 = pd.read_excel(\n    io='小宝剑大药房2018年销售数据.xlsx',\n    usecols=['购药时间', '社保卡号', '商品名称', '销售数量', '应收金额', '实收金额'],\n    skiprows=lambda x: x &gt; 0 and random.random() &gt; 0.1\n)\ndf4\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJRdWpsNVJRbjlSN1BhZEIyWjVnX2clRUYlQkMlOEMlRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUFlN2I0JUUzJTgwJTgy\">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</span></p>\n</blockquote>\n<p>输出：</p>\n<pre><code>    购药时间\t\t\t社保卡号\t    商品名称    销售数量\t应收金额\t实收金额\n0\t2018-03-23 星期三\t10012157328\t\t强力xx片\t 1\t\t\t13.8\t\t13.80\n1\t2018-07-12 星期二\t108207828\t    强力xx片\t 1\t        13.8\t\t13.80\n2\t2018-01-17 星期日\t13358228\t    清热xx液\t 1\t\t    28.0\t\t28.00\n3\t2018-07-11 星期一\t10031402228\t\t三九xx灵\t 5\t\t\t149.0\t\t130.00\n4\t2018-01-20 星期三\t10013340328\t\t三九xx灵\t 3\t\t\t84.0\t\t73.92\n...\t...\t\t\t\t\t...\t\t\t\t...\t\t...\t\t\t...\t\t\t...\n618\t2018-03-05 星期六\t10066059228\t\t开博xx通\t 2\t\t\t56.0\t\t49.28\n619\t2018-03-22 星期二\t10035514928\t\t开博xx通\t 1\t\t\t28.0\t\t25.00\n620\t2018-04-15 星期五\t1006668328\t    开博xx通\t 2\t\t\t56.0\t\t50.00\n621\t2018-04-24 星期日\t10073294128\t\t高特xx灵\t 1\t\t\t5.6\t\t\t5.60\n622\t2018-04-24 星期日\t10073294128\t\t高特xx灵\t 10\t\t\t56.0\t\t56.0\n623 rows × 6 columns\n</code></pre>\n<h5 id=\"通过sql从数据库读取数据创建dataframe对象\"><a class=\"anchor\" href=\"#通过sql从数据库读取数据创建dataframe对象\">#</a> 通过 SQL 从数据库读取数据创建 <code>DataFrame</code>  对象</h5>\n<p><code>pandas</code>  模块的 <code>read_sql</code>  函数可以通过 SQL 语句从数据库中读取数据创建 <code>DataFrame</code>  对象，该函数的第二个参数代表了需要连接的数据库。对于 MySQL 数据库，我们可以通过 <code>pymysql</code>  或 <code>mysqlclient</code>  来创建数据库连接，得到一个 <code>Connection</code>  对象，而这个对象就是 <code>read_sql</code>  函数需要的第二个参数，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">import pymysql\n\n# 创建一个MySQL数据库的连接对象\nconn = pymysql.connect(\n    host='47.104.31.138', port=3306,\n    user='guest', password='Guest.618',\n    database='hrs', charset='utf8mb4'\n)\n# 通过SQL从数据库读取数据创建DataFrame\ndf5 = pd.read_sql('select * from tb_emp', conn, index_col='eno')\ndf5\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>：执行上面的代码需要先安装 <code>pymysql</code>  库，如果尚未安装，可以先在 Notebook 的单元格中先执行 <code>!pip install pymysql</code> ，然后再运行上面的代码。上面的代码连接的是我部署在阿里云上的 MySQL 数据库，公网 IP 地址： <code>47.104.31.138</code> ，用户名： <code>guest</code> ，密码： <code>Guest.618</code> ，数据库： <code>hrs</code> ，表名： <code>tb_emp</code> ，字符集： <code>utf8mb4</code> ，大家可以使用这个数据库，但是不要进行恶意的访问。</p>\n</blockquote>\n<p>输出：</p>\n<pre><code>        ename    job     mgr      sal    comm    dno\neno\t\t\t\t\t\t\n1359\t胡一刀   销售员\t3344.0   1800   200.0   30\n2056\t乔峰\t   分析师\t 7800.0   5000   1500.0\t 20\n3088\t李莫愁\t  设计师\t2056.0   3500   800.0   20\n3211\t张无忌\t  程序员\t2056.0   3200   NaN     20\n3233\t丘处机\t  程序员\t2056.0   3400\tNaN     20\n3244\t欧阳锋\t  程序员\t3088.0   3200\tNaN     20\n3251\t张翠山\t  程序员\t2056.0   4000\tNaN     20\n3344\t黄蓉\t   销售主管\t7800.0   3000\t800.0   30\n3577\t杨过\t   会计\t  5566.0   2200   NaN\t  10\n3588\t朱九真\t  会计\t 5566.0   2500   NaN\t 10\n4466\t苗人凤\t  销售员\t3344.0   2500\tNaN     30\n5234\t郭靖\t   出纳\t  5566.0   2000   NaN\t  10\n5566\t宋远桥\t  会计师\t7800.0   4000   1000.0  10\n7800\t张三丰\t  总裁\t NaN      9000   1200.0  20\n</code></pre>\n<h4 id=\"基本属性和方法\"><a class=\"anchor\" href=\"#基本属性和方法\">#</a> 基本属性和方法</h4>\n<p>在开始讲解 <code>DataFrame</code>  的属性和方法前，我们先从之前提到的 <code>hrs</code>  数据库中读取三张表的数据，创建出三个 <code>DataFrame</code>  对象，代码如下所示。</p>\n<pre><code class=\"language-Python\">import pymysql\n\nconn = pymysql.connect(\n    host='47.104.31.138', port=3306, \n    user='guest', password='Guest.618', \n    database='hrs', charset='utf8mb4'\n)\ndept_df = pd.read_sql('select * from tb_dept', conn, index_col='dno')\nemp_df = pd.read_sql('select * from tb_emp', conn, index_col='eno')\nemp2_df = pd.read_sql('select * from tb_emp2', conn, index_col='eno')\n</code></pre>\n<p>得到的三个 <code>DataFrame</code>  对象如下所示。</p>\n<p>部门表（ <code>dept_df</code> ），其中 <code>dno</code>  是部门的编号， <code>dname</code>  和 <code>dloc</code>  分别是部门的名称和所在地。</p>\n<pre><code>    dname  dloc\ndno\n10\t会计部\t北京\n20\t研发部\t成都\n30\t销售部\t重庆\n40\t运维部\t天津\n</code></pre>\n<p>员工表（ <code>emp_df</code> ），其中 <code>eno</code>  是员工编号， <code>ename</code> 、 <code>job</code> 、 <code>mgr</code> 、 <code>sal</code> 、 <code>comm</code>  和 <code>dno</code>  分别代表员工的姓名、职位、主管编号、月薪、补贴和部门编号。</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n1359\t胡一刀    销售员\t   3344.0\t1800\t200.0\t30\n2056\t乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3088\t李莫愁\t   设计师\t   2056.0\t3500\t800.0\t20\n3211\t张无忌\t   程序员\t   2056.0\t3200\tNaN     20\n3233\t丘处机\t   程序员\t   2056.0\t3400\tNaN\t    20\n3244\t欧阳锋\t   程序员\t   3088.0\t3200\tNaN     20\n3251\t张翠山\t   程序员\t   2056.0\t4000\tNaN\t    20\n3344\t黄蓉\t    销售主管   7800.0\t3000\t800.0\t30\n3577\t杨过\t    会计\t     5566.0\t  2200\t  NaN\t  10\n3588\t朱九真\t   会计\t    5566.0\t 2500\t NaN\t 10\n4466\t苗人凤\t   销售员\t   3344.0\t2500\tNaN\t    30\n5234\t郭靖\t    出纳\t     5566.0\t  2000\t  NaN\t  10\n5566\t宋远桥\t   会计师\t   7800.0\t4000\t1000.0\t10\n7800\t张三丰\t   总裁\t    NaN      9000\t 1200.0\t 20\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：在数据库中 <code>mgr</code>  和 <code>comm</code>  两个列的数据类型是 <code>int</code> ，但是因为有缺失值（空值），读取到 <code>DataFrame</code>  之后，列的数据类型变成了 <code>float</code> ，因为我们通常会用 <code>float</code>  类型的 <code>NaN</code>  来表示空值。</p>\n</blockquote>\n<p>员工表（ <code>emp2_df</code> ），跟上面的员工表结构相同，但是保存了不同的员工数据。</p>\n<pre><code>        ename    job    mgr     sal      comm    dno\neno\n9800\t骆昊\t   架构师\t7800\t30000\t 5000\t 20\n9900\t王小刀\t  程序员  9800\t   10000\t1200\t20\n9700\t王大锤\t  程序员  9800    8000 \t600\t    20\n</code></pre>\n<p><code>DataFrame</code>  对象的属性如下表所示。</p>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>at</code>  /  <code>iat</code></td>\n<td>通过标签获取 <code>DataFrame</code>  中的单个值。</td>\n</tr>\n<tr>\n<td><code>columns</code></td>\n<td><code>DataFrame</code>  对象列的索引</td>\n</tr>\n<tr>\n<td><code>dtypes</code></td>\n<td><code>DataFrame</code>  对象每一列的数据类型</td>\n</tr>\n<tr>\n<td><code>empty</code></td>\n<td><code>DataFrame</code>  对象是否为空</td>\n</tr>\n<tr>\n<td><code>loc</code>  /  <code>iloc</code></td>\n<td>通过标签获取 <code>DataFrame</code>  中的一组值。</td>\n</tr>\n<tr>\n<td><code>ndim</code></td>\n<td><code>DataFrame</code>  对象的维度</td>\n</tr>\n<tr>\n<td><code>shape</code></td>\n<td><code>DataFrame</code>  对象的形状（行数和列数）</td>\n</tr>\n<tr>\n<td><code>size</code></td>\n<td><code>DataFrame</code>  对象中元素的个数</td>\n</tr>\n<tr>\n<td><code>values</code></td>\n<td><code>DataFrame</code>  对象的数据对应的二维数组</td>\n</tr>\n</tbody>\n</table>\n<p>关于 <code>DataFrame</code>  的方法，首先需要了解的是 <code>info()</code>  方法，它可以帮助我们了解 <code>DataFrame</code>  的相关信息，如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">emp_df.info()\n</code></pre>\n<p>输出：</p>\n<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;\nInt64Index: 14 entries, 1359 to 7800\nData columns (total 6 columns):\n #   Column  Non-Null Count  Dtype  \n---  ------  --------------  -----  \n 0   ename   14 non-null     object \n 1   job     14 non-null     object \n 2   mgr     13 non-null     float64\n 3   sal     14 non-null     int64  \n 4   comm    6 non-null      float64\n 5   dno     14 non-null     int64  \ndtypes: float64(2), int64(2), object(2)\nmemory usage: 1.3+ KB\n</code></pre>\n<p>如果需要查看 <code>DataFrame</code>  的头部或尾部的数据，可以使用 <code>head()</code>  或 <code>tail()</code>  方法，这两个方法的默认参数是 <code>5</code> ，表示获取 <code>DataFrame</code>  最前面 5 行或最后面 5 行的数据，如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.head()\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job    mgr    sal    comm  dno\neno\t\t\t\t\t\t\n1359\t胡一刀   销售员\t3344   1800  200   30\n2056\t乔峰\t   分析师\t 7800   5000  1500\t20\n3088\t李莫愁\t  设计师\t2056   3500  800   20\n3211\t张无忌\t  程序员\t2056   3200  NaN   20\n3233\t丘处机\t  程序员\t2056   3400\t NaN   20\n</code></pre>\n<h4 id=\"获取数据\"><a class=\"anchor\" href=\"#获取数据\">#</a> 获取数据</h4>\n<h5 id=\"索引和切片\"><a class=\"anchor\" href=\"#索引和切片\">#</a> 索引和切片</h5>\n<p>如果要获取 <code>DataFrame</code>  的某一列，例如取出上面 <code>emp_df</code>  的 <code>ename</code>  列，可以使用下面的两种方式。</p>\n<pre><code class=\"language-Python\">emp_df.ename\n</code></pre>\n<p>或者</p>\n<pre><code class=\"language-Python\">emp_df['ename']\n</code></pre>\n<p>执行上面的代码可以发现，我们获得的是一个 <code>Series</code>  对象。事实上， <code>DataFrame</code>  对象就是将多个 <code>Series</code>  对象组合到一起的结果。</p>\n<p>如果要获取 <code>DataFrame</code>  的某一行，可以使用整数索引或我们设置的索引，例如取出员工编号为 <code>2056</code>  的员工数据，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.iloc[1]\n</code></pre>\n<p>或者</p>\n<pre><code class=\"language-Python\">emp_df.loc[2056]\n</code></pre>\n<p>通过执行上面的代码我们发现，单独取 <code>DataFrame</code>  的某一行或某一列得到的都是 <code>Series</code>  对象。我们当然也可以通过花式索引来获取多个行或多个列的数据，花式索引的结果仍然是一个 <code>DataFrame</code>  对象。</p>\n<p>获取多个列：</p>\n<pre><code class=\"language-Python\">emp_df[['ename', 'job']]\n</code></pre>\n<p>获取多个行：</p>\n<pre><code class=\"language-Python\">emp_df.loc[[2056, 7800, 3344]]\n</code></pre>\n<p>如果要获取或修改 <code>DataFrame</code>  对象某个单元格的数据，需要同时指定行和列的索引，例如要获取员工编号为 <code>2056</code>  的员工的职位信息，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df['job'][2056]\n</code></pre>\n<p>或者</p>\n<pre><code class=\"language-Python\">emp_df.loc[2056]['job']\n</code></pre>\n<p>或者</p>\n<pre><code class=\"language-Python\">emp_df.loc[2056, 'job']\n</code></pre>\n<p>我们推荐大家使用第三种做法，因为它只做了一次索引运算。如果要将该员工的职位修改为 “架构师”，可以使用下面的代码。</p>\n<pre><code class=\"language-Python\">emp_df.loc[2056, 'job'] = '架构师'\n</code></pre>\n<p>当然，我们也可以通过切片操作来获取多行多列，相信大家一定已经想到了这一点。</p>\n<pre><code class=\"language-Python\">emp_df.loc[2056:3344]\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n2056\t乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3088\t李莫愁\t   设计师\t   2056.0\t3500\t800.0\t20\n3211\t张无忌\t   程序员\t   2056.0\t3200\tNaN     20\n3233\t丘处机\t   程序员\t   2056.0\t3400\tNaN\t    20\n3244\t欧阳锋\t   程序员\t   3088.0\t3200\tNaN     20\n3251\t张翠山\t   程序员\t   2056.0\t4000\tNaN\t    20\n3344\t黄蓉\t    销售主管   7800.0\t3000\t800.0\t30\n</code></pre>\n<h5 id=\"数据筛选\"><a class=\"anchor\" href=\"#数据筛选\">#</a> 数据筛选</h5>\n<p>上面我们提到了花式索引，相信大家已经联想到了布尔索引。跟 <code>ndarray</code>  和 <code>Series</code>  一样，我们可以通过布尔索引对 <code>DataFrame</code>  对象进行数据筛选，例如我们要从 <code>emp_df</code>  中筛选出月薪超过 <code>3500</code>  的员工，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df[emp_df.sal &gt; 3500]\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n2056\t乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3251\t张翠山\t   程序员\t   2056.0\t4000\tNaN\t    20\n5566\t宋远桥\t   会计师\t   7800.0\t4000\t1000.0\t10\n7800\t张三丰\t   总裁\t    NaN      9000\t 1200.0\t 20\n</code></pre>\n<p>当然，我们也可以组合多个条件来进行数据筛选，例如从 <code>emp_df</code>  中筛选出月薪超过 <code>3500</code>  且部门编号为 <code>20</code>  的员工，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df[(emp_df.sal &gt; 3500) &amp; (emp_df.dno == 20)]\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n2056\t乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3251\t张翠山\t   程序员\t   2056.0\t4000\tNaN\t    20\n7800\t张三丰\t   总裁\t    NaN      9000\t 1200.0\t 20\n</code></pre>\n<p>除了使用布尔索引， <code>DataFrame</code>  对象的 <code>query</code>  方法也可以实现数据筛选， <code>query</code>  方法的参数是一个字符串，它代表了筛选数据使用的表达式，而且更符合 Python 程序员的使用习惯。下面我们使用 <code>query</code>  方法将上面的效果重新实现一遍，代码如下所示。</p>\n<pre><code class=\"language-Python\">emp_df.query('sal &gt; 3500 and dno == 20')\n</code></pre>\n<h4 id=\"重塑数据\"><a class=\"anchor\" href=\"#重塑数据\">#</a> 重塑数据</h4>\n<p>有的时候，我们做数据分析需要的原始数据可能并不是来自一个地方，就像上面的例子中，我们从关系型数据库中读取了三张表，得到了三个 <code>DataFrame</code>  对象，但实际工作可能需要我们把他们的数据整合到一起。例如： <code>emp_df</code>  和 <code>emp2_df</code>  其实都是员工的数据，而且数据结构完全一致，我们可以使用 <code>pandas</code>  提供的 <code>concat</code>  函数实现两个或多个 <code>DataFrame</code>  的数据拼接，代码如下所示。</p>\n<pre><code class=\"language-Python\">all_emp_df = pd.concat([emp_df, emp2_df])\n</code></pre>\n<p>输出：</p>\n<pre><code>        ename    job        mgr      sal     comm    dno\neno\n1359    胡一刀    销售员\t   3344.0\t1800\t200.0\t30\n2056    乔峰\t    分析师\t    7800.0\t 5000\t 1500.0\t 20\n3088    李莫愁\t   设计师\t   2056.0\t3500\t800.0\t20\n3211    张无忌\t   程序员\t   2056.0\t3200\tNaN     20\n3233    丘处机\t   程序员\t   2056.0\t3400\tNaN\t    20\n3244    欧阳锋\t   程序员\t   3088.0\t3200\tNaN     20\n3251    张翠山\t   程序员\t   2056.0\t4000\tNaN\t    20\n3344    黄蓉\t    销售主管   7800.0\t3000\t800.0\t30\n3577    杨过\t    会计\t     5566.0\t  2200\t  NaN\t  10\n3588    朱九真\t   会计\t    5566.0\t 2500\t NaN\t 10\n4466    苗人凤\t   销售员\t   3344.0\t2500\tNaN\t    30\n5234    郭靖\t    出纳\t     5566.0\t  2000\t  NaN\t  10\n5566    宋远桥\t   会计师\t   7800.0\t4000\t1000.0\t10\n7800    张三丰\t   总裁\t    NaN      9000\t 1200.0\t 20\n9800    骆昊\t    架构师     7800.0\t 30000\t 5000.0\t 20\n9900    王小刀\t   程序员     9800.0\t10000\t1200.0\t20\n9700    王大锤\t   程序员     9800.0\t8000\t600.0\t20\n</code></pre>\n<p>上面的代码将两个代表员工数据的 <code>DataFrame</code>  拼接到了一起，接下来我们使用 <code>merge</code>  函数将员工表和部门表的数据合并到一张表中，代码如下所示。</p>\n<p>先使用 <code>reset_index</code>  方法重新设置 <code>all_emp_df</code>  的索引，这样 <code>eno</code>  不再是索引而是一个普通列， <code>reset_index</code>  方法的 <code>inplace</code>  参数设置为 <code>True</code>  表示，重置索引的操作直接在 <code>all_emp_df</code>  上执行，而不是返回修改后的新对象。</p>\n<pre><code class=\"language-Python\">all_emp_df.reset_index(inplace=True)\n</code></pre>\n<p>通过 <code>merge</code>  函数合并数据，当然，也可以调用 <code>DataFrame</code>  对象的 <code>merge</code>  方法来达到同样的效果。</p>\n<pre><code class=\"language-Python\">pd.merge(dept_df, all_emp_df, how='inner', on='dno')\n</code></pre>\n<p>输出：</p>\n<pre><code>    dno dname  dloc eno   ename  job      mgr     sal    comm\n0   10\t会计部\t北京\t3577  杨过\t会计\t   5566.0  2200   NaN\n1   10\t会计部\t北京\t3588  朱九真  会计     5566.0  2500   NaN\n2   10\t会计部\t北京\t5234  郭靖\t出纳\t   5566.0  2000   NaN\n3   10\t会计部\t北京\t5566  宋远桥  会计师   7800.0\t 4000   1000.0\n4   20\t研发部\t成都\t2056  乔峰\t架构师   7800.0  5000\t 1500.0\n5   20\t研发部\t成都\t3088  李莫愁  设计师   2056.0\t 3500   800.0\n6   20\t研发部\t成都\t3211  张无忌  程序员   2056.0\t 3200   NaN\n7   20\t研发部\t成都\t3233  丘处机  程序员   2056.0\t 3400   NaN\n8   20\t研发部\t成都\t3244  欧阳锋  程序员   3088.0\t 3200   NaN\n9   20\t研发部\t成都\t3251  张翠山  程序员   2056.0\t 4000   NaN\n10  20\t研发部\t成都\t7800  张三丰  总裁     NaN     9000   1200.0\n11  20\t研发部\t成都\t9800  骆昊    架构师   7800.0  30000\t 5000.0\n12  20\t研发部\t成都\t9900  王小刀  程序员\t 9800.0\t 10000  1200.0\n13  20\t研发部\t成都\t9700  王大锤  程序员\t 9800.0\t 8000   600.0\n14  30\t销售部\t重庆\t1359  胡一刀  销售员\t 3344.0\t 1800   200.0\n15  30\t销售部\t重庆\t3344  黄蓉    销售主管 7800.0\t 3000   800.0\n16  30\t销售部\t重庆\t4466  苗人凤  销售员   3344.0\t 2500   NaN\n</code></pre>\n<p><code>merge</code>  函数的一个参数代表合并的左表、第二个参数代表合并的右表，有 SQL 编程经验的同学对这两个词是不是感觉到非常亲切。正如大家猜想的那样， <code>DataFrame</code>  对象的合并跟数据库中的表连接非常类似，所以上面代码中的 <code>how</code>  代表了合并两张表的方式，有 <code>left</code> 、 <code>right</code> 、 <code>inner</code> 、 <code>outer</code>  四个选项；而 <code>on</code>  则代表了基于哪个列实现表的合并，相当于 SQL 表连接中的连表条件，如果左右两表对应的列列名不同，可以用 <code>left_on</code>  和 <code>right_on</code>  参数取代 <code>on</code>  参数分别进行指定。</p>\n<p>如果对上面的代码稍作修改，将 <code>how</code>  参数修改为 <code>left</code> ，大家可以思考一下代码执行的结果。</p>\n<pre><code class=\"language-Python\">pd.merge(dept_df, all_emp_df, how='left', on='dno')\n</code></pre>\n<p>运行结果比之前的输出多出了如下所示的一行，这是因为 <code>left</code>  代表左外连接，也就意味着左表 <code>dept_df</code>  中的数据会被完整的查出来，但是在 <code>all_emp_df</code>  中又没有编号为 <code>40</code>  部门的员工，所以对应的位置都被填入了空值。</p>\n<pre><code>17  40  运维部  天津  NaN  NaN  NaN  NaN  NaN  NaN\n</code></pre>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/70.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-1/",
            "url": "https://scottalive.github.io/computer-science/python/basic/70.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-1/",
            "title": "Pandas的应用-1",
            "date_published": "2025-04-23T23:07:49.000Z",
            "content_html": "<h2 id=\"pandas的应用-1\"><a class=\"anchor\" href=\"#pandas的应用-1\">#</a> Pandas 的应用 - 1</h2>\n<p>Pandas 是 Wes McKinney 在 2008 年开发的一个强大的<strong>分析结构化数据</strong>的工具集。Pandas 以 NumPy 为基础（数据表示和运算），提供了用于数据处理的函数和方法，对数据分析和数据挖掘提供了很好的支持；同时 Pandas 还可以跟数据可视化工具 Matplotlib 很好的整合在一起，非常轻松愉快的实现数据的可视化展示。</p>\n<p>Pandas 核心的数据类型是 <code>Series</code> （数据系列）、 <code>DataFrame</code> （数据表 / 数据框），分别用于处理一维和二维的数据，除此之外还有一个名为 <code>Index</code>  的类型及其子类型，它为 <code>Series</code>  和 <code>DataFrame</code>  提供了索引功能。日常工作中以 <code>DataFrame</code>  使用最为广泛，因为二维的数据本质就是一个有行有列的表格（想一想 Excel 电子表格和关系型数据库中的二维表）。上述这些类型都提供了大量的处理数据的方法，数据分析师可以以此为基础实现对数据的各种常规处理。</p>\n<h3 id=\"series的应用\"><a class=\"anchor\" href=\"#series的应用\">#</a> Series 的应用</h3>\n<p>Pandas 库中的 <code>Series</code>  对象可以用来表示一维数据结构，跟数组非常类似，但是多了一些额外的功能。 <code>Series</code>  的内部结构包含了两个数组，其中一个用来保存数据，另一个用来保存数据的索引。</p>\n<h4 id=\"创建series对象\"><a class=\"anchor\" href=\"#创建series对象\">#</a> 创建 Series 对象</h4>\n<blockquote>\n<p><strong>提示</strong>：在执行下面的代码之前，请先导入 <code>pandas</code>  以及相关的库文件，具体的做法可以参考上一章。</p>\n</blockquote>\n<h5 id=\"方法1通过列表或数组创建series对象\"><a class=\"anchor\" href=\"#方法1通过列表或数组创建series对象\">#</a> 方法 1：通过列表或数组创建 Series 对象</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># data参数表示数据，index参数表示数据的索引（标签）\n# 如果没有指定index属性，默认使用数字索引\nser1 = pd.Series(data=[320, 180, 300, 405], index=['一季度', '二季度', '三季度', '四季度'])\nser1\n</code></pre>\n<p>输出：</p>\n<pre><code>一季度    320\n二季度    180\n三季度    300\n四季度    405\ndtype: int64\n</code></pre>\n<h5 id=\"方法2通过字典创建series对象\"><a class=\"anchor\" href=\"#方法2通过字典创建series对象\">#</a> 方法 2：通过字典创建 Series 对象。</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 字典中的键就是数据的索引（标签），字典中的值就是数据\nser2 = pd.Series(&#123;'一季度': 320, '二季度': 180, '三季度': 300, '四季度': 405&#125;)\nser2\n</code></pre>\n<p>输出：</p>\n<pre><code>一季度    320\n二季度    180\n三季度    300\n四季度    405\ndtype: int64\n</code></pre>\n<h4 id=\"索引和切片\"><a class=\"anchor\" href=\"#索引和切片\">#</a> 索引和切片</h4>\n<p>跟数组一样，Series 对象也可以进行索引和切片操作，不同的是 Series 对象因为内部维护了一个保存索引的数组，所以除了可以使用整数索引通过位置检索数据外，还可以通过自己设置的索引标签获取对应的数据。</p>\n<h5 id=\"使用整数索引\"><a class=\"anchor\" href=\"#使用整数索引\">#</a> 使用整数索引</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(ser2[0], ser[1], ser[2], ser[3])\nser2[0], ser2[3] = 350, 360\nprint(ser2)\n</code></pre>\n<p>输出：</p>\n<pre><code>320 180 300 405\n一季度    350\n二季度    180\n三季度    300\n四季度    360\ndtype: int64\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>：如果要使用负向索引，必须在创建 <code>Series</code>  对象时通过 <code>index</code>  属性指定非数值类型的标签。</p>\n</blockquote>\n<h5 id=\"使用自定义的标签索引\"><a class=\"anchor\" href=\"#使用自定义的标签索引\">#</a> 使用自定义的标签索引</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(ser2['一季度'], ser2['三季度'])\nser2['一季度'] = 380\nprint(ser2)\n</code></pre>\n<p>输出：</p>\n<pre><code>350 300\n一季度    380\n二季度    180\n三季度    300\n四季度    360\ndtype: int64\n</code></pre>\n<h5 id=\"切片操作\"><a class=\"anchor\" href=\"#切片操作\">#</a> 切片操作</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(ser2[1:3])\nprint(ser2['二季度':'四季度'])\n</code></pre>\n<p>输出：</p>\n<pre><code>二季度    180\n三季度    300\ndtype: int64\n二季度    500\n三季度    500\n四季度    520\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser2[1:3] = 400, 500\nser2\n</code></pre>\n<p>输出：</p>\n<pre><code>一季度    380\n二季度    400\n三季度    500\n四季度    360\ndtype: int64\n</code></pre>\n<h5 id=\"花式索引\"><a class=\"anchor\" href=\"#花式索引\">#</a> 花式索引</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(ser2[['二季度', '四季度']])\nser2[['二季度', '四季度']] = 500, 520\nprint(ser2)\n</code></pre>\n<p>输出：</p>\n<pre><code>二季度    400\n四季度    360\ndtype: int64\n一季度    380\n二季度    500\n三季度    500\n四季度    520\ndtype: int64\n</code></pre>\n<h5 id=\"布尔索引\"><a class=\"anchor\" href=\"#布尔索引\">#</a> 布尔索引</h5>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser2[ser2 &gt;= 500]\n</code></pre>\n<p>输出：</p>\n<pre><code>二季度    500\n三季度    500\n四季度    520\ndtype: int64\n</code></pre>\n<p>#### 属性和方法</p>\n<p>Series 对象的常用属性如下表所示。</p>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>dtype</code>  /  <code>dtypes</code></td>\n<td>返回 <code>Series</code>  对象的数据类型</td>\n</tr>\n<tr>\n<td><code>hasnans</code></td>\n<td>判断 <code>Series</code>  对象中有没有空值</td>\n</tr>\n<tr>\n<td><code>at</code>  /  <code>iat</code></td>\n<td>通过索引访问 <code>Series</code>  对象中的单个值</td>\n</tr>\n<tr>\n<td><code>loc</code>  /  <code>iloc</code></td>\n<td>通过一组索引访问 <code>Series</code>  对象中的一组值</td>\n</tr>\n<tr>\n<td><code>index</code></td>\n<td>返回 <code>Series</code>  对象的索引</td>\n</tr>\n<tr>\n<td><code>is_monotonic</code></td>\n<td>判断 <code>Series</code>  对象中的数据是否单调</td>\n</tr>\n<tr>\n<td><code>is_monotonic_increasing</code></td>\n<td>判断 <code>Series</code>  对象中的数据是否单调递增</td>\n</tr>\n<tr>\n<td><code>is_monotonic_decreasing</code></td>\n<td>判断 <code>Series</code>  对象中的数据是否单调递减</td>\n</tr>\n<tr>\n<td><code>is_unique</code></td>\n<td>判断 <code>Series</code>  对象中的数据是否独一无二</td>\n</tr>\n<tr>\n<td><code>size</code></td>\n<td>返回 <code>Series</code>  对象中元素的个数</td>\n</tr>\n<tr>\n<td><code>values</code></td>\n<td>以 <code>ndarray</code>  的方式返回 <code>Series</code>  对象中的值</td>\n</tr>\n</tbody>\n</table>\n<p><code>Series</code>  对象的方法很多，我们通过下面的代码为大家介绍一些常用的方法。</p>\n<h5 id=\"统计相关的方法\"><a class=\"anchor\" href=\"#统计相关的方法\">#</a> 统计相关的方法</h5>\n<p><code>Series</code>  对象支持各种获取描述性统计信息的方法。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 求和\nprint(ser2.sum())\n# 求均值\nprint(ser2.mean())\n# 求最大\nprint(ser2.max())\n# 求最小\nprint(ser2.min())\n# 计数\nprint(ser2.count())\n# 求标准差\nprint(ser2.std())\n# 求方差\nprint(ser2.var())\n# 求中位数\nprint(ser2.median())\n</code></pre>\n<p><code>Series</code>  对象还有一个名为 <code>describe()</code>  的方法，可以获得上述所有的描述性统计信息，如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser2.describe()\n</code></pre>\n<p>输出：</p>\n<pre><code>count      4.000000\nmean     475.000000\nstd       64.031242\nmin      380.000000\n25%      470.000000\n50%      500.000000\n75%      505.000000\nmax      520.000000\ndtype: float64\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>：因为 <code>describe()</code>  返回的也是一个 <code>Series</code>  对象，所以也可以用 <code>ser2.describe()['mean']</code>  来获取平均值。</p>\n</blockquote>\n<p>如果 <code>Series</code>  对象有重复的值，我们可以使用 <code>unique()</code>  方法获得去重之后的 <code>Series</code>  对象；可以使用 <code>nunique()</code>  方法统计不重复值的数量；如果想要统计每个值重复的次数，可以使用 <code>value_counts()</code>  方法，这个方法会返回一个 <code>Series</code>  对象，它的索引就是原来的 <code>Series</code>  对象中的值，而每个值出现的次数就是返回的 <code>Series</code>  对象中的数据，在默认情况下会按照出现次数做降序排列。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser3 = pd.Series(data=['apple', 'banana', 'apple', 'pitaya', 'apple', 'pitaya', 'durian'])\nser3.value_counts()\n</code></pre>\n<p>输出：</p>\n<pre><code>apple     3\npitaya    2\ndurian    1\nbanana    1\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser3.nunique()\n</code></pre>\n<p>输出：</p>\n<pre><code>4\n</code></pre>\n<h5 id=\"数据处理的方法\"><a class=\"anchor\" href=\"#数据处理的方法\">#</a> 数据处理的方法</h5>\n<p><code>Series</code>  对象的 <code>isnull()</code>  和 <code>notnull()</code>  方法可以用于空值的判断，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser4 = pd.Series(data=[10, 20, np.NaN, 30, np.NaN])\nser4.isnull()\n</code></pre>\n<p>输出：</p>\n<pre><code>0    False\n1    False\n2     True\n3    False\n4     True\ndtype: bool\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser4.notnull()\n</code></pre>\n<p>输出：</p>\n<pre><code>0     True\n1     True\n2    False\n3     True\n4    False\ndtype: bool\n</code></pre>\n<p><code>Series</code>  对象的 <code>dropna()</code>  和 <code>fillna()</code>  方法分别用来删除空值和填充空值，具体的用法如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser4.dropna()\n</code></pre>\n<p>输出：</p>\n<pre><code>0    10.0\n1    20.0\n3    30.0\ndtype: float64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 将空值填充为40\nser4.fillna(value=40)\n</code></pre>\n<p>输出：</p>\n<pre><code>0    10.0\n1    20.0\n2    40.0\n3    30.0\n4    40.0\ndtype: float64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># backfill或bfill表示用后一个元素的值填充空值\n# ffill或pad表示用前一个元素的值填充空值\nser4.fillna(method='ffill')\n</code></pre>\n<p>输出：</p>\n<pre><code>0    10.0\n1    20.0\n2    20.0\n3    30.0\n4    30.0\ndtype: float64\n</code></pre>\n<p>需要提醒大家注意的是， <code>dropna()</code>  和 <code>fillna()</code>  方法都有一个名为 <code>inplace</code>  的参数，它的默认值是 <code>False</code> ，表示删除空值或填充空值不会修改原来的 <code>Series</code>  对象，而是返回一个新的 <code>Series</code>  对象来表示删除或填充空值后的数据系列，如果将 <code>inplace</code>  参数的值修改为 <code>True</code> ，那么删除或填充空值会就地操作，直接修改原来的 <code>Series</code>  对象，那么方法的返回值是 <code>None</code> 。后面我们会接触到的很多方法，包括 <code>DataFrame</code>  对象的很多方法都会有这个参数，它们的意义跟这里是一样的。</p>\n<p><code>Series</code>  对象的 <code>mask()</code>  和 <code>where()</code>  方法可以将满足或不满足条件的值进行替换，如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser5 = pd.Series(range(5))\nser5.where(ser5 &gt; 0)\n</code></pre>\n<p>输出：</p>\n<pre><code>0    NaN\n1    1.0\n2    2.0\n3    3.0\n4    4.0\ndtype: float64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser5.where(ser5 &gt; 1, 10)\n</code></pre>\n<p>输出：</p>\n<pre><code>0    10\n1    10\n2     2\n3     3\n4     4\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser5.mask(ser5 &gt; 1, 10)\n</code></pre>\n<p>输出：</p>\n<pre><code>0     0\n1     1\n2    10\n3    10\n4    10\ndtype: int64\n</code></pre>\n<p><code>Series</code>  对象的 <code>duplicated()</code>  方法可以帮助我们找出重复的数据，而 <code>drop_duplicates()</code>  方法可以帮我们删除重复数据。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser3.duplicated()\n</code></pre>\n<p>输出：</p>\n<pre><code>0    False\n1    False\n2     True\n3    False\n4     True\n5     True\n6    False\ndtype: bool\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser3.drop_duplicates()\n</code></pre>\n<p>输出：</p>\n<pre><code>0     apple\n1    banana\n3    pitaya\n6    durian\ndtype: object\n</code></pre>\n<p><code>Series</code>  对象的 <code>apply()</code>  和 <code>map()</code>  方法非常重要，它们可以用于数据处理，把数据映射或转换成我们期望的样子，这个操作在数据分析的数据准备阶段非常重要。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser6 = pd.Series(['cat', 'dog', np.nan, 'rabbit'])\nser6\n</code></pre>\n<p>输出：</p>\n<pre><code>0       cat\n1       dog\n2       NaN\n3    rabbit\ndtype: object\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser6.map(&#123;'cat': 'kitten', 'dog': 'puppy'&#125;)\n</code></pre>\n<p>输出：</p>\n<pre><code>0    kitten\n1     puppy\n2       NaN\n3       NaN\ndtype: object\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser6.map('I am a &#123;&#125;'.format, na_action='ignore')\n</code></pre>\n<p>输出：</p>\n<pre><code>0       I am a cat\n1       I am a dog\n2              NaN\n3    I am a rabbit\ndtype: object\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser7 = pd.Series([20, 21, 12],  index=['London', 'New York', 'Helsinki'])\nser7\n</code></pre>\n<p>输出：</p>\n<pre><code>London      20\nNew York    21\nHelsinki    12\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser7.apply(np.square)\n</code></pre>\n<p>输出：</p>\n<pre><code>London      400\nNew York    441\nHelsinki    144\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser7.apply(lambda x, value: x - value, args=(5, ))\n</code></pre>\n<p>输出：</p>\n<pre><code>London      15\nNew York    16\nHelsinki     7\ndtype: int64\n</code></pre>\n<h5 id=\"排序和取头部值的方法\"><a class=\"anchor\" href=\"#排序和取头部值的方法\">#</a> 排序和取头部值的方法</h5>\n<p><code>Series</code>  对象的 <code>sort_index()</code>  和 <code>sort_values()</code>  方法可以用于对索引和数据的排序，排序方法有一个名为 <code>ascending</code>  的布尔类型参数，该参数用于控制排序的结果是升序还是降序；而名为 <code>kind</code>  的参数则用来控制排序使用的算法，默认使用了 <code>quicksort</code> ，也可以选择 <code>mergesort</code>  或 <code>heapsort</code> ；如果存在空值，那么可以用 <code>na_position</code>  参数空值放在最前还是最后，默认是 <code>last</code> ，代码如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">ser8 = pd.Series(\n    data=[35, 96, 12, 57, 25, 89], \nindex=['grape', 'banana', 'pitaya', 'apple', 'peach', 'orange']\n)\n# 按值从小到大排序\nser8.sort_values()\n</code></pre>\n<p>输出：</p>\n<pre><code>pitaya    12\npeach     25\ngrape     35\napple     57\norange    89\nbanana    96\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 按索引从大到小排序\nser8.sort_index(ascending=False)\n</code></pre>\n<p>输出：</p>\n<pre><code>pitaya    12\npeach     25\norange    89\ngrape     35\nbanana    96\napple     57\ndtype: int64\n</code></pre>\n<p>如果要从 <code>Series</code>  对象中找出元素中最大或最小的 “Top-N”，实际上是不需要对所有的值进行排序的，可以使用 <code>nlargest()</code>  和 <code>nsmallest()</code>  方法来完成，如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 值最大的3个\nser8.nlargest(3)\n</code></pre>\n<p>输出：</p>\n<pre><code>banana    96\norange    89\napple     57\ndtype: int64\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 值最小的2个\nser8.nsmallest(2)\n</code></pre>\n<p>输出：</p>\n<pre><code>pitaya    12\npeach     25\ndtype: int64\n</code></pre>\n<h4 id=\"绘制图表\"><a class=\"anchor\" href=\"#绘制图表\">#</a> 绘制图表</h4>\n<p>Series 对象有一个名为 <code>plot</code>  的方法可以用来生成图表，如果选择生成折线图、饼图、柱状图等，默认会使用 Series 对象的索引作为横坐标，使用 Series 对象的数据作为纵坐标。</p>\n<p>首先导入 <code>matplotlib</code>  中 <code>pyplot</code>  模块并进行必要的配置。</p>\n<pre><code class=\"language-Python\">import matplotlib.pyplot as plt\n\n# 配置支持中文的非衬线字体（默认的字体无法显示中文）\nplt.rcParams['font.sans-serif'] = ['SimHei', ]\n# 使用指定的中文字体时需要下面的配置来避免负号无法显示\nplt.rcParams['axes.unicode_minus'] = False\n</code></pre>\n<p>创建 <code>Series</code>  对象并绘制对应的柱状图。</p>\n<pre><code class=\"language-Python\">ser9 = pd.Series(&#123;'一季度': 400, '二季度': 520, '三季度': 180, '四季度': 380&#125;)\n# 通过Series对象的plot方法绘图（kind='bar'表示绘制柱状图）\nser9.plot(kind='bar', color=['r', 'g', 'b', 'y'])\n# x轴的坐标旋转到0度（中文水平显示）\nplt.xticks(rotation=0)\n# 在柱状图的柱子上绘制数字\nfor i in range(4):\n    plt.text(i, ser9[i] + 5, ser9[i], ha='center')\n# 显示图像\nplt.show()\n</code></pre>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20220619171513.png\" alt=\"\" /></p>\n<p>绘制反映每个季度占比的饼图。</p>\n<pre><code class=\"language-Python\"># autopct参数可以配置在饼图上显示每块饼的占比\nser9.plot(kind='pie', autopct='%.1f%%')\n# 设置y轴的标签（显示在饼图左侧的文字）\nplt.ylabel('各季度占比')\nplt.show()\n</code></pre>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20220619171503.png\" alt=\"\" /></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/69.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-2/",
            "url": "https://scottalive.github.io/computer-science/python/basic/69.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-2/",
            "title": "NumPy的应用-2",
            "date_published": "2025-04-23T22:07:49.000Z",
            "content_html": "<h2 id=\"numpy的应用-2\"><a class=\"anchor\" href=\"#numpy的应用-2\">#</a> NumPy 的应用 - 2</h2>\n<h3 id=\"数组的运算\"><a class=\"anchor\" href=\"#数组的运算\">#</a> 数组的运算</h3>\n<p>使用 NumPy 最为方便的是当需要对数组元素进行运算时，不用编写循环代码遍历每个元素，所有的运算都会自动的<strong>矢量化</strong>（使用高效的、提前编译的底层代码来对数据序列进行数学操作）。简单的说就是，NumPy 中的数学运算和数学函数会自动作用于数组中的每个成员。</p>\n<h4 id=\"数组跟标量的运算\"><a class=\"anchor\" href=\"#数组跟标量的运算\">#</a> 数组跟标量的运算</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array35 = np.arange(1, 10)\nprint(array35 + 10)\nprint(array35 * 10)\n</code></pre>\n<p>输出：</p>\n<pre><code>[11 12 13 14 15 16 17 18 19]\n[10 20 30 40 50 60 70 80 90]\n</code></pre>\n<h4 id=\"数组跟数组的运算\"><a class=\"anchor\" href=\"#数组跟数组的运算\">#</a> 数组跟数组的运算</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array36 = np.array([1, 1, 1, 2, 2, 2, 3, 3, 3])\nprint(array35 + array36)\nprint(array35 * array36)\nprint(array35 ** array36)\n</code></pre>\n<p>输出：</p>\n<pre><code>[ 2  3  4  6  7  8 10 11 12]\n[ 1  2  3  8 10 12 21 24 27]\n[  1   2   3  16  25  36 343 512 729]\n</code></pre>\n<h4 id=\"通用一元函数\"><a class=\"anchor\" href=\"#通用一元函数\">#</a> 通用一元函数</h4>\n<p>通用函数是对 <code>ndarray</code>  中的数据执行元素级运算的函数。你可以将其看做普通函数（接收一个标量值作为参数，返回一个标量值）的矢量化包装器，如下所示。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(np.sqrt(array35))\nprint(np.log2(array35))\n</code></pre>\n<p>输出：</p>\n<pre><code>[1.         1.41421356 1.73205081 2.         2.23606798 2.44948974\n 2.64575131 2.82842712 3.        ]\n[0.         1.         1.5849625  2.         2.32192809 2.5849625\n 2.80735492 3.         3.169925  ]\n</code></pre>\n<p><strong>表 1：通用一元函数</strong></p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>abs</code>  /  <code>fabs</code></td>\n<td>求绝对值的函数</td>\n</tr>\n<tr>\n<td><code>sqrt</code></td>\n<td>求平方根的函数，相当于 <code>array ** 0.5 </code></td>\n</tr>\n<tr>\n<td><code>square</code></td>\n<td>求平方的函数，相当于 <code>array ** 2</code></td>\n</tr>\n<tr>\n<td><code>exp</code></td>\n<td>计算<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding=\"application/x-tex\">e^x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.664392em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span></span></span> 的函数</td>\n</tr>\n<tr>\n<td><code>log</code>  /  <code>log10</code>  /  <code>log2</code></td>\n<td>对数函数（ <code>e</code>  为底 /  <code>10</code>  为底 /  <code>2</code>  为底）</td>\n</tr>\n<tr>\n<td><code>sign</code></td>\n<td>符号函数（ <code>1</code>  - 正数； <code>0</code>  - 零； <code>-1</code>  - 负数）</td>\n</tr>\n<tr>\n<td><code>ceil</code>  /  <code>floor</code></td>\n<td>上取整 /  下取整</td>\n</tr>\n<tr>\n<td><code>isnan</code></td>\n<td>返回布尔数组，NaN 对应 <code>True</code> ，非 NaN 对应 <code>False</code></td>\n</tr>\n<tr>\n<td><code>isfinite</code>  /  <code>isinf</code></td>\n<td>判断数值是否为无穷大的函数</td>\n</tr>\n<tr>\n<td><code>cos</code>  /  <code>cosh</code>  /  <code>sin</code></td>\n<td>三角函数</td>\n</tr>\n<tr>\n<td><code>sinh</code>  /  <code>tan</code>  /  <code>tanh</code></td>\n<td>三角函数</td>\n</tr>\n<tr>\n<td><code>arccos</code>  /  <code>arccosh</code>  /  <code>arcsin</code></td>\n<td>反三角函数</td>\n</tr>\n<tr>\n<td><code>arcsinh</code>  /  <code>arctan</code>  /  <code>arctanh</code></td>\n<td>反三角函数</td>\n</tr>\n<tr>\n<td><code>rint</code>  /  <code>round</code></td>\n<td>四舍五入函数</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"通用二元函数\"><a class=\"anchor\" href=\"#通用二元函数\">#</a> 通用二元函数</h4>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array37 = np.array([[4, 5, 6], [7, 8, 9]])\narray38 = np.array([[1, 2, 3], [3, 2, 1]])\nprint(array37 ** array38)\nprint(np.power(array37, array38))\n</code></pre>\n<p>输出：</p>\n<pre><code>[[  4  25 216]\n [343  64   9]]\n[[  4  25 216]\n [343  64   9]]\n</code></pre>\n<p><strong>表 2：通用二元函数</strong></p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>add(x, y)</code>  /  <code>substract(x, y)</code></td>\n<td>加法函数 / 减法函数</td>\n</tr>\n<tr>\n<td><code>multiply(x, y)</code>  /  <code>divide(x, y)</code></td>\n<td>乘法函数 / 除法函数</td>\n</tr>\n<tr>\n<td><code>floor_divide(x, y)</code>  /  <code>mod(x, y)</code></td>\n<td>整除函数 / 求模函数</td>\n</tr>\n<tr>\n<td><code>allclose(x, y)</code></td>\n<td>检查数组 <code>x</code>  和 <code>y</code>  元素是否几乎相等</td>\n</tr>\n<tr y_i=\"\">\n<td><code>power(x, y)</code></td>\n<td>数组<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的元素<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和数组<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 的元素<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，计算x_i^</td>\n</tr>\n<tr>\n<td><code>maximum(x, y)</code>  /  <code>fmax(x, y)</code></td>\n<td>两两比较元素获取最大值 / 获取最大值（忽略 NaN）</td>\n</tr>\n<tr>\n<td><code>minimum(x, y)</code>  /  <code>fmin(x, y)</code></td>\n<td>两两比较元素获取最小值 / 获取最小值（忽略 NaN）</td>\n</tr>\n<tr>\n<td><code>dot(x, y)</code></td>\n<td>点积运算（数量积，通常记为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding=\"application/x-tex\">\\cdots</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.31em;vertical-align:0em;\"></span><span class=\"minner\">⋯</span></span></span></span>，用于欧几里得空间（Euclidean space））</td>\n</tr>\n<tr>\n<td><code>inner(x, y)</code></td>\n<td>内积运算（内积的含义要高于点积，点积相当于是内积在欧几里得空间 $$ 的特例，而内积可以推广到<strong>赋范向量空间</strong>，只要它满足平行四边形法则即可）</td>\n</tr>\n<tr>\n<td><code>cross(x, y) </code></td>\n<td>叉积运算（向量积，通常记为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>×</mo></mrow><annotation encoding=\"application/x-tex\">\\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">×</span></span></span></span>，运算结果是一个向量）</td>\n</tr>\n<tr>\n<td><code>outer(x, y)</code></td>\n<td>外积运算（张量积，通常记为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⨂</mo></mrow><annotation encoding=\"application/x-tex\">\\bigotimes</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">⨂</span></span></span></span>，运算结果通常是一个矩阵）</td>\n</tr>\n<tr>\n<td><code>intersect1d(x, y)</code></td>\n<td>计算 <code>x</code>  和 <code>y</code>  的交集，返回这些元素构成的有序数组</td>\n</tr>\n<tr>\n<td><code>union1d(x, y)</code></td>\n<td>计算 <code>x</code>  和 <code>y</code>  的并集，返回这些元素构成的有序数组</td>\n</tr>\n<tr>\n<td><code>in1d(x, y)</code></td>\n<td>返回由判断 <code>x</code>  的元素是否在 <code>y</code>  中得到的布尔值构成的数组</td>\n</tr>\n<tr>\n<td><code>setdiff1d(x, y)</code></td>\n<td>计算 <code>x</code>  和 <code>y</code>  的差集，返回这些元素构成的数组</td>\n</tr>\n<tr>\n<td><code>setxor1d(x, y)</code></td>\n<td>计算 <code>x</code>  和 <code>y</code>  的对称差，返回这些元素构成的数组</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>补充说明</strong>：在二维空间内，两个向量<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>a</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>a</mi><mn>2</mn></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}=\\begin{bmatrix} a_1 \\\\ a_2 \\end{bmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.40003em;vertical-align:-0.95003em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">B</mi><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{B}=\\begin{bmatrix} b_1 \\\\ b_2 \\end{bmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\" style=\"margin-right:0.04835em;\">B</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.40003em;vertical-align:-0.95003em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span> 的叉积是这样定义的：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mo>×</mo><mi mathvariant=\"bold-italic\">B</mi><mo>=</mo><mrow><mo fence=\"true\">∣</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>a</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>b</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>b</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">∣</mo></mrow><mo>=</mo><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>2</mn></msub><mo>−</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}\\times \\boldsymbol{B}=\\begin{vmatrix} a_1 \\quad a_2 \\\\ b_1 \\quad b_2 \\end{vmatrix}=a_1b_2 - a_2b_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76944em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\" style=\"margin-right:0.04835em;\">B</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.42999em;vertical-align:-0.9500199999999999em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，其中<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo fence=\"true\">∣</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>a</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>b</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>b</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">∣</mo></mrow><annotation encoding=\"application/x-tex\">\\begin{vmatrix} a_1 \\quad a_2 \\\\ b_1 \\quad b_2 \\end{vmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.42999em;vertical-align:-0.9500199999999999em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span></span></span></span> 称为行列式。但是一定要注意，叉积并不等同于行列式，行列式的运算结果是一个标量，而叉积运算的结果是一个向量。如果不明白，我们可以看看三维空间两个向量，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>a</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>a</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>a</mi><mn>3</mn></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}=\\begin{bmatrix} a_1 \\\\ a_2 \\\\ a_3 \\end{bmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.6010299999999997em;vertical-align:-1.55002em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0510099999999998em;\"><span style=\"top:-2.2500000000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎣</span></span></span><span style=\"top:-2.8099900000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎢</span></span></span><span style=\"top:-4.05101em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎡</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.0099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-1.8099999999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5500000000000007em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0510099999999998em;\"><span style=\"top:-2.2500000000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎦</span></span></span><span style=\"top:-2.8099900000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎥</span></span></span><span style=\"top:-4.05101em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎤</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">B</mi><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msub><mi>b</mi><mn>3</mn></msub></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{B}=\\begin{bmatrix} b_1 \\\\ b_2 \\\\ b_3 \\end{bmatrix}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\" style=\"margin-right:0.04835em;\">B</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.6010299999999997em;vertical-align:-1.55002em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0510099999999998em;\"><span style=\"top:-2.2500000000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎣</span></span></span><span style=\"top:-2.8099900000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎢</span></span></span><span style=\"top:-4.05101em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎡</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.0099999999999993em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-1.8099999999999994em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5500000000000007em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0510099999999998em;\"><span style=\"top:-2.2500000000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎦</span></span></span><span style=\"top:-2.8099900000000004em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎥</span></span></span><span style=\"top:-4.05101em;\"><span class=\"pstrut\" style=\"height:3.1550000000000002em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎤</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55002em;\"><span></span></span></span></span></span></span></span></span></span></span> 的叉积是<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo fence=\"true\">&lt;</mo><mover accent=\"true\"><mi>i</mi><mo>^</mo></mover><mrow><mo fence=\"true\">∣</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mn>2</mn></msub><mspace width=\"1em\"/><msub><mi>a</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>b</mi><mn>2</mn></msub><mspace width=\"1em\"/><msub><mi>b</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">∣</mo></mrow><mo separator=\"true\">,</mo><mo>−</mo><mover accent=\"true\"><mi>j</mi><mo>^</mo></mover><mrow><mo fence=\"true\">∣</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>a</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>b</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>b</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">∣</mo></mrow><mo separator=\"true\">,</mo><mover accent=\"true\"><mi>k</mi><mo>^</mo></mover><mrow><mo fence=\"true\">∣</mo><mtable rowspacing=\"0.15999999999999992em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>a</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>b</mi><mn>1</mn></msub><mspace width=\"1em\"/><msub><mi>b</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">∣</mo></mrow><mo fence=\"true\">&gt;</mo></mrow><annotation encoding=\"application/x-tex\">\\left&lt; \\hat{i} \\begin{vmatrix} a_2 \\quad a_3 \\\\ b_2 \\quad b_3 \\end{vmatrix}, -\\hat{j} \\begin{vmatrix} a_1 \\quad a_3 \\\\ b_1 \\quad b_3 \\end{vmatrix}, \\hat{k} \\begin{vmatrix} a_1 \\quad a_2 \\\\ b_1 \\quad b_2 \\end{vmatrix} \\right&gt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.43em;vertical-align:-0.95003em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">⟨</span></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.92296em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span></span></span><span style=\"top:-3.22852em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">−</span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.92296em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span><span style=\"top:-3.22852em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9578799999999998em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">⟩</span></span></span></span></span></span>，其中<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>i</mi><mo>^</mo></mover><mo separator=\"true\">,</mo><mover accent=\"true\"><mi>j</mi><mo>^</mo></mover><mo separator=\"true\">,</mo><mover accent=\"true\"><mi>k</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{i}, \\hat{j}, \\hat{k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1523199999999998em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.92296em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span></span></span><span style=\"top:-3.22852em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.92296em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span><span style=\"top:-3.22852em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9578799999999998em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.26344em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">^</span></span></span></span></span></span></span></span></span></span> 代表每个维度的单位向量。</p>\n</blockquote>\n<h4 id=\"广播机制\"><a class=\"anchor\" href=\"#广播机制\">#</a> 广播机制</h4>\n<p>上面的例子中，两个二元运算的数组形状是完全相同的，我们再来研究一下，两个形状不同的数组是否可以直接做二元运算或使用二元函数进行运算，请看下面的例子。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array39 = np.array([[0, 0, 0], [1, 1, 1], [2, 2, 2], [3, 3, 3]])\narray40 = np.array([1, 2, 3])\narray39 + array40\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 2, 3],\n       [2, 3, 4],\n       [3, 4, 5],\n       [4, 5, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array41 = np.array([[1], [2], [3], [4]])\narray39 + array41\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 1, 1],\n       [3, 3, 3],\n       [5, 5, 5],\n       [7, 7, 7]])\n</code></pre>\n<p>通过上面的例子，我们发现形状不同的数组仍然有机会进行二元运算，但也绝对不是任意的数组都可以进行二元运算。简单的说，只有两个数组后缘维度相同或者其中一个数组后缘维度为 1 时，广播机制会被触发，而通过广播机制如果能够使两个数组的形状一致，才能进行二元运算。所谓后缘维度，指的是数组 <code>shape</code>  属性对应的元组中最后一个元素的值（从后往前数最后一个维度的值），例如，我们之前打开的图像对应的数组后缘维度为 3，3 行 4 列的二维数组后缘维度为 4，而有 5 个元素的一维数组后缘维度为 5。简单的说就是，后缘维度相同或者其中一个数组的后缘维度为 1，就可以应用广播机制；而广播机制如果能够使得数组的形状一致，就满足了两个数组对应元素做运算的需求，如下图所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115640.png\" alt=\"\" /></p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115658.png\" alt=\"\" /></p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115800.png\" alt=\"\" /></p>\n<h3 id=\"其他常用函数\"><a class=\"anchor\" href=\"#其他常用函数\">#</a> 其他常用函数</h3>\n<p>除了上面讲到的函数外，NumPy 中还提供了很多用于处理数组的函数， <code>ndarray</code>  对象的很多方法也可以通过直接调用函数来实现，下表给出了一些常用的函数。</p>\n<p><strong>表 3：NumPy 其他常用函数</strong></p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>unique</code></td>\n<td>去除数组重复元素，返回唯一元素构成的有序数组</td>\n</tr>\n<tr>\n<td><code>copy</code></td>\n<td>返回拷贝数组得到的数组</td>\n</tr>\n<tr>\n<td><code>sort</code></td>\n<td>返回数组元素排序后的拷贝</td>\n</tr>\n<tr>\n<td><code>split</code>  /  <code>hsplit</code>  /  <code>vsplit</code></td>\n<td>将数组拆成若干个子数组</td>\n</tr>\n<tr>\n<td><code>stack</code>  /  <code>hstack</code>  /  <code>vstack</code></td>\n<td>将多个数组堆叠成新数组</td>\n</tr>\n<tr>\n<td><code>concatenate</code></td>\n<td>沿着指定的轴连接多个数组构成新数组</td>\n</tr>\n<tr>\n<td><code>append</code>  /  <code>insert</code></td>\n<td>向数组末尾追加元素 / 在数组指定位置插入元素</td>\n</tr>\n<tr>\n<td><code>argwhere</code></td>\n<td>找出数组中非 0 元素的位置</td>\n</tr>\n<tr>\n<td><code>extract</code>  /  <code>select</code>  /  <code>where</code></td>\n<td>按照指定的条件从数组中抽取或处理数组元素</td>\n</tr>\n<tr>\n<td><code>flip</code></td>\n<td>沿指定的轴翻转数组中的元素</td>\n</tr>\n<tr>\n<td><code>fromiter</code></td>\n<td>通过迭代器创建数组对象</td>\n</tr>\n<tr>\n<td><code>fromregex</code></td>\n<td>通过读取文件和正则表达式解析获取数据创建数组对象</td>\n</tr>\n<tr>\n<td><code>repeat</code>  /  <code>tile</code></td>\n<td>通过对元素的重复来创建新数组</td>\n</tr>\n<tr>\n<td><code>roll</code></td>\n<td>沿指定轴对数组元素进行移位</td>\n</tr>\n<tr>\n<td><code>resize</code></td>\n<td>重新调整数组的大小</td>\n</tr>\n<tr>\n<td><code>place</code>  /  <code>put</code></td>\n<td>将数组中满足条件的元素 / 指定的元素替换为指定的值</td>\n</tr>\n<tr>\n<td><code>partition</code></td>\n<td>用选定的元素对数组进行一次划分并返回划分后的数组</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>提示</strong>：上面的 <code>resize</code>  函数和 <code>ndarray</code>  对象的 <code>resize</code>  方法是有区别的， <code>resize</code>  函数在调整数组大小时会重复数组中的元素作为填补多出来的元素的值，而 <code>ndarry</code>  对象的 <code>resize</code>  方法是用 0 来填补多出来的元素。这些小细节不清楚暂时也不要紧，但是如果用到对应的功能了就要引起注意。</p>\n</blockquote>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array42 = np.array([[1, 1, 1], [2, 2, 2], [3, 3, 3]])\narray43 = np.array([[4, 4, 4], [5, 5, 5], [6, 6, 6]])\nnp.hstack((array42, array43))\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 1, 1, 4, 4, 4],\n       [2, 2, 2, 5, 5, 5],\n       [3, 3, 3, 6, 6, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">np.vstack((array42, array43))\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 1, 1],\n       [2, 2, 2],\n       [3, 3, 3],\n       [4, 4, 4],\n       [5, 5, 5],\n       [6, 6, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">np.concatenate((array42, array43))\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 1, 1],\n       [2, 2, 2],\n       [3, 3, 3],\n       [4, 4, 4],\n       [5, 5, 5],\n       [6, 6, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">np.concatenate((array42, array43), axis=1)\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 1, 1, 4, 4, 4],\n       [2, 2, 2, 5, 5, 5],\n       [3, 3, 3, 6, 6, 6]])\n</code></pre>\n<h3 id=\"矩阵运算\"><a class=\"anchor\" href=\"#矩阵运算\">#</a> 矩阵运算</h3>\n<p>NumPy 中提供了专门用于线性代数（linear algebra）的模块和表示矩阵的类型 <code>matrix</code> ，当然我们通过二维数组也可以表示一个矩阵，官方并不推荐使用 <code>matrix</code>  类而是建议使用二维数组，而且有可能在将来的版本中会移除 <code>matrix</code>  类。无论如何，利用这些已经封装好的类和函数，我们可以轻松愉快的实现线性代数中很多的操作。</p>\n<h4 id=\"线性代数快速回顾\"><a class=\"anchor\" href=\"#线性代数快速回顾\">#</a> 线性代数快速回顾</h4>\n<ol>\n<li><strong>向量</strong>也叫<strong>矢量</strong>，是一个同时具有大小和方向，且满足平行四边形法则的几何对象。与向量相对的概念叫<strong>标量</strong>或<strong>数量</strong>，标量只有大小、绝大多数情况下没有方向。</li>\n<li>向量可以进行<strong>加</strong>、<strong>减</strong>、<strong>数乘</strong>、<strong>点积</strong>、<strong>叉积</strong>等运算。</li>\n<li><strong>行列式</strong>由向量组成，它的性质可以由向量解释。</li>\n<li>行列式可以使用<strong>行列式公式</strong>计算：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi mathvariant=\"bold-italic\">A</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>n</mi><mo stretchy=\"false\">!</mo></mrow></msub><mo>±</mo><mrow><msub><mi>a</mi><mrow><mn>1</mn><mi>α</mi></mrow></msub><msub><mi>a</mi><mrow><mn>2</mn><mi>β</mi></mrow></msub><mo>⋯</mo><msub><mi>a</mi><mrow><mi>n</mi><mi>ω</mi></mrow></msub></mrow></mrow><annotation encoding=\"application/x-tex\">det(\\boldsymbol{A})=\\sum_{n!} \\pm {a_{1\\alpha}a_{2\\beta} \\cdots a_{n\\omega}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0497100000000001em;vertical-align:-0.29971000000000003em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1863979999999999em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mclose mtight\">!</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">±</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05278em;\">β</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">ω</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>。</li>\n<li>高阶行列式可以用<strong>代数余子式</strong>展开成多个低阶行列式，如：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi mathvariant=\"bold-italic\">A</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>a</mi><mn>11</mn></msub><msub><mi>C</mi><mn>11</mn></msub><mo>+</mo><msub><mi>a</mi><mn>12</mn></msub><msub><mi>C</mi><mn>12</mn></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub><msub><mi>C</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">det(\\boldsymbol{A})=a_{11}C_{11}+a_{12}C_{12}+ \\cdots +a_{1n}C_{1n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</li>\n<li><strong>矩阵</strong>是由一系列元素排成的矩形阵列，矩阵里的元素可以是数字、符号或数学公式。</li>\n<li>矩阵可以进行<strong>加法</strong>、<strong>减法</strong>、<strong>数乘</strong>、<strong>乘法</strong>、<strong>转置</strong>等运算。</li>\n<li><strong>逆矩阵</strong>用<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi><msup><mi mathvariant=\"bold-italic\">A</mi><mrow><mo mathvariant=\"bold-italic\">−</mo><mn mathvariant=\"bold\">1</mn></mrow></msup></mi></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A^{-1}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999998em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999998em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbf mtight\">−</span><span class=\"mord mathbf mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span></span> 表示，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mi><msup><mi mathvariant=\"bold-italic\">A</mi><mrow><mo mathvariant=\"bold-italic\">−</mo><mn mathvariant=\"bold\">1</mn></mrow></msup></mi><mo>=</mo><mi><msup><mi mathvariant=\"bold-italic\">A</mi><mrow><mo mathvariant=\"bold-italic\">−</mo><mn mathvariant=\"bold\">1</mn></mrow></msup></mi><mi mathvariant=\"bold-italic\">A</mi><mo>=</mo><mi mathvariant=\"bold-italic\">I</mi></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}\\boldsymbol{A^{-1}}=\\boldsymbol{A^{-1}}\\boldsymbol{A}=\\boldsymbol{I}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999998em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999998em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbf mtight\">−</span><span class=\"mord mathbf mtight\">1</span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999998em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999998em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathbf mtight\">−</span><span class=\"mord mathbf mtight\">1</span></span></span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\" style=\"margin-right:0.07778em;\">I</span></span></span></span></span></span>；没有逆矩阵的方阵是<strong>奇异矩阵</strong>。</li>\n<li>如果一个方阵是<strong>满秩矩阵</strong> (矩阵的秩等于矩阵的阶数)，该方阵对应的线性方程有唯一解。</li>\n</ol>\n<blockquote>\n<p><strong>说明</strong>：<strong>矩阵的秩</strong>是指矩阵中线性无关的行 / 列向量的最大个数，同时也是矩阵对应的线性变换的像空间的维度。</p>\n</blockquote>\n<h4 id=\"numpy中矩阵相关函数\"><a class=\"anchor\" href=\"#numpy中矩阵相关函数\">#</a> NumPy 中矩阵相关函数</h4>\n<ol>\n<li>\n<p>创建矩阵对象。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># matrix构造函数可以传入类数组对象也可以传入字符串\nm1 = np.matrix('1 2 3; 4 5 6')\nm1\n</code></pre>\n<p>输出：</p>\n<pre><code>matrix([[1, 2, 3],\n        [4, 5, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># asmatrix函数也可以写成mat函数，它们其实是同一个函数\nm2 = np.asmatrix(np.array([[1, 1], [2, 2], [3, 3]]))\nm2\n</code></pre>\n<p>输出：</p>\n<pre><code>matrix([[1, 1],\n        [2, 2],\n        [3, 3]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">m1 * m2\n</code></pre>\n<p>输出：</p>\n<pre><code>matrix([[14, 14],\n        [32, 32]])\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：注意 <code>matrix</code>  对象和 <code>ndarray</code>  对象乘法运算的差别，如果两个二维数组要做矩阵乘法运算，应该使用 <code>@</code> 运算符或 <code>matmul</code>  函数，而不是 <code>*</code>  运算符。</p>\n</blockquote>\n</li>\n<li>\n<p>矩阵对象的属性。</p>\n<p>| 属性    | 说明                                      |<br />\n| ------- | ----------------------------------------- |<br />\n|  <code>A</code>      | 获取矩阵对象对应的 <code>ndarray</code>  对象           |<br />\n|  <code>A1</code>     | 获取矩阵对象对应的扁平化后的 <code>ndarray</code>  对象 |<br />\n|  <code>I</code>      | 可逆矩阵的逆矩阵                          |<br />\n|  <code>T</code>      | 矩阵的转置                                |<br />\n|  <code>H</code>      | 矩阵的共轭转置                            |<br />\n|  <code>shape</code>  | 矩阵的形状                                |<br />\n|  <code>size</code>   | 矩阵元素的个数                            |</p>\n</li>\n<li>\n<p>矩阵对象的方法。</p>\n</li>\n</ol>\n<p>矩阵对象的方法跟之前讲过的 <code>ndarray</code>  数组对象的方法基本差不多，此处不再进行赘述。</p>\n<h4 id=\"numpy的线性代数模块\"><a class=\"anchor\" href=\"#numpy的线性代数模块\">#</a> NumPy 的线性代数模块</h4>\n<p>NumPy 的 <code>linalg</code>  模块中有一组标准的矩阵分解运算以及诸如求逆和行列式之类的函数，它们跟 MATLAB 和 R 等语言所使用的是相同的行业标准线性代数库，下面的表格列出了 <code>numpy</code>  以及 <code>linalg</code>  模块中常用的跟线性代数相关的函数。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>diag</code></td>\n<td>以一维数组的形式返回方阵的对角线元素或将一维数组转换为方阵（非对角元素元素为 0）</td>\n</tr>\n<tr>\n<td><code>vdot</code></td>\n<td>向量的点积</td>\n</tr>\n<tr>\n<td><code>dot</code></td>\n<td>数组的点积</td>\n</tr>\n<tr>\n<td><code>inner</code></td>\n<td>数组的内积</td>\n</tr>\n<tr>\n<td><code>outer</code></td>\n<td>数组的叉积</td>\n</tr>\n<tr>\n<td><code>trace</code></td>\n<td>计算对角线元素的和</td>\n</tr>\n<tr>\n<td><code>norm</code></td>\n<td>求模（范数）运算</td>\n</tr>\n<tr>\n<td><code>det</code></td>\n<td>计算行列式的值（在方阵上计算会得到一个标量）</td>\n</tr>\n<tr>\n<td><code>matrix_rank</code></td>\n<td>计算矩阵的秩</td>\n</tr>\n<tr>\n<td><code>eig</code></td>\n<td>计算矩阵的特征值（eigenvalue）和特征向量（eigenvector）</td>\n</tr>\n<tr>\n<td><code>inv</code></td>\n<td>计算非奇异矩阵（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 阶方阵）的逆矩阵</td>\n</tr>\n<tr>\n<td><code>pinv</code></td>\n<td>计算矩阵的摩尔 - 彭若斯（Moore-Penrose）广义逆</td>\n</tr>\n<tr>\n<td><code>qr</code></td>\n<td>QR 分解（把矩阵分解成一个正交矩阵与一个上三角矩阵的积）</td>\n</tr>\n<tr>\n<td><code>svd</code></td>\n<td>计算奇异值分解（singular value decomposition）</td>\n</tr>\n<tr>\n<td><code>solve</code></td>\n<td>解线性方程组<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mi mathvariant=\"bold-italic\">x</mi><mo>=</mo><mi mathvariant=\"bold-italic\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}\\boldsymbol{x}=\\boldsymbol{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">x</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">b</span></span></span></span></span></span>，其中<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span></span></span></span> 是一个方阵</td>\n</tr>\n<tr>\n<td><code>lstsq</code></td>\n<td>计算<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold-italic\">A</mi><mi mathvariant=\"bold-italic\">x</mi><mo>=</mo><mi mathvariant=\"bold-italic\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\boldsymbol{A}\\boldsymbol{x}=\\boldsymbol{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68611em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">A</span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">x</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord boldsymbol\">b</span></span></span></span></span></span> 的最小二乘解</td>\n</tr>\n</tbody>\n</table>\n<p>大家如果有兴趣可以用下面的代码验证上面的函数。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">m3 = np.array([[1., 2.], [3., 4.]])\nnp.linalg.inv(m3)\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[-2. ,  1. ],\n       [ 1.5, -0.5]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">m4 = np.array([[1, 3, 5], [2, 4, 6], [4, 7, 9]])\nnp.linalg.det(m4)\n</code></pre>\n<p>输出：</p>\n<pre><code>2\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 解线性方程组ax=b\n# 3*x1 + x2= 9，x1 + 2*x2 = 8\na = np.array([[3,1], [1,2]])\nb = np.array([9, 8])\nnp.linalg.solve(a, b)\n</code></pre>\n<p>输出：</p>\n<pre><code>array([2., 3.])\n</code></pre>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/68.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-1/",
            "url": "https://scottalive.github.io/computer-science/python/basic/68.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-1/",
            "title": "NumPy的应用-1",
            "date_published": "2025-04-23T21:07:49.000Z",
            "content_html": "<h2 id=\"numpy的应用-1\"><a class=\"anchor\" href=\"#numpy的应用-1\">#</a> NumPy 的应用 - 1</h2>\n<p>Numpy 是一个开源的 Python 科学计算库，<strong>用于快速处理任意维度的数组</strong>。Numpy <strong>支持常见的数组和矩阵操作</strong>，对于同样的数值计算任务，使用 NumPy 不仅代码要简洁的多，而且 NumPy 的性能远远优于原生 Python，基本是一个到两个数量级的差距，而且数据量越大，NumPy 的优势就越明显。</p>\n<p>Numpy 最为核心的数据类型是 <code>ndarray</code> ，使用 <code>ndarray</code>  可以处理一维、二维和多维数组，该对象相当于是一个快速而灵活的大数据容器。NumPy 底层代码使用 C 语言编写，解决了 GIL 的限制， <code>ndarray</code>  在存取数据的时候，数据与数据的地址都是连续的，这确保了可以进行高效率的批量操作，远远优于 Python 中的 <code>list</code> ；另一方面 <code>ndarray</code>  对象提供了更多的方法来处理数据，尤其是和统计相关的方法，这些方法也是 Python 原生的 <code>list</code>  没有的。</p>\n<h3 id=\"准备工作\"><a class=\"anchor\" href=\"#准备工作\">#</a> 准备工作</h3>\n<ol>\n<li>\n<p>启动 Notebook</p>\n<pre><code class=\"language-Bash\">jupyter notebook\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>：在启动 Notebook 之前，建议先安装好数据分析相关依赖项，包括之前提到的三大神器以及相关依赖项，包括： <code>numpy</code> 、 <code>pandas</code> 、 <code>matplotlib</code> 、 <code>openpyxl</code>  等。如果使用 Anaconda，则无需单独安装。</p>\n</blockquote>\n</li>\n<li>\n<p>导入</p>\n<pre><code class=\"language-Python\">import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：如果已经启动了 Notebook 但尚未安装相关依赖库，例如尚未安装 <code>numpy</code> ，可以在 Notebook 的单元格中输入 <code>!pip install numpy</code>  并运行该单元格来安装 NumPy，也可以一次性安装多个三方库，需要在单元格中输入 <code>%pip install numpy pandas matplotlib</code> 。注意上面的代码，我们不仅导入了 NumPy，还将 pandas 和 matplotlib 库一并导入了。</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"创建数组对象\"><a class=\"anchor\" href=\"#创建数组对象\">#</a> 创建数组对象</h3>\n<p>创建 <code>ndarray</code>  对象有很多种方法，下面就如何创建一维数组、二维数组和多维数组进行说明。</p>\n<h4 id=\"一维数组\"><a class=\"anchor\" href=\"#一维数组\">#</a> 一维数组</h4>\n<ul>\n<li>\n<p>方法一：使用 <code>array</code>  函数，通过 <code>list</code>  创建数组对象</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array1 = np.array([1, 2, 3, 4, 5])\narray1\n</code></pre>\n<p>输出：</p>\n<pre><code>array([1, 2, 3, 4, 5])\n</code></pre>\n</li>\n<li>\n<p>方法二：使用 <code>arange</code>  函数，指定取值范围创建数组对象</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array2 = np.arange(0, 20, 2)\narray2\n</code></pre>\n<p>输出：</p>\n<pre><code>array([ 0,  2,  4,  6,  8, 10, 12, 14, 16, 18])\n</code></pre>\n</li>\n<li>\n<p>方法三：使用 <code>linspace</code>  函数，用指定范围均匀间隔的数字创建数组对象</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array3 = np.linspace(-5, 5, 101)\narray3\n</code></pre>\n<p>输出：</p>\n<pre><code>array([-5. , -4.9, -4.8, -4.7, -4.6, -4.5, -4.4, -4.3, -4.2, -4.1, -4. ,\n       -3.9, -3.8, -3.7, -3.6, -3.5, -3.4, -3.3, -3.2, -3.1, -3. , -2.9,\n       -2.8, -2.7, -2.6, -2.5, -2.4, -2.3, -2.2, -2.1, -2. , -1.9, -1.8,\n       -1.7, -1.6, -1.5, -1.4, -1.3, -1.2, -1.1, -1. , -0.9, -0.8, -0.7,\n       -0.6, -0.5, -0.4, -0.3, -0.2, -0.1,  0. ,  0.1,  0.2,  0.3,  0.4,\n        0.5,  0.6,  0.7,  0.8,  0.9,  1. ,  1.1,  1.2,  1.3,  1.4,  1.5,\n        1.6,  1.7,  1.8,  1.9,  2. ,  2.1,  2.2,  2.3,  2.4,  2.5,  2.6,\n        2.7,  2.8,  2.9,  3. ,  3.1,  3.2,  3.3,  3.4,  3.5,  3.6,  3.7,\n        3.8,  3.9,  4. ,  4.1,  4.2,  4.3,  4.4,  4.5,  4.6,  4.7,  4.8,\n        4.9,  5. ])\n</code></pre>\n</li>\n<li>\n<p>方法四：使用 <code>numpy.random</code>  模块的函数生成随机数创建数组对象</p>\n<p>产生 10 个<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 范围的随机小数，代码：</p>\n<pre><code class=\"language-Python\">array4 = np.random.rand(10)\narray4\n</code></pre>\n<p>输出：</p>\n<pre><code>array([0.45556132, 0.67871326, 0.4552213 , 0.96671509, 0.44086463,\n       0.72650875, 0.79877188, 0.12153022, 0.24762739, 0.6669852 ])\n</code></pre>\n<p>产生 10 个<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>100</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[1, 100)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span> 范围的随机整数，代码：</p>\n<pre><code class=\"language-Python\">array5 = np.random.randint(1, 100, 10)\narray5\n</code></pre>\n<p>输出：</p>\n<pre><code>array([29, 97, 87, 47, 39, 19, 71, 32, 79, 34])\n</code></pre>\n<p>产生 20 个<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>50</mn></mrow><annotation encoding=\"application/x-tex\">\\mu=50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding=\"application/x-tex\">\\sigma=10</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span> 的正态分布随机数，代码：</p>\n<pre><code class=\"language-Python\">array6 = np.random.normal(50, 10, 20)\narray6\n</code></pre>\n<p>输出：</p>\n<pre><code>array([55.04155586, 46.43510797, 20.28371158, 62.67884053, 61.23185964,\n       38.22682148, 53.17126151, 43.54741592, 36.11268017, 40.94086676,\n       63.27911699, 46.92688903, 37.1593374 , 67.06525656, 67.47269463,\n       23.37925889, 31.45312239, 48.34532466, 55.09180924, 47.95702787])\n</code></pre>\n</li>\n</ul>\n<blockquote>\n<p><strong>说明</strong>：创建一维数组还有很多其他的方式，比如通过读取字符串、读取文件、解析正则表达式等方式，这里我们暂不讨论这些方式，有兴趣的读者可以自行研究。</p>\n</blockquote>\n<h4 id=\"二维数组\"><a class=\"anchor\" href=\"#二维数组\">#</a> 二维数组</h4>\n<ul>\n<li>\n<p>方法一：使用 <code>array</code>  函数，通过嵌套的 <code>list</code>  创建数组对象</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array7 = np.array([[1, 2, 3], [4, 5, 6]])\narray7\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 2, 3],\n       [4, 5, 6]])\n</code></pre>\n</li>\n<li>\n<p>方法二：使用 <code>zeros</code> 、 <code>ones</code> 、 <code>full</code>  函数指定数组的形状创建数组对象</p>\n<p>使用 <code>zeros</code>  函数，代码：</p>\n<pre><code class=\"language-Python\">array8 = np.zeros((3, 4))\narray8\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[0., 0., 0., 0.],\n       [0., 0., 0., 0.],\n       [0., 0., 0., 0.]])\n</code></pre>\n<p>使用 <code>ones</code>  函数，代码：</p>\n<pre><code class=\"language-Python\">array9 = np.ones((3, 4))\narray9\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1., 1., 1., 1.],\n       [1., 1., 1., 1.],\n       [1., 1., 1., 1.]])\n</code></pre>\n<p>使用 <code>full</code>  函数，代码：</p>\n<pre><code class=\"language-Python\">array10 = np.full((3, 4), 10)\narray10\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[10, 10, 10, 10],\n       [10, 10, 10, 10],\n       [10, 10, 10, 10]])\n</code></pre>\n</li>\n<li>\n<p>方法三：使用 eye 函数创建单位矩阵</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array11 = np.eye(4)\narray11\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1., 0., 0., 0.],\n       [0., 1., 0., 0.],\n       [0., 0., 1., 0.],\n       [0., 0., 0., 1.]])\n</code></pre>\n</li>\n<li>\n<p>方法四：通过 <code>reshape</code>  将一维数组变成二维数组</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array12 = np.array([1, 2, 3, 4, 5, 6]).reshape(2, 3)\narray12\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 2, 3],\n       [4, 5, 6]])\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>： <code>reshape</code>  是 <code>ndarray</code>  对象的一个方法，使用 <code>reshape</code>  方法时需要确保调形后的数组元素个数与调形前数组元素个数保持一致，否则将会产生异常。</p>\n</blockquote>\n</li>\n<li>\n<p>方法五：通过 <code>numpy.random</code>  模块的函数生成随机数创建数组对象</p>\n<p>产生<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 范围的随机小数构成的 3 行 4 列的二维数组，代码：</p>\n<pre><code class=\"language-Python\">array13 = np.random.rand(3, 4)\narray13\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[0.54017809, 0.46797771, 0.78291445, 0.79501326],\n       [0.93973783, 0.21434806, 0.03592874, 0.88838892],\n       [0.84130479, 0.3566601 , 0.99935473, 0.26353598]])\n</code></pre>\n<p>产生<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>100</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[1, 100)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span> 范围的随机整数构成的 3 行 4 列的二维数组，代码：</p>\n<pre><code class=\"language-Python\">array14 = np.random.randint(1, 100, (3, 4))\narray14\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[83, 30, 64, 53],\n       [39, 92, 53, 43],\n       [43, 48, 91, 72]])\n</code></pre>\n</li>\n</ul>\n<h4 id=\"多维数组\"><a class=\"anchor\" href=\"#多维数组\">#</a> 多维数组</h4>\n<ul>\n<li>\n<p>使用随机的方式创建多维数组</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array15 = np.random.randint(1, 100, (3, 4, 5))\narray15\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[[94, 26, 49, 24, 43],\n        [27, 27, 33, 98, 33],\n        [13, 73,  6,  1, 77],\n        [54, 32, 51, 86, 59]],\n\n       [[62, 75, 62, 29, 87],\n        [90, 26,  6, 79, 41],\n        [31, 15, 32, 56, 64],\n        [37, 84, 61, 71, 71]],\n\n       [[45, 24, 78, 77, 41],\n        [75, 37,  4, 74, 93],\n        [ 1, 36, 36, 60, 43],\n        [23, 84, 44, 89, 79]]])\n</code></pre>\n</li>\n<li>\n<p>将一维二维的数组调形为多维数组</p>\n<p>一维数组调形为多维数组，代码：</p>\n<pre><code class=\"language-Python\">array16 = np.arange(1, 25).reshape((2, 3, 4))\narray16\n</code></pre>\n<p>输出：</p>\n<pre><code class=\"language-Python\">array([[[ 1,  2,  3,  4],\n        [ 5,  6,  7,  8],\n        [ 9, 10, 11, 12]],\n\n       [[13, 14, 15, 16],\n        [17, 18, 19, 20],\n        [21, 22, 23, 24]]])\n</code></pre>\n<p>二维数组调形为多维数组，代码：</p>\n<pre><code class=\"language-Python\">array17 = np.random.randint(1, 100, (4, 6)).reshape((4, 3, 2))\narray17\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[[60, 59],\n        [31, 80],\n        [54, 91]],\n\n       [[67,  4],\n        [ 4, 59],\n        [47, 49]],\n\n       [[16,  4],\n        [ 5, 71],\n        [80, 53]],\n\n       [[38, 49],\n        [70,  5],\n        [76, 80]]])\n</code></pre>\n</li>\n<li>\n<p>读取图片获得对应的三维数组</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array18 = plt.imread('guido.jpg')\narray18\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[[ 36,  33,  28],\n        [ 36,  33,  28],\n        [ 36,  33,  28],\n        ...,\n        [ 32,  31,  29],\n        [ 32,  31,  27],\n        [ 31,  32,  26]],\n\n       [[ 37,  34,  29],\n        [ 38,  35,  30],\n        [ 38,  35,  30],\n        ...,\n        [ 31,  30,  28],\n        [ 31,  30,  26],\n        [ 30,  31,  25]],\n\n       [[ 38,  35,  30],\n        [ 38,  35,  30],\n        [ 38,  35,  30],\n        ...,\n        [ 30,  29,  27],\n        [ 30,  29,  25],\n        [ 29,  30,  25]],\n\n       ...,\n\n       [[239, 178, 123],\n        [237, 176, 121],\n        [235, 174, 119],\n        ...,\n        [ 78,  68,  56],\n        [ 75,  67,  54],\n        [ 73,  65,  52]],\n\n       [[238, 177, 120],\n        [236, 175, 118],\n        [234, 173, 116],\n        ...,\n        [ 82,  70,  58],\n        [ 78,  68,  56],\n        [ 75,  66,  51]],\n\n       [[238, 176, 119],\n        [236, 175, 118],\n        [234, 173, 116],\n        ...,\n        [ 84,  70,  61],\n        [ 81,  69,  57],\n        [ 79,  67,  53]]], dtype=uint8)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码读取了当前路径下名为 <code>guido.jpg</code>  的图片文件，计算机系统中的图片通常由若干行若干列的像素点构成，而每个像素点又是由红绿蓝三原色构成的，所以能够用三维数组来表示。读取图片用到了 <code>matplotlib</code>  库的 <code>imread</code>  函数。</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"数组对象的属性\"><a class=\"anchor\" href=\"#数组对象的属性\">#</a> 数组对象的属性</h3>\n<ol>\n<li>\n<p><code>size</code>  属性：数组元素个数</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array19 = np.arange(1, 100, 2)\narray20 = np.random.rand(3, 4)\nprint(array19.size, array20.size)\n</code></pre>\n<p>输出：</p>\n<pre><code>50 12\n</code></pre>\n</li>\n<li>\n<p><code>shape</code>  属性：数组的形状</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array19.shape, array20.shape)\n</code></pre>\n<p>输出：</p>\n<pre><code>(50,) (3, 4)\n</code></pre>\n</li>\n<li>\n<p><code>dtype</code>  属性：数组元素的数据类型</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array19.dtype, array20.dtype)\n</code></pre>\n<p>输出：</p>\n<pre><code>int64 float64\n</code></pre>\n<p><code>ndarray</code>  对象元素的数据类型可以参考如下所示的表格。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL215cGljLzIwMjExMDA1MTE0ODEzLnBuZw==\">https://github.com/mypic/20211005114813.png</span>&quot; width=&quot;85%&quot;&gt;</p>\n</li>\n<li>\n<p><code>ndim</code>  属性：数组的维度</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array19.ndim, array20.ndim)\n</code></pre>\n<p>输出：</p>\n<pre><code>1 2\n</code></pre>\n</li>\n<li>\n<p><code>itemsize</code>  属性：数组单个元素占用内存空间的字节数</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array21 = np.arange(1, 100, 2, dtype=np.int8)\nprint(array19.itemsize, array20.itemsize, array21.itemsize)\n</code></pre>\n<p>输出：</p>\n<pre><code>8 8 1\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：在使用 <code>arange</code>  创建数组对象时，通过 <code>dtype</code>  参数指定元素的数据类型。可以看出， <code>np.int8</code>  代表的是 8 位有符号整数，只占用 1 个字节的内存空间，取值范围是<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mo>−</mo><mn>128</mn><mo separator=\"true\">,</mo><mn>127</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[-128,127]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mord\">8</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mord\">7</span><span class=\"mclose\">]</span></span></span></span>。</p>\n</blockquote>\n</li>\n<li>\n<p><code>nbytes</code>  属性：数组所有元素占用内存空间的字节数</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array19.nbytes, array20.nbytes, array21.nbytes)\n</code></pre>\n<p>输出：</p>\n<pre><code>400 96 50\n</code></pre>\n</li>\n<li>\n<p><code>flat</code>  属性：数组（一维化之后）元素的迭代器</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">from typing import Iterable\n\nprint(isinstance(array20.flat, np.ndarray), isinstance(array20.flat, Iterable))\n</code></pre>\n<p>输出：</p>\n<pre><code>False True\n</code></pre>\n</li>\n<li>\n<p><code>base</code>  属性：数组的基对象（如果数组共享了其他数组的内存空间）</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array22 = array19[:]\nprint(array22.base is array19, array22.base is array21)\n</code></pre>\n<p>输出：</p>\n<pre><code>True False\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码用到了数组的切片操作，它类似于 Python 中 <code>list</code>  类型的切片，但在细节上又不完全相同，下面会专门讲解这个知识点。通过上面的代码可以发现， <code>ndarray</code>  切片后得到的新的数组对象跟原来的数组对象共享了内存中的数据，因此 <code>array22</code>  的 <code>base</code>  属性就是 <code>array19</code>  对应的数组对象。</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"数组的索引和切片\"><a class=\"anchor\" href=\"#数组的索引和切片\">#</a> 数组的索引和切片</h3>\n<p>和 Python 中的列表类似，NumPy 的 <code>ndarray</code>  对象可以进行索引和切片操作，通过索引可以获取或修改数组中的元素，通过切片可以取出数组的一部分。</p>\n<ol>\n<li>\n<p>索引运算（普通索引）</p>\n<p>一维数组，代码：</p>\n<pre><code class=\"language-Python\">array23 = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9])\nprint(array23[0], array23[array23.size - 1])\nprint(array23[-array23.size], array23[-1])\n</code></pre>\n<p>输出：</p>\n<pre><code>1 9\n1 9\n</code></pre>\n<p>二维数组，代码：</p>\n<pre><code class=\"language-Python\">array24 = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])\nprint(array24[2])\nprint(array24[0][0], array24[-1][-1])\nprint(array24[1][1], array24[1, 1])\n</code></pre>\n<p>输出：</p>\n<pre><code>[7 8 9]\n1 9\n5 5\n[[ 1  2  3]\n [ 4 10  6]\n [ 7  8  9]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array24[1][1] = 10\nprint(array24)\narray24[1] = [10, 11, 12]\nprint(array24)\n</code></pre>\n<p>输出：</p>\n<pre><code>[[ 1  2  3]\n [ 4 10  6]\n [ 7  8  9]]\n[[ 1  2  3]\n [10 11 12]\n [ 7  8  9]]\n</code></pre>\n</li>\n<li>\n<p>切片运算（切片索引）</p>\n<p>切片是形如 <code>[开始索引:结束索引:步长]</code>  的语法，通过指定<strong>开始索引</strong>（默认值无穷小）、<strong>结束索引</strong>（默认值无穷大）和<strong>步长</strong>（默认值 1），从数组中取出指定部分的元素并构成新的数组。因为开始索引、结束索引和步长都有默认值，所以它们都可以省略，如果不指定步长，第二个冒号也可以省略。一维数组的切片运算跟 Python 中的 <code>list</code>  类型的切片非常类似，此处不再赘述，二维数组的切片可以参考下面的代码，相信非常容易理解。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[:2, 1:])\n</code></pre>\n<p>输出：</p>\n<pre><code>[[2 3]\n [5 6]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[2])\nprint(array24[2, :])\n</code></pre>\n<p>输出：</p>\n<pre><code>[7 8 9]\n[7 8 9]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[2:, :])\n</code></pre>\n<p>输出：</p>\n<pre><code>[[7 8 9]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[:, :2])\n</code></pre>\n<p>输出：</p>\n<pre><code>[[1 2]\n [4 5]\n [7 8]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[1, :2])\nprint(array24[1:2, :2])\n</code></pre>\n<p>输出：</p>\n<pre><code>[4 5]\n[[4 5]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[::2, ::2])\n</code></pre>\n<p>输出：</p>\n<pre><code>[[1 3]\n [7 9]]\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">print(array24[::-2, ::-2])\n</code></pre>\n<p>输出：</p>\n<pre><code>[[9 7]\n [3 1]]\n</code></pre>\n<p>关于数组的索引和切片运算，大家可以通过下面的两张图来增强印象，这两张图来自<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMjM5ODcyNS5odG1s\">《利用 Python 进行数据分析》</span>一书，它是 <code>pandas</code>  库的作者 Wes McKinney 撰写的 Python 数据分析领域的经典教科书，有兴趣的读者可以购买和阅读原书。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMDA1MTE1MDA1LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211005115005.png</span>&quot; style=&quot;zoom: 65%&quot;&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMDA1MTE1MDQxLnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211005115041.png</span>&quot; style=&quot;zoom:65%&quot;&gt;</p>\n</li>\n<li>\n<p>花式索引（fancy index）</p>\n<p>花式索引（Fancy indexing）是指利用整数数组进行索引，这里所说的整数数组可以是 NumPy 的 <code>ndarray</code> ，也可以是 Python 中 <code>list</code> 、 <code>tuple</code>  等可迭代类型，可以使用正向或负向索引。</p>\n<p>一维数组的花式索引，代码：</p>\n<pre><code class=\"language-Python\">array25 = np.array([50, 30, 15, 20, 40])\narray25[[0, 1, -1]]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([50, 30, 40])\n</code></pre>\n<p>二维数组的花式索引，代码：</p>\n<pre><code class=\"language-Python\">array26 = np.array([[30, 20, 10], [40, 60, 50], [10, 90, 80]])\n# 取二维数组的第1行和第3行\narray26[[0, 2]]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[30, 20, 10],\n       [10, 90, 80]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 取二维数组第1行第2列，第3行第3列的两个元素\narray26[[0, 2], [1, 2]]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([20, 80])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 取二维数组第1行第2列，第3行第2列的两个元素\narray26[[0, 2], 1]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([20, 90])\n</code></pre>\n</li>\n<li>\n<p>布尔索引</p>\n<p>布尔索引就是通过布尔类型的数组对数组元素进行索引，布尔类型的数组可以手动构造，也可以通过关系运算来产生布尔类型的数组。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array27 = np.arange(1, 10)\narray27[[True, False, True, True, False, False, False, False, True]]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([1, 3, 4, 9])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array27 &gt;= 5\n</code></pre>\n<p>输出：</p>\n<pre><code>array([False, False, False, False,  True,  True,  True,  True,  True])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># ~运算符可以实现逻辑变反，看看运行结果跟上面有什么不同\n~(array27 &gt;= 5)\n</code></pre>\n<p>输出：</p>\n<pre><code>array([ True,  True,  True,  True, False, False, False, False, False])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array27[array27 &gt;= 5]\n</code></pre>\n<p>输出：</p>\n<pre><code>array([5, 6, 7, 8, 9])\n</code></pre>\n</li>\n</ol>\n<blockquote>\n<p><strong>提示</strong>：切片操作虽然创建了新的数组对象，但是新数组和原数组共享了数组中的数据，简单的说，如果通过新数组对象或原数组对象修改数组中的数据，其实修改的是同一块数据。花式索引和布尔索引也会创建新的数组对象，而且新数组复制了原数组的元素，新数组和原数组并不是共享数据的关系，这一点通过前面讲的数组的 <code>base</code>  属性也可以了解到，在使用的时候要引起注意。</p>\n</blockquote>\n<h4 id=\"案例通过数组切片处理图像\"><a class=\"anchor\" href=\"#案例通过数组切片处理图像\">#</a> 案例：通过数组切片处理图像</h4>\n<p>学习基础知识总是比较枯燥且没有成就感的，所以我们还是来个案例为大家演示下上面学习的数组索引和切片操作到底有什么用。前面我们说到过，可以用三维数组来表示图像，那么通过图像对应的三维数组进行操作，就可以实现对图像的处理，如下所示。</p>\n<p>读入图片创建三维数组对象。</p>\n<pre><code class=\"language-Python\">guido_image = plt.imread('guido.jpg')\nplt.imshow(guido_image)\n</code></pre>\n<p>对数组的 0 轴进行反向切片，实现图像的垂直翻转。</p>\n<pre><code class=\"language-Python\">plt.imshow(guido_image[::-1])\n</code></pre>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115228.png\" alt=\"\" /></p>\n<p>对数组的 1 轴进行反向切片，实现图像的水平翻转。</p>\n<pre><code class=\"language-Python\">plt.imshow(guido_image[:,::-1])\n</code></pre>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115242.png\" alt=\"\" /></p>\n<p>将 Guido 的头切出来。</p>\n<pre><code class=\"language-Python\">plt.imshow(guido_image[30:350, 90:300])\n</code></pre>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005115305.png\" alt=\"\" /></p>\n<h3 id=\"数组对象的方法\"><a class=\"anchor\" href=\"#数组对象的方法\">#</a> 数组对象的方法</h3>\n<h4 id=\"统计方法\"><a class=\"anchor\" href=\"#统计方法\">#</a> 统计方法</h4>\n<p>统计方法主要包括： <code>sum()</code> 、 <code>mean()</code> 、 <code>std()</code> 、 <code>var()</code> 、 <code>min()</code> 、 <code>max()</code> 、 <code>argmin()</code> 、 <code>argmax()</code> 、 <code>cumsum()</code>  等，分别用于对数组中的元素求和、求平均、求标准差、求方差、找最大、找最小、求累积和等，请参考下面的代码。</p>\n<pre><code class=\"language-Python\">array28 = np.array([1, 2, 3, 4, 5, 5, 4, 3, 2, 1])\nprint(array28.sum())\nprint(array28.mean())\nprint(array28.max())\nprint(array28.min())\nprint(array28.std())\nprint(array28.var())\nprint(array28.cumsum())\n</code></pre>\n<p>输出：</p>\n<pre><code>30\n3.0\n5\n1\n1.4142135623730951\n2.0\n[ 1  3  6 10 15 20 24 27 29 30]\n</code></pre>\n<h4 id=\"其他方法\"><a class=\"anchor\" href=\"#其他方法\">#</a> 其他方法</h4>\n<ol>\n<li>\n<p><code>all()</code>  /  <code>any()</code>  方法：判断数组是否所有元素都是 <code>True</code>  / 判断数组是否有为 <code>True</code>  的元素。</p>\n</li>\n<li>\n<p><code>astype()</code>  方法：拷贝数组，并将数组中的元素转换为指定的类型。</p>\n</li>\n<li>\n<p><code>dump()</code>  方法：保存数组到文件中，可以通过 NumPy 中的 <code>load()</code>  函数从保存的文件中加载数据创建数组。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array31.dump('array31-data')\narray32 = np.load('array31-data', allow_pickle=True)\narray32\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 2],\n       [3, 4],\n       [5, 6]])\n</code></pre>\n</li>\n<li>\n<p><code>fill()</code>  方法：向数组中填充指定的元素。</p>\n</li>\n<li>\n<p><code>flatten()</code>  方法：将多维数组扁平化为一维数组。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array32.flatten()\n</code></pre>\n<p>输出：</p>\n<pre><code>array([1, 2, 3, 4, 5, 6])\n</code></pre>\n</li>\n<li>\n<p><code>nonzero()</code>  方法：返回非 0 元素的索引。</p>\n</li>\n<li>\n<p><code>round()</code>  方法：对数组中的元素做四舍五入操作。</p>\n</li>\n<li>\n<p><code>sort()</code>  方法：对数组进行就地排序。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\">array33 = np.array([35, 96, 12, 78, 66, 54, 40, 82])\narray33.sort()\narray33\n</code></pre>\n<p>输出：</p>\n<pre><code>array([12, 35, 40, 54, 66, 78, 82, 96])\n</code></pre>\n</li>\n<li>\n<p><code>swapaxes()</code>  和 <code>transpose()</code>  方法：交换数组指定的轴。</p>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 指定需要交换的两个轴，顺序无所谓\narray32.swapaxes(0, 1)\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 3, 5],\n      [2, 4, 6]])\n</code></pre>\n<p>代码：</p>\n<pre><code class=\"language-Python\"># 对于二维数组，transpose相当于实现了矩阵的转置\narray32.transpose()\n</code></pre>\n<p>输出：</p>\n<pre><code>array([[1, 3, 5],\n      [2, 4, 6]])\n</code></pre>\n</li>\n<li>\n<p><code>tolist()</code>  方法：将数组转成 Python 中的 <code>list</code> 。</p>\n</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/67.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/",
            "url": "https://scottalive.github.io/computer-science/python/basic/67.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/",
            "title": "环境准备",
            "date_published": "2025-04-23T19:07:49.000Z",
            "content_html": "<h2 id=\"环境准备\"><a class=\"anchor\" href=\"#环境准备\">#</a> 环境准备</h2>\n<p>如果希望快速开始使用 Python 处理数据科学相关的工作，建议大家直接安装 Anaconda，然后使用 Anaconda 中集成的 Notebook 或 JupyterLab 工具来编写代码。因为对于新手来说，先安装官方的 Python 解释器，再逐个安装工作中会使用到的三方库文件会比较麻烦，尤其是在 Windows 环境下，经常会因为构建工具或 DLL 文件的缺失导致安装失败，而一般新手也很难根据错误提示信息采取正确的解决措施，容易产生严重的挫败感。如果计算机上已经有 Python 解释器环境了，也可以直接使用 Python 的包管理工具 pip 安装 Jupyter，再根据实际工作的需要安装三方库，这种方式适合有一定经验的用户。</p>\n<h3 id=\"安装和使用-anaconda\"><a class=\"anchor\" href=\"#安装和使用-anaconda\">#</a> 安装和使用 Anaconda</h3>\n<p>对于个人用户来说，可以从 Anaconda 的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tLw==\">官方网站</span>下载它的 “个人版（Individual Edition）” 安装程序，安装完成后，你的计算机上不仅拥有了 Python 环境和 Spyder（类似于 PyCharm 的集成开发工具），还拥有了与数据科学工作相关的近 200 个工具包，包括我们上面提到 Python 数据分析三大神器。除此之外，Anaconda 还提供了一个名为 conda 的包管理工具，通过这个工具不仅可以管理 Python 的工具包，还可以用于创建运行 Python 程序的虚拟环境。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMDA1MTExNDE3LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211005111417.png</span>&quot;&gt;</p>\n<p>如上图所示，可以通过 Anaconda 官网提供的下载链接选择适合自己操作系统的安装程序，建议大家选择图形化的安装程序，下载完成后双击安装程序开始安装。安装过程基本使用默认设置即可，完成安装后，macOS 用户可以在 “应用程序” 或 “Launchpad” 中找到名为 “Anaconda-Navigator” 的应用程序，运行该程序可以看到如下所示的界面，我们可以在这里选择需要执行的操作。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2phY2tmcnVlZC9teXBpYy9yYXcvbWFzdGVyLzIwMjExMDA1MTExNzI5LnBuZw==\">https://github.com/jackfrued/mypic/raw/master/20211005111729.png</span>&quot;&gt;</p>\n<p>对于 Windows 用户，建议按照安装向导的提示和推荐的选项来安装 Anaconda（除了安装路径，基本也没有什么需要选择的），安装完成后可以在 “开始菜单” 中找到 “Anaconda3”。</p>\n<blockquote>\n<p><strong>温馨提示</strong>：可以选择 Miniconda 作为 Anaconda 的替代品，Miniconda 只会安装 Python 解释器环境和一些必要的工具，其他的三方库由用户自行选择安装。其实我个人并不喜欢 Anaconda，因为它是给小白用户使用的，我们有了 Python 以后完全可以按照自己的意愿来安装需要的三方库。</p>\n</blockquote>\n<h4 id=\"conda命令\"><a class=\"anchor\" href=\"#conda命令\">#</a> conda 命令</h4>\n<p>如果希望使用 conda 工具来管理依赖项或者创建项目的虚拟环境，可以在终端或命令行提示符中使用 conda 命令。Windows 用户可以在 “开始菜单” 中找到 “Anaconda3”，然后点击 “Anaconda Prompt” 来启动支持 conda 的命令行提示符。macOS 用户建议直接使用 “Anaconda-Navigator” 中的 “Environments”，通过可视化的方式对虚拟环境和依赖项进行管理。</p>\n<ol>\n<li>\n<p>版本和帮助信息。</p>\n<ul>\n<li>查看版本： <code>conda -V</code>  或 <code>conda --version</code></li>\n<li>获取帮助： <code>conda -h</code>  或 <code>conda --help</code></li>\n<li>相关信息： <code>conda list</code></li>\n</ul>\n</li>\n<li>\n<p>虚拟环境相关。</p>\n<ul>\n<li>显示所有虚拟环境： <code>conda env list</code></li>\n<li>创建虚拟环境： <code>conda create --name venv</code></li>\n<li>指定 Python 版本创建虚拟环境： <code>conda create --name venv python=3.7</code></li>\n<li>指定 Python 版本创建虚拟环境并安装指定依赖项： <code>conda create --name venv python=3.7 numpy pandas</code></li>\n<li>通过克隆现有虚拟环境的方式创建虚拟环境： <code>conda create --name venv2 --clone venv</code></li>\n<li>分享虚拟环境并重定向到指定的文件中： <code>conda env export &gt; environment.yml</code></li>\n<li>通过分享的虚拟环境文件创建虚拟环境： <code>conda env create -f environment.yml</code></li>\n<li>激活虚拟环境： <code>conda activate venv</code></li>\n<li>退出虚拟环境： <code>conda deactivate</code></li>\n<li>删除虚拟环境： <code>conda remove --name venv --all</code></li>\n</ul>\n<blockquote>\n<p><strong>说明</strong>：上面的命令中， <code>venv</code>  和 <code>venv2</code>  是虚拟环境文件夹的名字，可以将其替换为自己喜欢的名字，但是<strong>强烈建议</strong>使用英文且不要出现空格或其他特殊字符。</p>\n</blockquote>\n</li>\n<li>\n<p>包（三方库或工具）管理。</p>\n<ul>\n<li>查看已经安装的包： <code>conda list</code></li>\n<li>搜索指定的包： <code>conda search matplotlib</code></li>\n<li>安装指定的包： <code>conda install matplotlib</code></li>\n<li>更新指定的包： <code>conda update matplotlib</code></li>\n<li>移除指定的包： <code>conda remove matplotlib</code></li>\n</ul>\n<blockquote>\n<p><strong>说明</strong>：在搜索、安装和更新软件包时，默认会连接到官方网站进行操作，如果觉得速度不给力，可以将默认的官方网站替换为国内的镜像网站，推荐使用清华大学的开源镜像网站。将默认源更换为国内镜像的命令是： <code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</code>  和 <code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</code> 。如果需要换回默认源，可以使用命令 <code>conda config --remove-key channels</code> 。</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"使用notebook\"><a class=\"anchor\" href=\"#使用notebook\">#</a> 使用 Notebook</h3>\n<h4 id=\"安装和启动notebook\"><a class=\"anchor\" href=\"#安装和启动notebook\">#</a> 安装和启动 Notebook</h4>\n<p>如果已经安装了 Anaconda，macOS 用户可以按照上面所说的方式在 “Anaconda-Navigator” 中直接启动 “Jupyter Notebook”（以下统一简称为 Notebook）。Windows 用户可以在 “开始菜单” 中找到 Anaconda 文件夹，接下来选择运行文件夹中的 “Jupyter Notebook” 就可以开始数据科学的探索之旅。</p>\n<p>对于安装了 Python 环境但是没有安装 Anaconda 的用户，可以用 Python 的包管理工具 <code>pip</code>  来安装 <code>jupyter</code> ，然后在终端（Windows 系统为命令行提示符）中运行 <code>jupyter notebook</code>  命令来启动 Notebook，如下所示。</p>\n<p>安装 Notebook：</p>\n<pre><code class=\"language-Bash\">pip install jupyter\n</code></pre>\n<p>安装三大神器：</p>\n<pre><code class=\"language-Bash\">pip install numpy pandas matplotlib\n</code></pre>\n<p>运行 Notebook：</p>\n<pre><code class=\"language-Bash\">jupyter notebook\n</code></pre>\n<p>Notebook 是基于网页的用于交互计算的应用程序，可以用于代码开发、文档撰写、代码运行和结果展示。简单的说，你可以在网页中直接<strong>编写代码</strong>和<strong>运行代码</strong>，代码的运行结果也会直接在代码块下方进行展示。如在编写代码的过程中需要编写说明文档，可在同一个页面中使用 Markdown 格式进行编写，而且可以直接看到渲染后的效果。此外，Notebook 的设计初衷是提供一个能够支持多种编程语言的工作环境，目前它能够支持超过 40 种编程语言，包括 Python、R、Julia、Scala 等。</p>\n<p>首先，我们可以创建一个用于书写 Python 代码的 Notebook，如下图所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211129131353.png\" alt=\"\" /></p>\n<p>接下来，我们就可以编写代码、撰写文档和运行程序啦，如下图所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005113900.png\" alt=\"\" /></p>\n<h4 id=\"notebook使用技巧\"><a class=\"anchor\" href=\"#notebook使用技巧\">#</a> Notebook 使用技巧</h4>\n<p>如果使用 Python 做工程化的项目开发，PyCharm 肯定是最好的选择，它提供了一个集成开发环境应该具有的所有功能，尤其是智能提示、代码补全、自动纠错这类功能会让开发人员感到非常舒服。如果使用 Python 做数据科学相关的工作，Notebook 并不比 PyCharm 逊色，在数据和图表展示方面 Notebook 更加优秀。这个工具的使用非常简单，大家可以看看 Notebook 菜单栏，相信理解起来不会有太多困难，在知乎上有一篇名为<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjMyMDIxNA==\">《最详尽使用指南：超快上手 Jupyter Notebook》</span>的文章，也可以帮助大家快速认识 Notebook。</p>\n<blockquote>\n<p><strong>说明</strong>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdXB5dGVyLm9yZy8=\">Jupyter 官网</span>上还有一个名为 JupyterLab 的工具，被称之为 “Next-Generation Notebook”，用户界面较之 Notebook 更加友好，有兴趣的读者可以使用 <code>pip install jupyterlab</code>  命令来安装这个工具，然后通过 <code>jupyter lab</code>  来启动它。</p>\n</blockquote>\n<p>下面我为大家介绍一些 Notebook 的使用技巧，希望能够帮助大家提升工作效率。</p>\n<ol>\n<li>\n<p>自动补全。在使用 Notebook 编写代码时，按 <code>Tab</code>  键会获得代码提示。</p>\n</li>\n<li>\n<p>获得帮助。在使用 Notebook 时，如果希望了解一个对象（如变量、类、函数等）的相关信息或使用方式，可以在对象后面使用 <code>?</code>  并运行代码， 窗口下方会显示出对应的信息，帮助我们了解该对象，如下所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005113848.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>搜索命名。如果只记得一个类或一个函数名字的一部分，可以使用通配符 <code>*</code>  并配合 <code>?</code>  进行搜索，如下所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005113836.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>调用命令。可以在 Notebook 中使用 <code>!</code>  后面跟系统命令的方式来执行系统命令。</p>\n</li>\n<li>\n<p>魔法指令。Notebook 中有很多非常有趣且有用的魔法指令，例如可以使用 <code>%timeit</code>  测试语句的执行时间，可以使用 <code>%pwd</code>  查看当前工作目录等。如果想查看所有的魔法指令，可以使用 <code>%lsmagic</code> ，如果了解魔法指令的用法，可以使用 <code>%magic</code>  来查看，如下图所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005113825.png\" alt=\"\" /></p>\n<p>常用的魔法指令有：</p>\n<p>| 魔法指令                                    | 功能说明                                   |<br />\n| ------------------------------------------- | ------------------------------------------ |<br />\n|  <code>%pwd</code>                                       | 查看当前工作目录                           |<br />\n|  <code>%ls</code>                                        | 列出当前或指定文件夹下的内容               |<br />\n|  <code>%cat</code>                                       | 查看指定文件的内容                         |<br />\n|  <code>%hist</code>                                      | 查看输入历史                               |<br />\n|  <code>%matplotlib inline</code>                         | 设置在页面中嵌入 matplotlib 输出的统计图表   |<br />\n|  <code>%config Inlinebackend.figure_format='svg'</code>  | 设置统计图表使用 SVG 格式（矢量图）          |<br />\n|  <code>%run</code>                                       | 运行指定的程序                             |<br />\n|  <code>%load</code>                                      | 加载指定的文件到单元格中                   |<br />\n|  <code>%quickref</code>                                  | 显示 IPython 的快速参考                      |<br />\n|  <code>%timeit</code>                                    | 多次运行代码并统计代码执行时间             |<br />\n|  <code>%prun</code>                                      | 用 <code>cProfile.run</code>  运行代码并显示分析器的输出 |<br />\n|  <code>%who</code>  /  <code>%whos</code>                             | 显示命名空间中的变量                       |<br />\n|  <code>%xdel</code>                                      | 删除一个对象并清理所有对它的引用           |</p>\n</li>\n<li>\n<p>快捷键。Notebook 中的很多操作可以通过快捷键来实现，使用快捷键可以提升工作效率。Notebook 的快捷键又可以分为命令模式下的快捷键和编辑模式下的快捷键，所谓编辑模式就是处于输入代码或撰写文档状态的模式，在编辑模式下按 <code>Esc</code>  可以回到命令模式，在命令模式下按 <code>Enter</code>  可以进入编辑模式。</p>\n<p>命令模式下的快捷键：</p>\n<p>| 快捷键                                   | 功能说明                                     |<br />\n| ---------------------------------------- | -------------------------------------------- |<br />\n|  <code>Alt</code>  +  <code>Enter</code> （ <code>Option</code>  +  <code>Enter</code> ）    | 运行当前单元格并在下面插入新的单元格         |<br />\n|  <code>Shift</code>  +  <code>Enter</code>                         | 运行当前单元格并选中下方的单元格             |<br />\n|  <code>Ctrl</code>  +  <code>Enter</code> （ <code>Command</code>  +  <code>Enter</code> ）  | 运行当前单元格                               |<br />\n|  <code>j</code>  /  <code>k</code> 、 <code>Shift</code>  +  <code>j</code>  /  <code>Shift</code>  +  <code>k</code>  | 选中下方 / 上方单元格、连续选中下方 / 上方单元格 |<br />\n|  <code>a</code>  /  <code>b</code>                                 | 在下方 / 上方插入新的单元格                    |<br />\n|  <code>c</code>  /  <code>x</code>                                 | 复制单元格 / 剪切单元格                      |<br />\n|  <code>v</code>  /  <code>Shift</code>  +  <code>v</code>                       | 在下方 / 上方粘贴单元格                        |<br />\n|  <code>dd</code>  /  <code>z</code>                                | 删除单元格 / 恢复删除的单元格                |<br />\n|  <code>l</code>  /  <code>Shift</code>  +  <code>l</code>                       | 显示或隐藏当前 / 所有单元格行号                |<br />\n|  <code>ii</code>  /  <code>00</code>                               | 中断 / 重启 Notebook 内核                        |<br />\n|  <code>Space</code>  /  <code>Shift</code>  +  <code>Space</code>               | 向下 / 向上滚动页面                            |</p>\n<p>编辑模式下的快捷键：</p>\n<p>| 快捷键                                                       | 功能说明                               |<br />\n| ------------------------------------------------------------ | -------------------------------------- |<br />\n|  <code>Shift</code>  +  <code>Tab</code>                                               | 获得提示信息                           |<br />\n|  <code>Ctrl</code>  +  <code>]</code> （ <code>Command</code>  +  <code>]</code> ）/  <code>Ctrl</code>  +  <code>[</code> （ <code>Command</code>  +  <code>[</code> ） | 增加 / 减少缩进                          |<br />\n|  <code>Alt</code>  +  <code>Enter</code> （ <code>Option</code>  +  <code>Enter</code> ）                        | 运行当前单元格并在下面插入新的单元格   |<br />\n|  <code>Shift</code>  +  <code>Enter</code>                                             | 运行当前单元格并选中下方的单元格       |<br />\n|  <code>Ctrl</code>  +  <code>Enter</code> （ <code>Command</code>  +  <code>Enter</code> ）                      | 运行当前单元格                         |<br />\n|  <code>Ctrl</code>  +  <code>Left</code>  /  <code>Right</code> （ <code>Command</code>  +  <code>Left</code>  /  <code>Right</code> ）    | 光标移到行首 / 行尾                      |<br />\n|  <code>Ctrl</code>  +  <code>Up</code>  /  <code>Down</code> （ <code>Command</code>  +  <code>Up</code>  /  <code>Down</code> ）          | 光标移动代码开头 / 结尾处                |<br />\n|  <code>Up</code>  /  <code>Down</code>                                                 | 光标上移 / 下移一行或移到上 / 下一个单元格 |</p>\n<blockquote>\n<p><strong>温馨提示</strong>：如果记不住这些快捷键也没有关系，在命令模式下按 <code>h</code>  键可以打开 Notebook 的帮助系统，马上就可以看到快捷键的设置，而且可以根据实际的需要重新编辑快捷键，如下图所示。</p>\n<p><img data-src=\"https://github.com/jackfrued/mypic/raw/master/20211005113812.png\" alt=\"\" /></p>\n</blockquote>\n</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/66.%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%A6%82%E8%BF%B0/",
            "url": "https://scottalive.github.io/computer-science/python/basic/66.%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%A6%82%E8%BF%B0/",
            "title": "数据分析概述",
            "date_published": "2025-04-22T19:07:49.000Z",
            "content_html": "<h2 id=\"数据分析概述\"><a class=\"anchor\" href=\"#数据分析概述\">#</a> 数据分析概述</h2>\n<p>当今世界对信息技术的依赖程度在不断加深，每天都会有大量的数据产生，我们经常会感到数据越来越多，但是要从中发现有价值的信息却越来越难。这里所说的信息，可以理解为对数据集处理之后的结果，是从数据集中提炼出的可用于其他场合的结论性的东西，而<strong>从原始数据中抽取出有价值的信息</strong>的这个过程我们就称之为<strong>数据分析</strong>，它是数据科学工作的一部分。</p>\n<blockquote>\n<p>定义：<strong>数据分析是有针对性的收集、加工、整理数据并采用统计、挖掘等技术对数据进行分析和解释的科学和艺术</strong>。</p>\n</blockquote>\n<h3 id=\"数据分析师的职责和技能栈\"><a class=\"anchor\" href=\"#数据分析师的职责和技能栈\">#</a> 数据分析师的职责和技能栈</h3>\n<p>HR 在发布招聘需求时，通常将数据工程、数据分析、数据挖掘等岗位都统称为数据分析岗位，但是根据工作性质的不同，又可以分为偏工程的<strong>数据治理方向</strong>、偏业务的<strong>数据分析方向</strong>、偏算法的<strong>数据挖掘方向</strong>、偏开发的<strong>数据开发方向</strong>、偏产品的<strong>数据产品经理</strong>。我们通常所说的数据分析师主要是指<strong>业务数据分析师</strong>，很多数据分析师的职业生涯都是从这个岗位开始的，而且这个岗位也是招聘数量最多的岗位。业务数据分析师在公司通常不属于研发部门而属于运营部门，所以这个岗位也称为<strong>数据运营</strong>或<strong>商业分析</strong>，这类人员通常也被称为 “BI 工程师”。通常招聘信息对这个岗位的描述（JD）是：</p>\n<ol>\n<li>负责相关报表的输出。</li>\n<li>建立和优化指标体系。</li>\n<li>监控数据波动和异常，找出问题。</li>\n<li>优化和驱动业务，推动数字化运营。</li>\n<li>找出潜在的市场和产品的上升空间。</li>\n</ol>\n<p>根据上面的描述，作为业务数据分析师，我们的工作不是给领导一个简单浅显的结论，而是结合公司的业务，完成<strong>监控数据</strong>、<strong>揪出异常</strong>、<strong>找到原因</strong>、<strong>探索趋势</strong>等工作。作为数据分析师，不管是用 Python 语言、Excel、SPSS 或其他的商业智能工具，工具只是达成目标的手段，<strong>数据思维是核心技能</strong>，从实际业务问题出发到最终<strong>发现数据中的商业价值</strong>是终极目标。数据分析师在很多公司只是一个基础岗位，精于业务的数据分析师可以向<strong>数据分析经理</strong>或<strong>数据运营总监</strong>等管理岗位发展；对于熟悉机器学习算法的数据分析师来说，可以向<strong>数据挖掘工程师</strong>或<strong>算法专家</strong>方向发展，而这些岗位除了需要相应的数学和统计学知识，在编程能力方面也比数据分析师有更高的要求，可能还需要有大数据存储和处理的相关经验。数据治理岗位主要是帮助公司建设数据仓库或数据湖，实现数据从业务系统、埋点系统、日志系统到分析库的转移，为后续的数据分析和挖掘提供基础设施。数据治理岗位对 SQL 和 HiveSQL 有着较高的要求，要求能够熟练的使用 ETL 工具，此外可能还需要对 Hadoop 生态圈有一个很好的认知。作为数据产品经理，除了传统产品经理的技能栈之外，也需要较强的技术能力，例如要了解常用的推荐算法、机器学习模型，能够为算法的改进提供依据，能够制定相关埋点的规范和口径，虽然不需要精通各种算法，但是要站在产品的角度去考虑数据模型、指标、算法等的落地</p>\n<p>以下是我总结的数据分析师的技能栈，仅供参考。</p>\n<ol>\n<li>计算机科学（数据分析工具、编程语言、数据库）</li>\n<li>数学和统计学（数据思维、统计思维）</li>\n<li>人工智能（机器学习中的数据挖掘算法）</li>\n<li>业务理解能力（沟通、表达、经验）</li>\n<li>总结和表述能力（商业 PPT、文字总结）</li>\n</ol>\n<h3 id=\"数据分析的流程\"><a class=\"anchor\" href=\"#数据分析的流程\">#</a> 数据分析的流程</h3>\n<p>我们提到数分析这个词很多时候可能指的都是<strong>狭义的数据分析</strong>，这类数据分析主要目标就是生成可视化报表并通过这些报表来洞察业务中的问题。<strong>广义的数据分析</strong>还包含了数据挖掘的部分，不仅要通过数据实现对业务的监控和分析，还要利用机器学习算法，找出隐藏在数据背后的知识，并利用这些知识为将来的决策提供支撑。简单的说，<strong>一个完整的数据分析应该包括基本的数据分析和深入的数据挖掘两个部分</strong>。</p>\n<p>基本的数据分析工作一般包含以下几个方面的内容，当然因为行业和工作内容的不同会略有差异。</p>\n<ol>\n<li>确定目标（输入）：理解业务，确定指标口径</li>\n<li>获取数据：数据仓库、电子表格、三方接口、网络爬虫、开放数据集等</li>\n<li>清洗数据：缺失值 / 重复值 / 异常值处理、数据变换（格式化、规范化）、离散化等</li>\n<li>数据透视：运算、统计、分组、聚合、可视化</li>\n<li>数据报告（输出）：数据发布，工作成果总结汇报</li>\n<li>分析洞察（后续）：解释数据的变化，提出对应的方案</li>\n</ol>\n<p>深入的数据挖掘工作通常包含以下几个方面的内容，当然因为行业和工作内容的不同会略有差异。</p>\n<ol>\n<li>确定目标（输入）：理解业务，明确挖掘目标</li>\n<li>数据准备：数据采集、数据描述、数据探索、质量判定等</li>\n<li>数据加工：提取数据、清洗数据、数据变换、特殊编码、降维、特征选择等</li>\n<li>数据建模：模型比较、模型选择、算法应用</li>\n<li>模型评估：交叉检验、参数调优、结果评价</li>\n<li>模型部署（输出）：模型落地、业务改进、运营监控、报告撰写</li>\n</ol>\n<h3 id=\"数据分析相关库\"><a class=\"anchor\" href=\"#数据分析相关库\">#</a> 数据分析相关库</h3>\n<p>使用 Python 从事数据科学相关的工作是一个非常棒的选择，因为 Python 整个生态圈中，有大量的成熟的用于数据科学的软件包（工具库）。而且不同于其他的用于数据科学的编程语言（如：Julia、R），Python 除了可以用于数据科学，能做的事情还很多，可以说 Python 语言几乎是无所不能的。</p>\n<h4 id=\"三大神器\"><a class=\"anchor\" href=\"#三大神器\">#</a> 三大神器</h4>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9udW1weS5vcmcv\">NumPy</span>：支持常见的数组和矩阵操作，通过 <code>ndarray</code>  类实现了对多维数组的封装，提供了操作这些数组的方法和函数集。由于 NumPy 内置了并行运算功能，当使用多核 CPU 时，Numpy 会自动做并行计算。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy8=\">Pandas</span>：pandas 的核心是其特有的数据结构 <code>DataFrame</code>  和 <code>Series</code> ，这使得 pandas 可以处理包含不同类型的数据的负责表格和时间序列，这一点是 NumPy 的 <code>ndarray</code>  做不到的。使用 pandas，可以轻松顺利的加载各种形式的数据，然后对数据进行切片、切块、处理缺失值、聚合、重塑和可视化等操作。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXRwbG90bGliLm9yZy8=\">Matplotlib</span>：matplotlib 是一个包含各种绘图模块的库，能够根据我们提供的数据创建高质量的图形。此外，matplotlib 还提供了 pylab 模块，这个模块包含了很多像 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWF0aHdvcmtzLmNvbS9wcm9kdWN0cy9tYXRsYWIuaHRtbA==\">MATLAB</span> 一样的绘图组件。</li>\n</ol>\n<h4 id=\"其他相关库\"><a class=\"anchor\" href=\"#其他相关库\">#</a> 其他相关库</h4>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zY2lweS5vcmcv\">SciPy</span>：完善了 NumPy 的功能，封装了大量科学计算的算法，包括线性代数、稀疏矩阵、信号和图像处理、最优化问题、快速傅里叶变换等。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWFib3JuLnB5ZGF0YS5vcmcv\">Seaborn</span>：seaborn 是基于 matplotlib 的图形可视化工具，直接使用 matplotlib 虽然可以定制出漂亮的统计图表，但是总体来说还不够简单方便，seaborn 相当于是对 matplotlib 做了封装，让用户能够以更简洁有效的方式做出各种有吸引力的统计图表。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnLw==\">Scikit-learn</span>：scikit-learn 最初是 SciPy 的一部分，它是 Python 数据科学运算的核心，提供了大量机器学习可能用到的工具，包括：数据预处理、监督学习（分类、回归）、无监督学习（聚类）、模式选择、交叉检验等。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3RhdHNtb2RlbHMub3JnL3N0YWJsZS9pbmRleC5odG1s\">Statsmodels</span>：包含了经典统计学和经济计量学算法的库。</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/65.%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6Scrapy%E7%AE%80%E4%BB%8B/",
            "url": "https://scottalive.github.io/computer-science/python/basic/65.%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6Scrapy%E7%AE%80%E4%BB%8B/",
            "title": "爬虫框架Scrapy简介",
            "date_published": "2025-04-21T19:07:49.000Z",
            "content_html": "<h2 id=\"爬虫框架scrapy简介\"><a class=\"anchor\" href=\"#爬虫框架scrapy简介\">#</a> 爬虫框架 Scrapy 简介</h2>\n<p>当你写了很多个爬虫程序之后，你会发现每次写爬虫程序时，都需要将页面获取、页面解析、爬虫调度、异常处理、反爬应对这些代码从头至尾实现一遍，这里面有很多工作其实都是简单乏味的重复劳动。那么，有没有什么办法可以提升我们编写爬虫代码的效率呢？答案是肯定的，那就是利用爬虫框架，而在所有的爬虫框架中，Scrapy 应该是最流行、最强大的框架。</p>\n<h3 id=\"scrapy-概述\"><a class=\"anchor\" href=\"#scrapy-概述\">#</a> Scrapy 概述</h3>\n<p>Scrapy 是基于 Python 的一个非常流行的网络爬虫框架，可以用来抓取 Web 站点并从页面中提取结构化的数据。下图展示了 Scrapy 的基本架构，其中包含了主要组件和系统的数据处理流程（图中带数字的红色箭头）。</p>\n<p><img data-src=\"https://gitee.com/jackfrued/mypic/raw/master/20210824003638.png\" alt=\"\" /></p>\n<h4 id=\"scrapy的组件\"><a class=\"anchor\" href=\"#scrapy的组件\">#</a> Scrapy 的组件</h4>\n<p>我们先来说说 Scrapy 中的组件。</p>\n<ol>\n<li>Scrapy 引擎（Engine）：用来控制整个系统的数据处理流程。</li>\n<li>调度器（Scheduler）：调度器从引擎接受请求并排序列入队列，并在引擎发出请求后返还给它们。</li>\n<li>下载器（Downloader）：下载器的主要职责是抓取网页并将网页内容返还给蜘蛛（Spiders）。</li>\n<li>蜘蛛程序（Spiders）：蜘蛛是用户自定义的用来解析网页并抓取特定 URL 的类，每个蜘蛛都能处理一个域名或一组域名，简单的说就是用来定义特定网站的抓取和解析规则的模块。</li>\n<li>数据管道（Item Pipeline）：管道的主要责任是负责处理有蜘蛛从网页中抽取的数据条目，它的主要任务是清理、验证和存储数据。当页面被蜘蛛解析后，将被发送到数据管道，并经过几个特定的次序处理数据。每个数据管道组件都是一个 Python 类，它们获取了数据条目并执行对数据条目进行处理的方法，同时还需要确定是否需要在数据管道中继续执行下一步或是直接丢弃掉不处理。数据管道通常执行的任务有：清理 HTML 数据、验证解析到的数据（检查条目是否包含必要的字段）、检查是不是重复数据（如果重复就丢弃）、将解析到的数据存储到数据库（关系型数据库或 NoSQL 数据库）中。</li>\n<li>中间件（Middlewares）：中间件是介于引擎和其他组件之间的一个钩子框架，主要是为了提供自定义的代码来拓展 Scrapy 的功能，包括下载器中间件和蜘蛛中间件。</li>\n</ol>\n<h4 id=\"数据处理流程\"><a class=\"anchor\" href=\"#数据处理流程\">#</a> 数据处理流程</h4>\n<p>Scrapy 的整个数据处理流程由引擎进行控制，通常的运转流程包括以下的步骤：</p>\n<ol>\n<li>\n<p>引擎询问蜘蛛需要处理哪个网站，并让蜘蛛将第一个需要处理的 URL 交给它。</p>\n</li>\n<li>\n<p>引擎让调度器将需要处理的 URL 放在队列中。</p>\n</li>\n<li>\n<p>引擎从调度那获取接下来进行爬取的页面。</p>\n</li>\n<li>\n<p>调度将下一个爬取的 URL 返回给引擎，引擎将它通过下载中间件发送到下载器。</p>\n</li>\n<li>\n<p>当网页被下载器下载完成以后，响应内容通过下载中间件被发送到引擎；如果下载失败了，引擎会通知调度器记录这个 URL，待会再重新下载。</p>\n</li>\n<li>\n<p>引擎收到下载器的响应并将它通过蜘蛛中间件发送到蜘蛛进行处理。</p>\n</li>\n<li>\n<p>蜘蛛处理响应并返回爬取到的数据条目，此外还要将需要跟进的新的 URL 发送给引擎。</p>\n</li>\n<li>\n<p>引擎将抓取到的数据条目送入数据管道，把新的 URL 发送给调度器放入队列中。</p>\n</li>\n</ol>\n<p>上述操作中的第 2 步到第 8 步会一直重复直到调度器中没有需要请求的 URL，爬虫就停止工作。</p>\n<h3 id=\"安装和使用scrapy\"><a class=\"anchor\" href=\"#安装和使用scrapy\">#</a> 安装和使用 Scrapy</h3>\n<p>可以使用 Python 的包管理工具 <code>pip</code>  来安装 Scrapy。</p>\n<pre><code class=\"language-Shell\">pip install scrapy\n</code></pre>\n<p>在命令行中使用 <code>scrapy</code>  命令创建名为 <code>demo</code>  的项目。</p>\n<pre><code class=\"language-Bash\">scrapy startproject demo\n</code></pre>\n<p>项目的目录结构如下图所示。</p>\n<pre><code class=\"language-Shell\">demo\n|____ demo\n|________ spiders\n|____________ __init__.py\n|________ __init__.py\n|________ items.py\n|________ middlewares.py\n|________ pipelines.py\n|________ settings.py\n|____ scrapy.cfg\n</code></pre>\n<p>切换到 <code>demo</code>  目录，用下面的命令创建名为 <code>douban</code>  的蜘蛛程序。</p>\n<pre><code class=\"language-Bash\">scrapy genspider douban movie.douban.com\n</code></pre>\n<h4 id=\"一个简单的例子\"><a class=\"anchor\" href=\"#一个简单的例子\">#</a> 一个简单的例子</h4>\n<p>接下来，我们实现一个爬取豆瓣电影 Top250 电影标题、评分和金句的爬虫。</p>\n<ol>\n<li>\n<p>在 <code>items.py</code>  的 <code>Item</code>  类中定义字段，这些字段用来保存数据，方便后续的操作。</p>\n<pre><code class=\"language-Python\">import scrapy\n\n\nclass DoubanItem(scrapy.Item):\n    title = scrapy.Field()\n    score = scrapy.Field()\n    motto = scrapy.Field()\n</code></pre>\n</li>\n<li>\n<p>修改 <code>spiders</code>  文件夹中名为 <code>douban.py</code>  的文件，它是蜘蛛程序的核心，需要我们添加解析页面的代码。在这里，我们可以通过对 <code>Response</code>  对象的解析，获取电影的信息，代码如下所示。</p>\n<pre><code class=\"language-Python\">import scrapy\nfrom scrapy import Selector, Request\nfrom scrapy.http import HtmlResponse\n\nfrom demo.items import MovieItem\n\n\nclass DoubanSpider(scrapy.Spider):\n    name = 'douban'\n    allowed_domains = ['movie.douban.com']\n    start_urls = ['https://movie.douban.com/top250?start=0&amp;filter=']\n\n    def parse(self, response: HtmlResponse):\n        sel = Selector(response)\n        movie_items = sel.css('#content &gt; div &gt; div.article &gt; ol &gt; li')\n        for movie_sel in movie_items:\n            item = MovieItem()\n            item['title'] = movie_sel.css('.title::text').extract_first()\n            item['score'] = movie_sel.css('.rating_num::text').extract_first()\n            item['motto'] = movie_sel.css('.inq::text').extract_first()\n            yield item\n</code></pre>\n<p>通过上面的代码不难看出，我们可以使用 CSS 选择器进行页面解析。当然，如果你愿意也可以使用 XPath 或正则表达式进行页面解析，对应的方法分别是 <code>xpath</code>  和 <code>re</code> 。</p>\n<p>如果还要生成后续爬取的请求，我们可以用 <code>yield</code>  产出 <code>Request</code>  对象。 <code>Request</code>  对象有两个非常重要的属性，一个是 <code>url</code> ，它代表了要请求的地址；一个是 <code>callback</code> ，它代表了获得响应之后要执行的回调函数。我们可以将上面的代码稍作修改。</p>\n<pre><code class=\"language-Python\">import scrapy\nfrom scrapy import Selector, Request\nfrom scrapy.http import HtmlResponse\n\nfrom demo.items import MovieItem\n\n\nclass DoubanSpider(scrapy.Spider):\n    name = 'douban'\n    allowed_domains = ['movie.douban.com']\n    start_urls = ['https://movie.douban.com/top250?start=0&amp;filter=']\n\n    def parse(self, response: HtmlResponse):\n        sel = Selector(response)\n        movie_items = sel.css('#content &gt; div &gt; div.article &gt; ol &gt; li')\n        for movie_sel in movie_items:\n            item = MovieItem()\n            item['title'] = movie_sel.css('.title::text').extract_first()\n            item['score'] = movie_sel.css('.rating_num::text').extract_first()\n            item['motto'] = movie_sel.css('.inq::text').extract_first()\n            yield item\n\n        hrefs = sel.css('#content &gt; div &gt; div.article &gt; div.paginator &gt; a::attr(&quot;href&quot;)')\n        for href in hrefs:\n            full_url = response.urljoin(href.extract())\n            yield Request(url=full_url)\n</code></pre>\n<p>到这里，我们已经可以通过下面的命令让爬虫运转起来。</p>\n<pre><code class=\"language-Shell\">scrapy crawl movie\n</code></pre>\n<p>可以在控制台看到爬取到的数据，如果想将这些数据保存到文件中，可以通过 <code>-o</code>  参数来指定文件名，Scrapy 支持我们将爬取到的数据导出成 JSON、CSV、XML 等格式。</p>\n<pre><code class=\"language-Shell\">scrapy crawl moive -o result.json\n</code></pre>\n<p>不知大家是否注意到，通过运行爬虫获得的 JSON 文件中有 <code>275</code>  条数据，那是因为首页被重复爬取了。要解决这个问题，可以对上面的代码稍作调整，不在 <code>parse</code>  方法中解析获取新页面的 URL，而是通过 <code>start_requests</code>  方法提前准备好待爬取页面的 URL，调整后的代码如下所示。</p>\n<pre><code class=\"language-Python\">import scrapy\nfrom scrapy import Selector, Request\nfrom scrapy.http import HtmlResponse\n\nfrom demo.items import MovieItem\n\n\nclass DoubanSpider(scrapy.Spider):\n    name = 'douban'\n    allowed_domains = ['movie.douban.com']\n\n    def start_requests(self):\n        for page in range(10):\n            yield Request(url=f'https://movie.douban.com/top250?start=&#123;page * 25&#125;')\n\n    def parse(self, response: HtmlResponse):\n        sel = Selector(response)\n        movie_items = sel.css('#content &gt; div &gt; div.article &gt; ol &gt; li')\n        for movie_sel in movie_items:\n            item = MovieItem()\n            item['title'] = movie_sel.css('.title::text').extract_first()\n            item['score'] = movie_sel.css('.rating_num::text').extract_first()\n            item['motto'] = movie_sel.css('.inq::text').extract_first()\n            yield item\n</code></pre>\n</li>\n<li>\n<p>如果希望完成爬虫数据的持久化，可以在数据管道中处理蜘蛛程序产生的 <code>Item</code>  对象。例如，我们可以通过前面讲到的 <code>openpyxl</code>  操作 Excel 文件，将数据写入 Excel 文件中，代码如下所示。</p>\n<pre><code class=\"language-Python\">import openpyxl\n\nfrom demo.items import MovieItem\n\n\nclass MovieItemPipeline:\n\n    def __init__(self):\n        self.wb = openpyxl.Workbook()\n        self.sheet = self.wb.active\n        self.sheet.title = 'Top250'\n        self.sheet.append(('名称', '评分', '名言'))\n\n    def process_item(self, item: MovieItem, spider):\n        self.sheet.append((item['title'], item['score'], item['motto']))\n        return item\n\n    def close_spider(self, spider):\n        self.wb.save('豆瓣电影数据.xlsx')\n</code></pre>\n<p>上面的 <code>process_item</code>  和 <code>close_spider</code>  都是回调方法（钩子函数）， 简单的说就是 Scrapy 框架会自动去调用的方法。当蜘蛛程序产生一个 <code>Item</code>  对象交给引擎时，引擎会将该 <code>Item</code>  对象交给数据管道，这时我们配置好的数据管道的 <code>parse_item</code>  方法就会被执行，所以我们可以在该方法中获取数据并完成数据的持久化操作。另一个方法 <code>close_spider</code>  是在爬虫结束运行前会自动执行的方法，在上面的代码中，我们在这个地方进行了保存 Excel 文件的操作，相信这段代码大家是很容易读懂的。</p>\n<p>总而言之，数据管道可以帮助我们完成以下操作：</p>\n<ul>\n<li>清理 HTML 数据，验证爬取的数据。</li>\n<li>丢弃重复的不必要的内容。</li>\n<li>将爬取的结果进行持久化操作。</li>\n</ul>\n</li>\n<li>\n<p>修改 <code>settings.py</code>  文件对项目进行配置，主要需要修改以下几个配置。</p>\n<pre><code class=\"language-Python\"># 用户浏览器\nUSER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36'\n\n# 并发请求数量 \nCONCURRENT_REQUESTS = 4\n\n# 下载延迟\nDOWNLOAD_DELAY = 3\n# 随机化下载延迟\nRANDOMIZE_DOWNLOAD_DELAY = True\n\n# 是否遵守爬虫协议\nROBOTSTXT_OBEY = True\n\n# 配置数据管道\nITEM_PIPELINES = &#123;\n   'demo.pipelines.MovieItemPipeline': 300,\n&#125;\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面配置文件中的 <code>ITEM_PIPELINES</code>  选项是一个字典，可以配置多个处理数据的管道，后面的数字代表了执行的优先级，数字小的先执行。</p>\n</blockquote>\n</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/64.%E4%BD%BF%E7%94%A8Selenium%E6%8A%93%E5%8F%96%E7%BD%91%E9%A1%B5%E5%8A%A8%E6%80%81%E5%86%85%E5%AE%B9/",
            "url": "https://scottalive.github.io/computer-science/python/basic/64.%E4%BD%BF%E7%94%A8Selenium%E6%8A%93%E5%8F%96%E7%BD%91%E9%A1%B5%E5%8A%A8%E6%80%81%E5%86%85%E5%AE%B9/",
            "title": "使用Selenium抓取网页动态内容",
            "date_published": "2025-04-20T19:07:49.000Z",
            "content_html": "<h2 id=\"使用selenium抓取网页动态内容\"><a class=\"anchor\" href=\"#使用selenium抓取网页动态内容\">#</a> 使用 Selenium 抓取网页动态内容</h2>\n<p>根据权威机构发布的全球互联网可访问性审计报告，全球约有四分之三的网站其内容或部分内容是通过 JavaScript 动态生成的，这就意味着在浏览器窗口中 “查看网页源代码” 时无法在 HTML 代码中找到这些内容，也就是说我们之前用的抓取数据的方式无法正常运转了。解决这样的问题基本上有两种方案，一是获取提供动态内容的数据接口，这种方式也适用于抓取手机 App 的数据；另一种是通过自动化测试工具 Selenium 运行浏览器获取渲染后的动态内容。对于第一种方案，我们可以使用浏览器的 “开发者工具” 或者更为专业的抓包工具（如：Charles、Fiddler、Wireshark 等）来获取到数据接口，后续的操作跟上一个章节中讲解的获取 “360 图片” 网站的数据是一样的，这里我们不再进行赘述。这一章我们重点讲解如何使用自动化测试工具 Selenium 来获取网站的动态内容。</p>\n<h3 id=\"selenium-介绍\"><a class=\"anchor\" href=\"#selenium-介绍\">#</a> Selenium 介绍</h3>\n<p>Selenium 是一个自动化测试工具，利用它可以驱动浏览器执行特定的行为，最终帮助爬虫开发者获取到网页的动态内容。简单的说，只要我们在浏览器窗口中能够看到的内容，都可以使用 Selenium 获取到，对于那些使用了 JavaScript 动态渲染技术的网站，Selenium 会是一个重要的选择。下面，我们还是以 Chrome 浏览器为例，来讲解 Selenium 的用法，大家需要先安装 Chrome 浏览器并下载它的驱动。Chrome 浏览器的驱动程序可以在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaHJvbWVkcml2ZXIuY2hyb21pdW0ub3JnL2Rvd25sb2Fkcw==\"> ChromeDriver 官网</span>进行下载，驱动的版本要跟浏览器的版本对应，如果没有完全对应的版本，就选择版本代号最为接近的版本。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vamFja2ZydWVkL215cGljL3Jhdy9tYXN0ZXIvMjAyMjAzMTAxMzQ1NTgucG5n\">https://gitee.com/jackfrued/mypic/raw/master/20220310134558.png</span>&quot; style=&quot;zoom: 35%&quot;&gt;</p>\n<h3 id=\"使用selenium\"><a class=\"anchor\" href=\"#使用selenium\">#</a> 使用 Selenium</h3>\n<p>我们可以先通过 <code>pip</code>  来安装 Selenium，命令如下所示。</p>\n<pre><code class=\"language-Shell\">pip install selenium\n</code></pre>\n<h4 id=\"加载页面\"><a class=\"anchor\" href=\"#加载页面\">#</a> 加载页面</h4>\n<p>接下来，我们通过下面的代码驱动 Chrome 浏览器打开百度。</p>\n<pre><code class=\"language-Python\">from selenium import webdriver\n\n# 创建Chrome浏览器对象\nbrowser = webdriver.Chrome()\n# 加载指定的页面\nbrowser.get('https://www.baidu.com/')\n</code></pre>\n<p>如果不愿意使用 Chrome 浏览器，也可以修改上面的代码操控其他浏览器，只需创建对应的浏览器对象（如 Firefox、Safari 等）即可。运行上面的程序，如果看到如下所示的错误提示，那是说明我们还没有将 Chrome 浏览器的驱动添加到 PATH 环境变量中，也没有在程序中指定 Chrome 浏览器驱动所在的位置。</p>\n<pre><code class=\"language-Shell\">selenium.common.exceptions.WebDriverException: Message: 'chromedriver' executable needs to be in PATH. Please see https://sites.google.com/a/chromium.org/chromedriver/home\n</code></pre>\n<p>解决这个问题的办法有三种：</p>\n<ol>\n<li>\n<p>将下载的 ChromeDriver 放到已有的 PATH 环境变量下，建议直接跟 Python 解释器放在同一个目录，因为之前安装 Python 的时候我们已经将 Python 解释器的路径放到 PATH 环境变量中了。</p>\n</li>\n<li>\n<p>将 ChromeDriver 放到项目虚拟环境下的  <code>bin</code>  文件夹中（Windows 系统对应的目录是  <code>Scripts</code> ），这样 ChromeDriver 就跟虚拟环境下的 Python 解释器在同一个位置，肯定是能够找到的。</p>\n</li>\n<li>\n<p>修改上面的代码，在创建 Chrome 对象时，通过 <code>service</code>  参数配置 <code>Service</code>  对象，并通过创建 <code>Service</code>  对象的 <code>executable_path</code>  参数指定 ChromeDriver 所在的位置，如下所示：</p>\n<pre><code class=\"language-Python\">from selenium import webdriver\nfrom selenium.webdriver.chrome.service import Service\n\nbrowser = webdriver.Chrome(service=Service(executable_path='venv/bin/chromedriver'))\nbrowser.get('https://www.baidu.com/')\n</code></pre>\n</li>\n</ol>\n<h4 id=\"查找元素和模拟用户行为\"><a class=\"anchor\" href=\"#查找元素和模拟用户行为\">#</a> 查找元素和模拟用户行为</h4>\n<p>接下来，我们可以尝试模拟用户在百度首页的文本框输入搜索关键字并点击 “百度一下” 按钮。在完成页面加载后，可以通过 <code>Chrome</code>  对象的 <code>find_element</code>  和 <code>find_elements</code>  方法来获取页面元素，Selenium 支持多种获取元素的方式，包括：CSS 选择器、XPath、元素名字（标签名）、元素 ID、类名等，前者可以获取单个页面元素（ <code>WebElement</code>  对象），后者可以获取多个页面元素构成的列表。获取到 <code>WebElement</code>  对象以后，可以通过 <code>send_keys</code>  来模拟用户输入行为，可以通过 <code>click</code>  来模拟用户点击操作，代码如下所示。</p>\n<pre><code class=\"language-Python\">from selenium import webdriver\nfrom selenium.webdriver.common.by import By\n\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.baidu.com/')\n# 通过元素ID获取元素\nkw_input = browser.find_element(By.ID, 'kw')\n# 模拟用户输入行为\nkw_input.send_keys('Python')\n# 通过CSS选择器获取元素\nsu_button = browser.find_element(By.CSS_SELECTOR, '#su')\n# 模拟用户点击行为\nsu_button.click()\n</code></pre>\n<p>如果要执行一个系列动作，例如模拟拖拽操作，可以创建 <code>ActionChains</code>  对象，有兴趣的读者可以自行研究。</p>\n<h4 id=\"隐式等待和显式等待\"><a class=\"anchor\" href=\"#隐式等待和显式等待\">#</a> 隐式等待和显式等待</h4>\n<p>这里还有一个细节需要大家知道，网页上的元素可能是动态生成的，在我们使用 <code>find_element</code>  或 <code>find_elements</code>  方法获取的时候，可能还没有完成渲染，这时会引发 <code>NoSuchElementException</code>  错误。为了解决这个问题，我们可以使用隐式等待的方式，通过设置等待时间让浏览器完成对页面元素的渲染。除此之外，我们还可以使用显示等待，通过创建 <code>WebDriverWait</code>  对象，并设置等待时间和条件，当条件没有满足时，我们可以先等待再尝试进行后续的操作，具体的代码如下所示。</p>\n<pre><code class=\"language-Python\">from selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support import expected_conditions\nfrom selenium.webdriver.support.wait import WebDriverWait\n\nbrowser = webdriver.Chrome()\n# 设置浏览器窗口大小\nbrowser.set_window_size(1200, 800)\nbrowser.get('https://www.baidu.com/')\n# 设置隐式等待时间为10秒\nbrowser.implicitly_wait(10)\nkw_input = browser.find_element(By.ID, 'kw')\nkw_input.send_keys('Python')\nsu_button = browser.find_element(By.CSS_SELECTOR, '#su')\nsu_button.click()\n# 创建显示等待对象\nwait_obj = WebDriverWait(browser, 10)\n# 设置等待条件（等搜索结果的div出现）\nwait_obj.until(\n    expected_conditions.presence_of_element_located(\n        (By.CSS_SELECTOR, '#content_left')\n    )\n)\n# 截屏\nbrowser.get_screenshot_as_file('python_result.png')\n</code></pre>\n<p>上面设置的等待条件 <code>presence_of_element_located</code>  表示等待指定元素出现，下面的表格列出了常用的等待条件及其含义。</p>\n<table>\n<thead>\n<tr>\n<th>等待条件</th>\n<th>具体含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>title_is / title_contains</code></td>\n<td>标题是指定的内容 / 标题包含指定的内容</td>\n</tr>\n<tr>\n<td><code>visibility_of</code></td>\n<td>元素可见</td>\n</tr>\n<tr>\n<td><code>presence_of_element_located</code></td>\n<td>定位的元素加载完成</td>\n</tr>\n<tr>\n<td><code>visibility_of_element_located</code></td>\n<td>定位的元素变得可见</td>\n</tr>\n<tr>\n<td><code>invisibility_of_element_located</code></td>\n<td>定位的元素变得不可见</td>\n</tr>\n<tr>\n<td><code>presence_of_all_elements_located</code></td>\n<td>定位的所有元素加载完成</td>\n</tr>\n<tr>\n<td><code>text_to_be_present_in_element</code></td>\n<td>元素包含指定的内容</td>\n</tr>\n<tr>\n<td><code>text_to_be_present_in_element_value</code></td>\n<td>元素的 <code>value</code>  属性包含指定的内容</td>\n</tr>\n<tr>\n<td><code>frame_to_be_available_and_switch_to_it</code></td>\n<td>载入并切换到指定的内部窗口</td>\n</tr>\n<tr>\n<td><code>element_to_be_clickable</code></td>\n<td>元素可点击</td>\n</tr>\n<tr>\n<td><code>element_to_be_selected</code></td>\n<td>元素被选中</td>\n</tr>\n<tr>\n<td><code>element_located_to_be_selected</code></td>\n<td>定位的元素被选中</td>\n</tr>\n<tr>\n<td><code>alert_is_present</code></td>\n<td>出现 Alert 弹窗</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"执行javascript代码\"><a class=\"anchor\" href=\"#执行javascript代码\">#</a> 执行 JavaScript 代码</h4>\n<p>对于使用瀑布式加载的页面，如果希望在浏览器窗口中加载更多的内容，可以通过浏览器对象的 <code>execute_scripts</code>  方法执行 JavaScript 代码来实现。对于一些高级的爬取操作，也很有可能会用到类似的操作，如果你的爬虫代码需要 JavaScript 的支持，建议先对 JavaScript 进行适当的了解，尤其是 JavaScript 中的 BOM 和 DOM 操作。我们在上面的代码中截屏之前加入下面的代码，这样就可以利用 JavaScript 将网页滚到最下方。</p>\n<pre><code class=\"language-Python\"># 执行JavaScript代码\nbrowser.execute_script('document.documentElement.scrollTop = document.documentElement.scrollHeight')\n</code></pre>\n<h4 id=\"selenium反爬的破解\"><a class=\"anchor\" href=\"#selenium反爬的破解\">#</a> Selenium 反爬的破解</h4>\n<p>有一些网站专门针对 Selenium 设置了反爬措施，因为使用 Selenium 驱动的浏览器，在控制台中可以看到如下所示的 <code>webdriver</code>  属性值为 <code>true</code> ，如果要绕过这项检查，可以在加载页面之前，先通过执行 JavaScript 代码将其修改为 <code>undefined</code> 。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vamFja2ZydWVkL215cGljL3Jhdy9tYXN0ZXIvMjAyMjAzMTAxNTQyNDYucG5n\">https://gitee.com/jackfrued/mypic/raw/master/20220310154246.png</span>&quot; style=&quot;zoom:50%&quot;&gt;</p>\n<p>另一方面，我们还可以将浏览器窗口上的 “Chrome 正受到自动测试软件的控制” 隐藏掉，完整的代码如下所示。</p>\n<pre><code class=\"language-Python\"># 创建Chrome参数对象\noptions = webdriver.ChromeOptions()\n# 添加试验性参数\noptions.add_experimental_option('excludeSwitches', ['enable-automation'])\noptions.add_experimental_option('useAutomationExtension', False)\n# 创建Chrome浏览器对象并传入参数\nbrowser = webdriver.Chrome(options=options)\n# 执行Chrome开发者协议命令（在加载页面时执行指定的JavaScript代码）\nbrowser.execute_cdp_cmd(\n    'Page.addScriptToEvaluateOnNewDocument',\n    &#123;'source': 'Object.defineProperty(navigator, &quot;webdriver&quot;, &#123;get: () =&gt; undefined&#125;)'&#125;\n)\nbrowser.set_window_size(1200, 800)\nbrowser.get('https://www.baidu.com/')\n</code></pre>\n<h4 id=\"无头浏览器\"><a class=\"anchor\" href=\"#无头浏览器\">#</a> 无头浏览器</h4>\n<p>很多时候，我们在爬取数据时并不需要看到浏览器窗口，只要有 Chrome 浏览器以及对应的驱动程序，我们的爬虫就能够运转起来。如果不想看到浏览器窗口，我们可以通过下面的方式设置使用无头浏览器。</p>\n<pre><code class=\"language-Python\">options = webdriver.ChromeOptions()\noptions.add_argument('--headless')\nbrowser = webdriver.Chrome(options=options)\n</code></pre>\n<h3 id=\"api参考\"><a class=\"anchor\" href=\"#api参考\">#</a> API 参考</h3>\n<p>Selenium 相关的知识还有很多，我们在此就不一一赘述了，下面为大家罗列一些浏览器对象和 <code>WebElement</code>  对象常用的属性和方法。具体的内容大家还可以参考 Selenium <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWxlbml1bS1weXRob24temgucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2luZGV4Lmh0bWw=\">官方文档的中文翻译</span>。</p>\n<h4 id=\"浏览器对象\"><a class=\"anchor\" href=\"#浏览器对象\">#</a> 浏览器对象</h4>\n<p>表 1. 常用属性</p>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>current_url</code></td>\n<td>当前页面的 URL</td>\n</tr>\n<tr>\n<td><code>current_window_handle</code></td>\n<td>当前窗口的句柄（引用）</td>\n</tr>\n<tr>\n<td><code>name</code></td>\n<td>浏览器的名称</td>\n</tr>\n<tr>\n<td><code>orientation</code></td>\n<td>当前设备的方向（横屏、竖屏）</td>\n</tr>\n<tr>\n<td><code>page_source</code></td>\n<td>当前页面的源代码（包括动态内容）</td>\n</tr>\n<tr>\n<td><code>title</code></td>\n<td>当前页面的标题</td>\n</tr>\n<tr>\n<td><code>window_handles</code></td>\n<td>浏览器打开的所有窗口的句柄</td>\n</tr>\n</tbody>\n</table>\n<p>表 2. 常用方法</p>\n<table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>back</code>  /  <code>forward</code></td>\n<td>在浏览历史记录中后退 / 前进</td>\n</tr>\n<tr>\n<td><code>close</code>  /  <code>quit</code></td>\n<td>关闭当前浏览器窗口 / 退出浏览器实例</td>\n</tr>\n<tr>\n<td><code>get</code></td>\n<td>加载指定 URL 的页面到浏览器中</td>\n</tr>\n<tr>\n<td><code>maximize_window</code></td>\n<td>将浏览器窗口最大化</td>\n</tr>\n<tr>\n<td><code>refresh</code></td>\n<td>刷新当前页面</td>\n</tr>\n<tr>\n<td><code>set_page_load_timeout</code></td>\n<td>设置页面加载超时时间</td>\n</tr>\n<tr>\n<td><code>set_script_timeout</code></td>\n<td>设置 JavaScript 执行超时时间</td>\n</tr>\n<tr>\n<td><code>implicit_wait</code></td>\n<td>设置等待元素被找到或目标指令完成</td>\n</tr>\n<tr>\n<td><code>get_cookie</code>  /  <code>get_cookies</code></td>\n<td>获取指定的 Cookie / 获取所有 Cookie</td>\n</tr>\n<tr>\n<td><code>add_cookie</code></td>\n<td>添加 Cookie 信息</td>\n</tr>\n<tr>\n<td><code>delete_cookie</code>  /  <code>delete_all_cookies</code></td>\n<td>删除指定的 Cookie / 删除所有 Cookie</td>\n</tr>\n<tr>\n<td><code>find_element</code>  /  <code>find_elements</code></td>\n<td>查找单个元素 / 查找一系列元素</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"webelement对象\"><a class=\"anchor\" href=\"#webelement对象\">#</a> WebElement 对象</h4>\n<p>表 1. WebElement 常用属性</p>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>location</code></td>\n<td>元素的位置</td>\n</tr>\n<tr>\n<td><code>size</code></td>\n<td>元素的尺寸</td>\n</tr>\n<tr>\n<td><code>text</code></td>\n<td>元素的文本内容</td>\n</tr>\n<tr>\n<td><code>id</code></td>\n<td>元素的 ID</td>\n</tr>\n<tr>\n<td><code>tag_name</code></td>\n<td>元素的标签名</td>\n</tr>\n</tbody>\n</table>\n<p>表 2. 常用方法</p>\n<table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>clear</code></td>\n<td>清空文本框或文本域中的内容</td>\n</tr>\n<tr>\n<td><code>click</code></td>\n<td>点击元素</td>\n</tr>\n<tr>\n<td><code>get_attribute</code></td>\n<td>获取元素的属性值</td>\n</tr>\n<tr>\n<td><code>is_displayed</code></td>\n<td>判断元素对于用户是否可见</td>\n</tr>\n<tr>\n<td><code>is_enabled</code></td>\n<td>判断元素是否处于可用状态</td>\n</tr>\n<tr>\n<td><code>is_selected</code></td>\n<td>判断元素（单选框和复选框）是否被选中</td>\n</tr>\n<tr>\n<td><code>send_keys</code></td>\n<td>模拟输入文本</td>\n</tr>\n<tr>\n<td><code>submit</code></td>\n<td>提交表单</td>\n</tr>\n<tr>\n<td><code>value_of_css_property</code></td>\n<td>获取指定的 CSS 属性值</td>\n</tr>\n<tr>\n<td><code>find_element</code>  /  <code>find_elements</code></td>\n<td>获取单个子元素 / 获取一系列子元素</td>\n</tr>\n<tr>\n<td><code>screenshot</code></td>\n<td>为元素生成快照</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"简单案例\"><a class=\"anchor\" href=\"#简单案例\">#</a> 简单案例</h3>\n<p>下面的例子演示了如何使用 Selenium 从 “360 图片” 网站搜索和下载图片。</p>\n<pre><code class=\"language-Python\">import os\nimport time\nfrom concurrent.futures import ThreadPoolExecutor\n\nimport requests\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.common.keys import Keys\n\nDOWNLOAD_PATH = 'images/'\n\n\ndef download_picture(picture_url: str):\n    &quot;&quot;&quot;\n    下载保存图片\n    :param picture_url: 图片的URL\n    &quot;&quot;&quot;\n    filename = picture_url[picture_url.rfind('/') + 1:]\n    resp = requests.get(picture_url)\n    with open(os.path.join(DOWNLOAD_PATH, filename), 'wb') as file:\n        file.write(resp.content)\n\n\nif not os.path.exists(DOWNLOAD_PATH):\n    os.makedirs(DOWNLOAD_PATH)\nbrowser = webdriver.Chrome()\nbrowser.get('https://image.so.com/z?ch=beauty')\nbrowser.implicitly_wait(10)\nkw_input = browser.find_element(By.CSS_SELECTOR, 'input[name=q]')\nkw_input.send_keys('苍老师')\nkw_input.send_keys(Keys.ENTER)\nfor _ in range(10):\n    browser.execute_script(\n        'document.documentElement.scrollTop = document.documentElement.scrollHeight'\n    )\n    time.sleep(1)\nimgs = browser.find_elements(By.CSS_SELECTOR, 'div.waterfall img')\nwith ThreadPoolExecutor(max_workers=32) as pool:\n    for img in imgs:\n        pic_url = img.get_attribute('src')\n        pool.submit(download_picture, pic_url)\n</code></pre>\n<p>运行上面的代码，检查指定的目录下是否下载了根据关键词搜索到的图片。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-3/",
            "url": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-3/",
            "title": "Python中的并发编程-3",
            "date_published": "2025-04-19T19:07:49.000Z",
            "content_html": "<h2 id=\"python中的并发编程-3\"><a class=\"anchor\" href=\"#python中的并发编程-3\">#</a> Python 中的并发编程 - 3</h2>\n<p>爬虫是典型的 I/O 密集型任务，I/O 密集型任务的特点就是程序会经常性的因为 I/O 操作而进入阻塞状态，比如我们之前使用 <code>requests</code>  获取页面代码或二进制内容，发出一个请求之后，程序必须要等待网站返回响应之后才能继续运行，如果目标网站不是很给力或者网络状况不是很理想，那么等待响应的时间可能会很久，而在这个过程中整个程序是一直阻塞在那里，没有做任何的事情。通过前面的课程，我们已经知道了可以通过多线程的方式为爬虫提速，使用多线程的本质就是，当一个线程阻塞的时候，程序还有其他的线程可以继续运转，因此整个程序就不会在阻塞和等待中浪费了大量的时间。</p>\n<p>事实上，还有一种非常适合 I/O 密集型任务的并发编程方式，我们称之为异步编程，你也可以将它称为异步 I/O。这种方式并不需要启动多个线程或多个进程来实现并发，它是通过多个子程序相互协作的方式来提升 CPU 的利用率，解决了 I/O 密集型任务 CPU  利用率很低的问题，我一般将这种方式称为 “协作式并发”。这里，我不打算探讨操作系统的各种 I/O 模式，因为这对很多读者来说都太过抽象；但是我们得先抛出两组概念给大家，一组叫做 “阻塞” 和 “非阻塞”，一组叫做 “同步” 和 “异步”。</p>\n<h3 id=\"基本概念\"><a class=\"anchor\" href=\"#基本概念\">#</a> 基本概念</h3>\n<h4 id=\"阻塞\"><a class=\"anchor\" href=\"#阻塞\">#</a> 阻塞</h4>\n<p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。阻塞随时都可能发生，最典型的就是 I/O 中断（包括网络 I/O 、磁盘 I/O 、用户输入等）、休眠操作、等待某个线程执行结束，甚至包括在 CPU 切换上下文时，程序都无法真正的执行，这就是所谓的阻塞。</p>\n<h4 id=\"非阻塞\"><a class=\"anchor\" href=\"#非阻塞\">#</a> 非阻塞</h4>\n<p>程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。显然，某个操作的阻塞可能会导程序耗时以及效率低下，所以我们会希望把它变成非阻塞的。</p>\n<h4 id=\"同步\"><a class=\"anchor\" href=\"#同步\">#</a> 同步</h4>\n<p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。例如前面讲过的给银行账户存钱的操作，我们在代码中使用了 “锁” 作为通信信号，让多个存钱操作强制排队顺序执行，这就是所谓的同步。</p>\n<h4 id=\"异步\"><a class=\"anchor\" href=\"#异步\">#</a> 异步</h4>\n<p>不同程序单元在执行过程中无需通信协调，也能够完成一个任务，这种方式我们就称之为异步。例如，使用爬虫下载页面时，调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是不相关的，也无需相互通知协调。很显然，异步操作的完成时刻和先后顺序并不能确定。</p>\n<p>很多人都不太能准确的把握这几个概念，这里我们简单的总结一下，同步与异步的关注点是<strong>消息通信机制</strong>，最终表现出来的是 “有序” 和 “无序” 的区别；阻塞和非阻塞的关注点是<strong>程序在等待消息时状态</strong>，最终表现出来的是程序在等待时能不能做点别的。如果想深入理解这些内容，推荐大家阅读经典著作<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pdGVtLmpkLmNvbS8xMTg4MDA0Ny5odG1s\">《UNIX 网络编程》</span>，这本书非常的赞。</p>\n<h3 id=\"生成器和协程\"><a class=\"anchor\" href=\"#生成器和协程\">#</a> 生成器和协程</h3>\n<p>前面我们说过，异步编程是一种 “协作式并发”，即通过多个子程序相互协作的方式提升 CPU 的利用率，从而减少程序在阻塞和等待中浪费的时间，最终达到并发的效果。我们可以将多个相互协作的子程序称为 “协程”，它是实现异步编程的关键。在介绍协程之前，我们先通过下面的代码，看看什么是生成器。</p>\n<pre><code class=\"language-Python\">def fib(max_count):\n    a, b = 0, 1\n    for _ in range(max_count):\n        a, b = b, a + b\n        yield a\n</code></pre>\n<p>上面我们编写了一个生成斐波那契数列的生成器，调用上面的 <code>fib</code>  函数并不是执行该函数获得返回值，因为 <code>fib</code>  函数中有一个特殊的关键字 <code>yield</code> 。这个关键字使得 <code>fib</code>  函数跟普通的函数有些区别，调用该函数会得到一个生成器对象，我们可以通过下面的代码来验证这一点。</p>\n<pre><code class=\"language-Python\">gen_obj = fib(20)\nprint(gen_obj)\n</code></pre>\n<p>输出：</p>\n<pre><code>&lt;generator object fib at 0x106daee40&gt;\n</code></pre>\n<p>我们可以使用内置函数 <code>next</code>  从生成器对象中获取斐波那契数列的值，也可以通过 <code>for-in</code>  循环对生成器能够提供的值进行遍历，代码如下所示。</p>\n<pre><code class=\"language-Python\">for value in gen_obj:\n    print(value)\n</code></pre>\n<p>生成器经过预激活，就是一个协程，它可以跟其他子程序协作。</p>\n<pre><code class=\"language-Python\">def calc_average():\n    total, counter = 0, 0\n    avg_value = None\n    while True:\n        curr_value = yield avg_value\n        total += curr_value\n        counter += 1\n        avg_value = total / counter\n\n\ndef main():\n    obj = calc_average()\n    # 生成器预激活\n    obj.send(None)\n    for _ in range(5):\n        print(obj.send(float(input())))\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面的 <code>main</code>  函数首先通过生成器对象的 <code>send</code>  方法发送一个 <code>None</code>  值来将其激活为协程，也可以通过 <code>next(obj)</code>  达到同样的效果。接下来，协程对象会接收 <code>main</code>  函数发送的数据并产出（ <code>yield</code> ）数据的平均值。通过上面的例子，不知道大家是否看出两段子程序是怎么 “协作” 的。</p>\n<h3 id=\"异步函数\"><a class=\"anchor\" href=\"#异步函数\">#</a> 异步函数</h3>\n<p>Python 3.5 版本中，引入了两个非常有意思的元素，一个叫 <code>async</code> ，一个叫 <code>await</code> ，它们在 Python 3.7 版本中成为了正式的关键字。通过这两个关键字，可以简化协程代码的编写，可以用更为简单的方式让多个子程序很好的协作起来。我们通过一个例子来加以说明，请大家先看看下面的代码。</p>\n<pre><code class=\"language-Python\">import time\n\n\ndef display(num):\n    time.sleep(1)\n    print(num)\n\n\ndef main():\n    start = time.time()\n    for i in range(1, 10):\n        display(i)\n    end = time.time()\n    print(f'&#123;end - start:.3f&#125;秒')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面的代码每次执行都会依次输出 <code>1</code>  到 <code>9</code>  的数字，每个间隔 <code>1</code>  秒钟，整个代码需要执行大概需要 <code>9</code>  秒多的时间，这一点我相信大家都能看懂。不知道大家是否意识到，这段代码就是以同步和阻塞的方式执行的，同步可以从代码的输出看出来，而阻塞是指在调用 <code>display</code>  函数发生休眠时，整个代码的其他部分都不能继续执行，必须等待休眠结束。</p>\n<p>接下来，我们尝试用异步的方式改写上面的代码，让 <code>display</code>  函数以异步的方式运转。</p>\n<pre><code class=\"language-Python\">import asyncio\nimport time\n\n\nasync def display(num):\n    await asyncio.sleep(1)\n    print(num)\n\n\ndef main():\n    start = time.time()\n    objs = [display(i) for i in range(1, 10)]\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(asyncio.wait(objs))\n    loop.close()\n    end = time.time()\n    print(f'&#123;end - start:.3f&#125;秒')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>Python 中的 <code>asyncio</code>  模块提供了对异步 I/O 的支持。上面的代码中，我们首先在 <code>display</code>  函数前面加上了 <code>async</code>  关键字使其变成一个异步函数，调用异步函数不会执行函数体而是获得一个协程对象。我们将 <code>display</code>  函数中的 <code>time.sleep(1)</code>  修改为 <code>await asyncio.sleep(1)</code> ，二者的区别在于，后者不会让整个代码陷入阻塞，因为 <code>await</code>  操作会让其他协作的子程序有获得 CPU 资源而得以运转的机会。为了让这些子程序可以协作起来，我们需要将他们放到一个事件循环（实现消息分派传递的系统）上，因为<strong>当协程遭遇 I/O 操作阻塞时，就会到事件循环中监听 I/O 操作是否完成，并注册自身的上下文以及自身的唤醒函数（以便恢复执行），之后该协程就变为阻塞状态</strong>。上面的第 12 行代码创建了 <code>9</code>  个协程对象并放到一个列表中，第 13 行代码通过 <code>asyncio</code>  模块的 <code>get_event_loop</code>  函数获得了系统的事件循环，第 14 行通过 <code>asyncio</code>  模块的 <code>run_until_complete</code>  函数将协程对象挂载到事件循环上。执行上面的代码会发现， <code>9</code>  个分别会阻塞 <code>1</code>  秒钟的协程总共只阻塞了约 <code>1</code>  秒种的时间，因为<strong>阻塞的协程对象会放弃对 CPU 的占有而不是让 CPU 处于闲置状态，这种方式大大的提升了 CPU 的利用率</strong>。而且我们还会注意到，数字并不是按照从 <code>1</code>  到 <code>9</code>  的顺序打印输出的，这正是我们想要的结果，说明它们是<strong>异步执行</strong>的。对于爬虫这样的 I/O 密集型任务来说，这种协作式并发在很多场景下是比使用多线程更好的选择，因为这种做法减少了管理和维护多个线程以及多个线程切换所带来的开销。</p>\n<h3 id=\"aiohttp库\"><a class=\"anchor\" href=\"#aiohttp库\">#</a> aiohttp 库</h3>\n<p>我们之前使用的 <code>requests</code>  三方库并不支持异步 I/O，如果希望使用异步 I/O 的方式来加速爬虫代码的执行，我们可以安装和使用名为 <code>aiohttp</code>  的三方库。</p>\n<p>安装 <code>aiohttp</code> 。</p>\n<pre><code class=\"language-Bash\">pip install aiohttp\n</code></pre>\n<p>下面的代码使用 <code>aiohttp</code>  抓取了 <code>10</code>  个网站的首页并解析出它们的标题。</p>\n<pre><code class=\"language-Python\">import asyncio\nimport re\n\nimport aiohttp\nfrom aiohttp import ClientSession\n\nTITLE_PATTERN = re.compile(r'&lt;title.*?&gt;(.*?)&lt;/title&gt;', re.DOTALL)\n\n\nasync def fetch_page_title(url):\n    async with aiohttp.ClientSession(headers=&#123;\n        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36',\n    &#125;) as session:  # type: ClientSession\n        async with session.get(url, ssl=False) as resp:\n            if resp.status == 200:\n                html_code = await resp.text()\n                matcher = TITLE_PATTERN.search(html_code)\n                title = matcher.group(1).strip()\n                print(title)\n\n\ndef main():\n    urls = [\n        'https://www.python.org/',\n        'https://www.jd.com/',\n        'https://www.baidu.com/',\n        'https://www.taobao.com/',\n        'https://git-scm.com/',\n        'https://www.sohu.com/',\n        'https://gitee.com/',\n        'https://www.amazon.com/',\n        'https://www.usa.gov/',\n        'https://www.nasa.gov/'\n    ]\n    objs = [fetch_page_title(url) for url in urls]\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(asyncio.wait(objs))\n    loop.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>输出：</p>\n<pre><code>京东(JD.COM)-正品低价、品质保障、配送及时、轻松购物！\n搜狐\n淘宝网 - 淘！我喜欢\n百度一下，你就知道\nGitee - 基于 Git 的代码托管和研发协作平台\nGit\nNASA\nOfficial Guide to Government Information and Services   &amp;#124; USAGov\nAmazon.com. Spend less. Smile more.\nWelcome to Python.org\n</code></pre>\n<p>从上面的输出可以看出，网站首页标题的输出顺序跟它们的 URL 在列表中的顺序没有关系。代码的第 11 行到第 13 行创建了 <code>ClientSession</code>  对象，通过它的 <code>get</code>  方法可以向指定的 URL 发起请求，如第 14 行所示，跟 <code>requests</code>  中的 <code>Session</code>  对象并没有本质区别，唯一的区别是这里使用了异步上下文。代码第 16 行的 <code>await</code>  会让因为 I/O 操作阻塞的子程序放弃对 CPU 的占用，这使得其他的子程序可以运转起来去抓取页面。代码的第 17 行和第 18 行使用了正则表达式捕获组操作解析网页标题。 <code>fetch_page_title</code>  是一个被 <code>async</code>  关键字修饰的异步函数，调用该函数会获得协程对象，如代码第 35 行所示。后面的代码跟之前的例子没有什么区别，相信大家能够理解。</p>\n<p>大家可以尝试将 <code>aiohttp</code>  换回到 <code>requests</code> ，看看不使用异步 I/O 也不使用多线程，到底和上面的代码有什么区别，相信通过这样的对比，大家能够更深刻的理解我们之前强调的几个概念：同步和异步，阻塞和非阻塞。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-2/",
            "url": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-2/",
            "title": "Python中的并发编程-2",
            "date_published": "2025-04-18T19:07:49.000Z",
            "content_html": "<h2 id=\"python中的并发编程-2\"><a class=\"anchor\" href=\"#python中的并发编程-2\">#</a> Python 中的并发编程 - 2</h2>\n<p>在上一课中我们说过，由于 GIL 的存在，CPython 中的多线程并不能发挥 CPU 的多核优势，如果希望突破 GIL 的限制，可以考虑使用多进程。对于多进程的程序，每个进程都有一个属于自己的 GIL，所以多进程不会受到 GIL 的影响。那么，我们应该如何在 Python 程序中创建和使用多进程呢？</p>\n<p>### 创建进程</p>\n<p>在 Python 中可以基于 <code>Process</code>  类来创建进程，虽然进程和线程有着本质的差别，但是 <code>Process</code>  类和 <code>Thread</code>  类的用法却非常类似。在使用 <code>Process</code>  类的构造器创建对象时，也是通过 <code>target</code>  参数传入一个函数来指定进程要执行的代码，而 <code>args</code>  和 <code>kwargs</code>  参数可以指定该函数使用的参数值。</p>\n<pre><code class=\"language-Python\">from multiprocessing import Process, current_process\nfrom time import sleep\n\n\ndef sub_task(content, nums):\n    # 通过current_process函数获取当前进程对象\n    # 通过进程对象的pid和name属性获取进程的ID号和名字\n    print(f'PID: &#123;current_process().pid&#125;')\n    print(f'Name: &#123;current_process().name&#125;')\n    # 通过下面的输出不难发现，每个进程都有自己的nums列表，进程之间本就不共享内存\n    # 在创建子进程时复制了父进程的数据结构，三个进程从列表中pop(0)得到的值都是20\n    counter, total = 0, nums.pop(0)\n    print(f'Loop count: &#123;total&#125;')\n    sleep(0.5)\n    while counter &lt; total:\n        counter += 1\n        print(f'&#123;counter&#125;: &#123;content&#125;')\n        sleep(0.01)\n\n\ndef main():\n    nums = [20, 30, 40]\n    # 创建并启动进程来执行指定的函数\n    Process(target=sub_task, args=('Ping', nums)).start()\n    Process(target=sub_task, args=('Pong', nums)).start()\n    # 在主进程中执行sub_task函数\n    sub_task('Good', nums)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码通过 <code>current_process</code>  函数获取当前进程对象，再通过进程对象的 <code>pid</code>  属性获取进程 ID。在 Python 中，使用 <code>os</code>  模块的 <code>getpid</code>  函数也可以达到同样的效果。</p>\n</blockquote>\n<p>如果愿意，也可以使用 <code>os</code>  模块的 <code>fork</code>  函数来创建进程，调用该函数时，操作系统自动把当前进程（父进程）复制一份（子进程），父进程的 <code>fork</code>  函数会返回子进程的 ID，而子进程中的 <code>fork</code>  函数会返回 <code>0</code> ，也就是说这个函数调用一次会在父进程和子进程中得到两个不同的返回值。需要注意的是，Windows 系统并不支持 <code>fork</code>  函数，如果你使用的是 Linux 或 macOS 系统，可以试试下面的代码。</p>\n<pre><code class=\"language-Python\">import os\n\nprint(f'PID: &#123;os.getpid()&#125;')\npid = os.fork()\nif pid == 0:\n    print(f'子进程 - PID: &#123;os.getpid()&#125;')\n    print('Todo: 在子进程中执行的代码')\nelse:\n    print(f'父进程 - PID: &#123;os.getpid()&#125;')\n    print('Todo: 在父进程中执行的代码')\n</code></pre>\n<p>简而言之，我们还是推荐大家通过直接使用 <code>Process</code>  类、继承 <code>Process</code>  类和使用进程池（ <code>ProcessPoolExecutor</code> ）这三种方式来创建和使用多进程，这三种方式不同于上面的 <code>fork</code>  函数，能够保证代码的兼容性和可移植性。具体的做法跟之前讲过的创建和使用多线程的方式比较接近，此处不再进行赘述。</p>\n<h3 id=\"多进程和多线程的比较\"><a class=\"anchor\" href=\"#多进程和多线程的比较\">#</a> 多进程和多线程的比较</h3>\n<p>对于爬虫这类 I/O 密集型任务来说，使用多进程并没有什么优势；但是对于计算密集型任务来说，多进程相比多线程，在效率上会有显著的提升，我们可以通过下面的代码来加以证明。下面的代码会通过多线程和多进程两种方式来判断一组大整数是不是质数，很显然这是一个计算密集型任务，我们将任务分别放到多个线程和多个进程中来加速代码的执行，让我们看看多线程和多进程的代码具体表现有何不同。</p>\n<p>我们先实现一个多线程的版本，代码如下所示。</p>\n<pre><code class=\"language-Python\">import concurrent.futures\n\nPRIMES = [\n    1116281,\n    1297337,\n    104395303,\n    472882027,\n    533000389,\n    817504243,\n    982451653,\n    112272535095293,\n    112582705942171,\n    112272535095293,\n    115280095190773,\n    115797848077099,\n    1099726899285419\n] * 5\n\n\ndef is_prime(n):\n    &quot;&quot;&quot;判断素数&quot;&quot;&quot;\n    for i in range(2, int(n ** 0.5) + 1):\n        if n % i == 0:\n            return False\n    return n != 1\n\n\ndef main():\n    &quot;&quot;&quot;主函数&quot;&quot;&quot;\n    with concurrent.futures.ThreadPoolExecutor(max_workers=16) as executor:\n        for number, prime in zip(PRIMES, executor.map(is_prime, PRIMES)):\n            print('%d is prime: %s' % (number, prime))\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>假设上面的代码保存在名为 <code>example.py</code>  的文件中，在 Linux 或 macOS 系统上，可以使用 <code>time python example.py</code>  命令执行程序并获得操作系统关于执行时间的统计，在我的 macOS 上，某次的运行结果的最后一行输出如下所示。</p>\n<pre><code>python example09.py  38.69s user 1.01s system 101% cpu 39.213 total\n</code></pre>\n<p>从运行结果可以看出，多线程的代码只能让 CPU 利用率达到 100%，这其实已经证明了多线程的代码无法利用 CPU 多核特性来加速代码的执行，我们再看看多进程的版本，我们将上面代码中的线程池（ <code>ThreadPoolExecutor</code> ）更换为进程池（ <code>ProcessPoolExecutor</code> ）。</p>\n<p>多进程的版本。</p>\n<pre><code class=\"language-Python\">import concurrent.futures\n\nPRIMES = [\n    1116281,\n    1297337,\n    104395303,\n    472882027,\n    533000389,\n    817504243,\n    982451653,\n    112272535095293,\n    112582705942171,\n    112272535095293,\n    115280095190773,\n    115797848077099,\n    1099726899285419\n] * 5\n\n\ndef is_prime(n):\n    &quot;&quot;&quot;判断素数&quot;&quot;&quot;\n    for i in range(2, int(n ** 0.5) + 1):\n        if n % i == 0:\n            return False\n    return n != 1\n\n\ndef main():\n    &quot;&quot;&quot;主函数&quot;&quot;&quot;\n    with concurrent.futures.ProcessPoolExecutor(max_workers=16) as executor:\n        for number, prime in zip(PRIMES, executor.map(is_prime, PRIMES)):\n            print('%d is prime: %s' % (number, prime))\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>：运行上面的代码时，可以通过操作系统的任务管理器（资源监视器）来查看是否启动了多个 Python  解释器进程。</p>\n</blockquote>\n<p>我们仍然通过 <code>time python example.py</code>  的方式来执行上述代码，运行结果的最后一行如下所示。</p>\n<pre><code>python example09.py 106.63s user 0.57s system 389% cpu 27.497 total\n</code></pre>\n<p>可以看出，多进程的版本在我使用的这台电脑上，让 CPU 的利用率达到了将近 400%，而运行代码时用户态耗费的 CPU 的时间（106.63 秒）几乎是代码运行总时间（27.497 秒）的 4 倍，从这两点都可以看出，我的电脑使用了一款 4 核的 CPU。当然，要知道自己的电脑有几个 CPU 或几个核，可以直接使用下面的代码。</p>\n<pre><code class=\"language-Python\">import os\n\nprint(os.cpu_count())\n</code></pre>\n<p>综上所述，多进程可以突破 GIL 的限制，充分利用 CPU 多核特性，对于计算密集型任务，这一点是相当重要的。常见的计算密集型任务包括科学计算、图像处理、音视频编解码等，如果这些计算密集型任务本身是可以并行的，那么使用多进程应该是更好的选择。</p>\n<h3 id=\"进程间通信\"><a class=\"anchor\" href=\"#进程间通信\">#</a> 进程间通信</h3>\n<p>在讲解进程间通信之前，先给大家一个任务：启动两个进程，一个输出 “Ping”，一个输出 “Pong”，两个进程输出的 “Ping” 和 “Pong” 加起来一共有 50 个时，就结束程序。听起来是不是非常简单，但是实际编写代码时，由于多个进程之间不能够像多个线程之间直接通过共享内存的方式交换数据，所以下面的代码是达不到我们想要的结果的。</p>\n<pre><code class=\"language-Python\">from multiprocessing import Process\nfrom time import sleep\n\ncounter = 0\n\n\ndef sub_task(string):\n    global counter\n    while counter &lt; 50:\n        print(string, end='', flush=True)\n        counter += 1\n        sleep(0.01)\n\n        \ndef main():\n    Process(target=sub_task, args=('Ping', )).start()\n    Process(target=sub_task, args=('Pong', )).start()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面的代码看起来没毛病，但是最后的结果是 “Ping” 和 “Pong” 各输出了 50 个。再次提醒大家，当我们在程序中创建进程的时候，子进程会复制父进程及其所有的数据结构，每个子进程有自己独立的内存空间，这也就意味着两个子进程中各有一个 <code>counter</code>  变量，它们都会从 <code>0</code>  加到 <code>50</code> ，所以结果就可想而知了。要解决这个问题比较简单的办法是使用 <code>multiprocessing</code>  模块中的 <code>Queue</code>  类，它是可以被多个进程共享的队列，底层是通过操作系统底层的管道和信号量（semaphore）机制来实现的，代码如下所示。</p>\n<pre><code class=\"language-Python\">import time\nfrom multiprocessing import Process, Queue\n\n\ndef sub_task(content, queue):\n    counter = queue.get()\n    while counter &lt; 50:\n        print(content, end='', flush=True)\n        counter += 1\n        queue.put(counter)\n        time.sleep(0.01)\n        counter = queue.get()\n\n\ndef main():\n    queue = Queue()\n    queue.put(0)\n    p1 = Process(target=sub_task, args=('Ping', queue))\n    p1.start()\n    p2 = Process(target=sub_task, args=('Pong', queue))\n    p2.start()\n    while p1.is_alive() and p2.is_alive():\n        pass\n    queue.put(50)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>提示</strong>： <code>multiprocessing.Queue</code>  对象的 <code>get</code>  方法默认在队列为空时是会阻塞的，直到获取到数据才会返回。如果不希望该方法阻塞以及需要指定阻塞的超时时间，可以通过指定 <code>block</code>  和 <code>timeout</code>  参数进行设定。</p>\n</blockquote>\n<p>上面的代码通过 <code>Queue</code>  类的 <code>get</code>  和 <code>put</code>  方法让三个进程（ <code>p1</code> 、 <code>p2</code>  和主进程）实现了数据的共享，这就是所谓的进程间的通信，通过这种方式，当 <code>Queue</code>  中取出的值已经大于等于 <code>50</code>  时， <code>p1</code>  和 <code>p2</code>  就会跳出 <code>while</code>  循环，从而终止进程的执行。代码第 22 行的循环是为了等待 <code>p1</code>  和 <code>p2</code>  两个进程中的一个结束，这时候主进程还需要向 <code>Queue</code>  中放置一个大于等于 <code>50</code>  的值，这样另一个尚未结束的进程也会因为读到这个大于等于 <code>50</code>  的值而终止。</p>\n<p>进程间通信的方式还有很多，比如使用套接字也可以实现两个进程的通信，甚至于这两个进程并不在同一台主机上，有兴趣的读者可以自行了解。</p>\n<h3 id=\"简单的总结\"><a class=\"anchor\" href=\"#简单的总结\">#</a> 简单的总结</h3>\n<p>在 Python 中，我们还可以通过 <code>subprocess</code>  模块的 <code>call</code>  函数执行其他的命令来创建子进程，相当于就是在我们的程序中调用其他程序，这里我们暂不探讨这些知识，有兴趣的读者可以自行研究。</p>\n<p>对于 Python 开发者来说，以下情况需要考虑使用多线程：</p>\n<ol>\n<li>程序需要维护许多共享的状态（尤其是可变状态），Python 中的列表、字典、集合都是线程安全的（多个线程同时操作同一个列表、字典或集合，不会引发错误和数据问题），所以使用线程而不是进程维护共享状态的代价相对较小。</li>\n<li>程序会花费大量时间在 I/O 操作上，没有太多并行计算的需求且不需占用太多的内存。</li>\n</ol>\n<p>那么在遇到下列情况时，应该考虑使用多进程：</p>\n<ol>\n<li>程序执行计算密集型任务（如：音视频编解码、数据压缩、科学计算等）。</li>\n<li>程序的输入可以并行的分成块，并且可以将运算结果合并。</li>\n<li>程序在内存使用方面没有任何限制且不强依赖于 I/O 操作（如读写文件、套接字等）。</li>\n</ol>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-1/",
            "url": "https://scottalive.github.io/computer-science/python/basic/63.Python%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-1/",
            "title": "Python中的并发编程-1",
            "date_published": "2025-04-17T19:07:49.000Z",
            "content_html": "<h2 id=\"python中的并发编程-1\"><a class=\"anchor\" href=\"#python中的并发编程-1\">#</a> Python 中的并发编程 - 1</h2>\n<p>现如今，我们使用的计算机早已是多 CPU 或多核的计算机，而我们使用的操作系统基本都支持 “多任务”，这使得我们可以同时运行多个程序，也可以将一个程序分解为若干个相对独立的子任务，让多个子任务 “并行” 或 “并发” 的执行，从而缩短程序的执行时间，同时也让用户获得更好的体验。因此当下，不管用什么编程语言进行开发，实现 “并行” 或 “并发” 编程已经成为了程序员的标配技能。为了讲述如何在 Python 程序中实现 “并行” 或 “并发”，我们需要先了解两个重要的概念：进程和线程。</p>\n<h3 id=\"线程和进程\"><a class=\"anchor\" href=\"#线程和进程\">#</a> 线程和进程</h3>\n<p>我们通过操作系统运行一个程序会创建出一个或多个进程，进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动。简单的说，进程是操作系统分配存储空间的基本单位，每个进程都有自己的地址空间、数据栈以及其他用于跟踪进程执行的辅助数据；操作系统管理所有进程的执行，为它们合理的分配资源。一个进程可以通过 fork 或 spawn 的方式创建新的进程来执行其他的任务，不过新的进程也有自己独立的内存空间，因此两个进程如果要共享数据，必须通过进程间通信机制来实现，具体的方式包括管道、信号、套接字等。</p>\n<p>一个进程还可以拥有多个执行线索，简单的说就是拥有多个可以获得 CPU 调度的执行单元，这就是所谓的线程。由于线程在同一个进程下，它们可以共享相同的上下文，因此相对于进程而言，线程间的信息共享和通信更加容易。当然在单核 CPU 系统中，多个线程不可能同时执行，因为在某个时刻只有一个线程能够获得 CPU，多个线程通过共享 CPU 执行时间的方式来达到并发的效果。</p>\n<p>在程序中使用多线程技术通常都会带来不言而喻的好处，最主要的体现在提升程序的性能和改善用户体验，今天我们使用的软件几乎都用到了多线程技术，这一点可以利用系统自带的进程监控工具（如 macOS 中的 “活动监视器”、Windows 中的 “任务管理器”）来证实，如下图所示。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vamFja2ZydWVkL215cGljL3Jhdy9tYXN0ZXIvMjAyMTA4MjIwOTQyNDMucG5n\">https://gitee.com/jackfrued/mypic/raw/master/20210822094243.png</span>&quot; width=&quot;80%&quot;&gt;</p>\n<p>这里，我们还需要跟大家再次强调两个概念：<strong>并发</strong>（concurrency）和<strong>并行</strong>（parallel）。<strong>并发</strong>通常是指同一时刻只能有一条指令执行，但是多个线程对应的指令被快速轮换地执行。比如一个处理器，它先执行线程 A 的指令一段时间，再执行线程 B 的指令一段时间，再切回到线程 A 执行一段时间。由于处理器执行指令的速度和切换的速度极快，人们完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行，但微观上其实只有一个线程在执行。<strong>并行</strong>是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器，不论是从宏观上还是微观上，多个线程可以在同一时刻一起执行的。很多时候，我们并不用严格区分并发和并行两个词，所以我们有时候也把 Python 中的多线程、多进程以及异步 I/O 都视为实现并发编程的手段，但实际上前面两者也可以实现并行编程，当然这里还有一个全局解释器锁（GIL）的问题，我们稍后讨论。</p>\n<h3 id=\"多线程编程\"><a class=\"anchor\" href=\"#多线程编程\">#</a> 多线程编程</h3>\n<p>Python 标准库中 <code>threading</code>  模块的 <code>Thread</code>  类可以帮助我们非常轻松的实现多线程编程。我们用一个联网下载文件的例子来对比使用多线程和不使用多线程到底有什么区别，代码如下所示。</p>\n<p>不使用多线程的下载。</p>\n<pre><code class=\"language-Python\">import random\nimport time\n\n\ndef download(*, filename):\n    start = time.time()\n    print(f'开始下载 &#123;filename&#125;.')\n    time.sleep(random.randint(3, 6))\n    print(f'&#123;filename&#125; 下载完成.')\n    end = time.time()\n    print(f'下载耗时: &#123;end - start:.3f&#125;秒.')\n\n\ndef main():\n    start = time.time()\n    download(filename='Python从入门到住院.pdf')\n    download(filename='MySQL从删库到跑路.avi')\n    download(filename='Linux从精通到放弃.mp4')\n    end = time.time()\n    print(f'总耗时: &#123;end - start:.3f&#125;秒.')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码并没有真正实现联网下载的功能，而是通过 <code>time.sleep()</code>  休眠一段时间来模拟下载文件需要一些时间上的开销，跟实际下载的状况比较类似。</p>\n</blockquote>\n<p>运行上面的代码，可以得到如下所示的运行结果。可以看出，当我们的程序只有一个工作线程时，每个下载任务都需要等待上一个下载任务执行结束才能开始，所以程序执行的总耗时是三个下载任务各自执行时间的总和。</p>\n<pre><code>开始下载Python从入门到住院.pdf.\nPython从入门到住院.pdf下载完成.\n下载耗时: 3.005秒.\n开始下载MySQL从删库到跑路.avi.\nMySQL从删库到跑路.avi下载完成.\n下载耗时: 5.006秒.\n开始下载Linux从精通到放弃.mp4.\nLinux从精通到放弃.mp3下载完成.\n下载耗时: 6.007秒.\n总耗时: 14.018秒.\n</code></pre>\n<p>事实上，上面的三个下载任务之间并没有逻辑上的因果关系，三者是可以 “并发” 的，下一个下载任务没有必要等待上一个下载任务结束，为此，我们可以使用多线程编程来改写上面的代码。</p>\n<pre><code class=\"language-Python\">import random\nimport time\nfrom threading import Thread\n\n\ndef download(*, filename):\n    start = time.time()\n    print(f'开始下载 &#123;filename&#125;.')\n    time.sleep(random.randint(3, 6))\n    print(f'&#123;filename&#125; 下载完成.')\n    end = time.time()\n    print(f'下载耗时: &#123;end - start:.3f&#125;秒.')\n\n\ndef main():\n    threads = [\n        Thread(target=download, kwargs=&#123;'filename': 'Python从入门到住院.pdf'&#125;),\n        Thread(target=download, kwargs=&#123;'filename': 'MySQL从删库到跑路.avi'&#125;),\n        Thread(target=download, kwargs=&#123;'filename': 'Linux从精通到放弃.mp4'&#125;)\n    ]\n    start = time.time()\n    # 启动三个线程\n    for thread in threads:\n        thread.start()\n    # 等待线程结束\n    for thread in threads:\n        thread.join()\n    end = time.time()\n    print(f'总耗时: &#123;end - start:.3f&#125;秒.')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>某次的运行结果如下所示。</p>\n<pre><code>开始下载 Python从入门到住院.pdf.\n开始下载 MySQL从删库到跑路.avi.\n开始下载 Linux从精通到放弃.mp4.\nMySQL从删库到跑路.avi 下载完成.\n下载耗时: 3.005秒.\nPython从入门到住院.pdf 下载完成.\n下载耗时: 5.006秒.\nLinux从精通到放弃.mp4 下载完成.\n下载耗时: 6.003秒.\n总耗时: 6.004秒.\n</code></pre>\n<p>通过上面的运行结果可以发现，整个程序的执行时间几乎等于耗时最长的一个下载任务的执行时间，这也就意味着，三个下载任务是并发执行的，不存在一个等待另一个的情况，这样做很显然提高了程序的执行效率。简单的说，如果程序中有非常耗时的执行单元，而这些耗时的执行单元之间又没有逻辑上的因果关系，即 B 单元的执行不依赖于 A 单元的执行结果，那么 A 和 B 两个单元就可以放到两个不同的线程中，让他们并发的执行。这样做的好处除了减少程序执行的等待时间，还可以带来更好的用户体验，因为一个单元的阻塞不会造成程序的 “假死”，因为程序中还有其他的单元是可以运转的。</p>\n<h4 id=\"使用-thread-类创建线程对象\"><a class=\"anchor\" href=\"#使用-thread-类创建线程对象\">#</a> 使用 Thread 类创建线程对象</h4>\n<p>通过上面的代码可以看出，直接使用 <code>Thread</code>  类的构造器就可以创建线程对象，而线程对象的 <code>start()</code>  方法可以启动一个线程。线程启动后会执行 <code>target</code>  参数指定的函数，当然前提是获得 CPU 的调度；如果 <code>target</code>  指定的线程要执行的目标函数有参数，需要通过 <code>args</code>  参数为其进行指定，对于关键字参数，可以通过 <code>kwargs</code>  参数进行传入。 <code>Thread</code>  类的构造器还有很多其他的参数，我们遇到的时候再为大家进行讲解，目前需要大家掌握的，就是 <code>target</code> 、 <code>args</code>  和 <code>kwargs</code> 。</p>\n<h4 id=\"继承-thread-类自定义线程\"><a class=\"anchor\" href=\"#继承-thread-类自定义线程\">#</a> 继承 Thread 类自定义线程</h4>\n<p>除了上面的代码展示的创建线程的方式外，还可以通过继承 <code>Thread</code>  类并重写 <code>run()</code>  方法的方式来自定义线程，具体的代码如下所示。</p>\n<pre><code class=\"language-Python\">import random\nimport time\nfrom threading import Thread\n\n\nclass DownloadThread(Thread):\n\n    def __init__(self, filename):\n        self.filename = filename\n        super().__init__()\n\n    def run(self):\n        start = time.time()\n        print(f'开始下载 &#123;self.filename&#125;.')\n        time.sleep(random.randint(3, 6))\n        print(f'&#123;self.filename&#125; 下载完成.')\n        end = time.time()\n        print(f'下载耗时: &#123;end - start:.3f&#125;秒.')\n\n\ndef main():\n    threads = [\n        DownloadThread('Python从入门到住院.pdf'),\n        DownloadThread('MySQL从删库到跑路.avi'),\n        DownloadThread('Linux从精通到放弃.mp4')\n    ]\n    start = time.time()\n    # 启动三个线程\n    for thread in threads:\n        thread.start()\n    # 等待线程结束\n    for thread in threads:\n        thread.join()\n    end = time.time()\n    print(f'总耗时: &#123;end - start:.3f&#125;秒.')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<h4 id=\"使用线程池\"><a class=\"anchor\" href=\"#使用线程池\">#</a> 使用线程池</h4>\n<p>我们还可以通过线程池的方式将任务放到多个线程中去执行，通过线程池来使用线程应该是多线程编程最理想的选择。事实上，线程的创建和释放都会带来较大的开销，频繁的创建和释放线程通常都不是很好的选择。利用线程池，可以提前准备好若干个线程，在使用的过程中不需要再通过自定义的代码创建和释放线程，而是直接复用线程池中的线程。Python 内置的 <code>concurrent.futures</code>  模块提供了对线程池的支持，代码如下所示。</p>\n<pre><code class=\"language-Python\">import random\nimport time\nfrom concurrent.futures import ThreadPoolExecutor\nfrom threading import Thread\n\n\ndef download(*, filename):\n    start = time.time()\n    print(f'开始下载 &#123;filename&#125;.')\n    time.sleep(random.randint(3, 6))\n    print(f'&#123;filename&#125; 下载完成.')\n    end = time.time()\n    print(f'下载耗时: &#123;end - start:.3f&#125;秒.')\n\n\ndef main():\n    with ThreadPoolExecutor(max_workers=4) as pool:\n        filenames = ['Python从入门到住院.pdf', 'MySQL从删库到跑路.avi', 'Linux从精通到放弃.mp4']\n        start = time.time()\n        for filename in filenames:\n            pool.submit(download, filename=filename)\n    end = time.time()\n    print(f'总耗时: &#123;end - start:.3f&#125;秒.')\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<h3 id=\"守护线程\"><a class=\"anchor\" href=\"#守护线程\">#</a> 守护线程</h3>\n<p>所谓 “守护线程” 就是在主线程结束的时候，不值得再保留的执行线程。这里的不值得保留指的是守护线程会在其他非守护线程全部运行结束之后被销毁，它守护的是当前进程内所有的非守护线程。简单的说，守护线程会跟随主线程一起挂掉，而主线程的生命周期就是一个进程的生命周期。如果不理解，我们可以看一段简单的代码。</p>\n<pre><code class=\"language-Python\">import time\nfrom threading import Thread\n\n\ndef display(content):\n    while True:\n        print(content, end='', flush=True)\n        time.sleep(0.1)\n\n\ndef main():\n    Thread(target=display, args=('Ping', )).start()\n    Thread(target=display, args=('Pong', )).start()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码中，我们将 <code>print</code>  函数的参数 <code>flush</code>  设置为 <code>True</code> ，这是因为 <code>flush</code>  参数的值如果为 <code>False</code> ，而 <code>print</code>  又没有做换行处理，就会导致每次 <code>print</code>  输出的内容被放到操作系统的输出缓冲区，直到缓冲区被输出的内容塞满，才会清空缓冲区产生一次输出。上述现象是操作系统为了减少 I/O 中断，提升 CPU 利用率做出的设定，为了让代码产生直观交互，我们才将 <code>flush</code>  参数设置为 <code>True</code> ，强制每次输出都清空输出缓冲区。</p>\n</blockquote>\n<p>上面的代码运行起来之后是不会停止的，因为两个子线程中都有死循环，除非你手动中断代码的执行。但是，如果在创建线程对象时，将名为 <code>daemon</code>  的参数设置为 <code>True</code> ，这两个线程就会变成守护线程，那么在其他线程结束时，即便有死循环，两个守护线程也会挂掉，不会再继续执行下去，代码如下所示。</p>\n<pre><code class=\"language-Python\">import time\nfrom threading import Thread\n\n\ndef display(content):\n    while True:\n        print(content, end='', flush=True)\n        time.sleep(0.1)\n\n\ndef main():\n    Thread(target=display, args=('Ping', ), daemon=True).start()\n    Thread(target=display, args=('Pong', ), daemon=True).start()\n    time.sleep(5)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面的代码，我们在主线程中添加了一行 <code>time.sleep(5)</code>  让主线程休眠 5 秒，在这个过程中，输出 <code>Ping</code>  和 <code>Pong</code>  的守护线程会持续运转，直到主线程在 5 秒后结束，这两个守护线程也被销毁，不再继续运行。</p>\n<blockquote>\n<p><strong>思考</strong>：如果将上面代码第 12 行的 <code>daemon=True</code>  去掉，代码会怎样执行？有兴趣的读者可以尝试一下，并看看实际执行的结果跟你想象的是否一致。</p>\n</blockquote>\n<h3 id=\"资源竞争\"><a class=\"anchor\" href=\"#资源竞争\">#</a> 资源竞争</h3>\n<p>在编写多线程代码时，不可避免的会遇到多个线程竞争同一个资源（对象）的情况。在这种情况下，如果没有合理的机制来保护被竞争的资源，那么就有可能出现非预期的状况。下面的代码创建了 <code>100</code>  个线程向同一个银行账户（初始余额为 <code>0</code>  元）转账，每个线程转账金额为 <code>1</code>  元。在正常的情况下，我们的银行账户最终的余额应该是 <code>100</code>  元，但是运行下面的代码我们并不能得到 <code>100</code>  元这个结果。</p>\n<pre><code class=\"language-Python\">import time\n\nfrom concurrent.futures import ThreadPoolExecutor\n\n\nclass Account(object):\n    &quot;&quot;&quot;银行账户&quot;&quot;&quot;\n\n    def __init__(self):\n        self.balance = 0.0\n\n    def deposit(self, money):\n        &quot;&quot;&quot;存钱&quot;&quot;&quot;\n        new_balance = self.balance + money\n        time.sleep(0.01)\n        self.balance = new_balance\n\n\ndef main():\n    &quot;&quot;&quot;主函数&quot;&quot;&quot;\n    account = Account()\n    with ThreadPoolExecutor(max_workers=16) as pool:\n        for _ in range(100):\n            pool.submit(account.deposit, 1)\n    print(account.balance)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面代码中的 <code>Account</code>  类代表了银行账户，它的 <code>deposit</code>  方法代表存款行为，参数 <code>money</code>  代表存入的金额，该方法通过 <code>time.sleep</code>  函数模拟受理存款需要一段时间。我们通过线程池的方式启动了 <code>100</code>  个线程向一个账户转账，但是上面的代码并不能运行出 <code>100</code>  这个我们期望的结果，这就是在多个线程竞争一个资源的时候，可能会遇到的数据不一致的问题。注意上面代码的第 <code>14</code>  行，当多个线程都执行到这行代码时，它们会在相同的余额上执行加上存入金额的操作，这就会造成 “丢失更新” 现象，即之前修改数据的成果被后续的修改给覆盖掉了，所以才得不到正确的结果。</p>\n<p>要解决上面的问题，可以使用锁机制，通过锁对操作数据的关键代码加以保护。Python 标准库的 <code>threading</code>  模块提供了 <code>Lock</code>  和 <code>RLock</code>  类来支持锁机制，这里我们不去深究二者的区别，建议大家直接使用 <code>RLock</code> 。接下来，我们给银行账户添加一个锁对象，通过锁对象来解决刚才存款时发生 “丢失更新” 的问题，代码如下所示。</p>\n<pre><code class=\"language-Python\">import time\n\nfrom concurrent.futures import ThreadPoolExecutor\nfrom threading import RLock\n\n\nclass Account(object):\n    &quot;&quot;&quot;银行账户&quot;&quot;&quot;\n\n    def __init__(self):\n        self.balance = 0.0\n        self.lock = RLock()\n\n    def deposit(self, money):\n        # 获得锁\n        self.lock.acquire()\n        try:\n            new_balance = self.balance + money\n            time.sleep(0.01)\n            self.balance = new_balance\n        finally:\n            # 释放锁\n            self.lock.release()\n\n\ndef main():\n    &quot;&quot;&quot;主函数&quot;&quot;&quot;\n    account = Account()\n    with ThreadPoolExecutor(max_workers=16) as pool:\n        for _ in range(100):\n            pool.submit(account.deposit, 1)\n    print(account.balance)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>上面代码中，获得锁和释放锁的操作也可以通过上下文语法来实现，使用上下文语法会让代码更加简单优雅，这也是我们推荐大家使用的方式。</p>\n<pre><code class=\"language-Python\">import time\n\nfrom concurrent.futures import ThreadPoolExecutor\nfrom threading import RLock\n\n\nclass Account(object):\n    &quot;&quot;&quot;银行账户&quot;&quot;&quot;\n\n    def __init__(self):\n        self.balance = 0.0\n        self.lock = RLock()\n\n    def deposit(self, money):\n        # 通过上下文语法获得锁和释放锁\n        with self.lock:\n            new_balance = self.balance + money\n            time.sleep(0.01)\n            self.balance = new_balance\n\n\ndef main():\n    &quot;&quot;&quot;主函数&quot;&quot;&quot;\n    account = Account()\n    with ThreadPoolExecutor(max_workers=16) as pool:\n        for _ in range(100):\n            pool.submit(account.deposit, 1)\n    print(account.balance)\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<blockquote>\n<p><strong>思考</strong>：将上面的代码修改为 5 个线程向银行账户存钱，5 个线程从银行账户取钱，取钱的线程在银行账户余额不足时，需要停下来等待存钱的线程将钱存入后再尝试取钱。这里需要用到线程调度的知识，大家可以自行研究下 <code>threading</code>  模块中的 <code>Condition</code>  类，看看是否能够完成这个任务。</p>\n</blockquote>\n<h3 id=\"gil问题\"><a class=\"anchor\" href=\"#gil问题\">#</a> GIL 问题</h3>\n<p>如果使用官方的 Python 解释器（通常称之为 CPython）运行 Python 程序，我们并不能通过使用多线程的方式将 CPU 的利用率提升到逼近 400%（对于 4 核 CPU）或逼近 800%（对于 8 核 CPU）这样的水平，因为 CPython 在执行代码时，会受到 GIL（全局解释器锁）的限制。具体的说，CPython 在执行任何代码时，都需要对应的线程先获得 GIL，然后每执行 100 条（字节码）指令，CPython 就会让获得 GIL 的线程主动释放 GIL，这样别的线程才有机会执行。因为 GIL 的存在，无论你的 CPU 有多少个核，我们编写的 Python 代码也没有机会真正并行的执行。</p>\n<p>GIL 是官方 Python 解释器在设计上的历史遗留问题，要解决这个问题，让多线程能够发挥 CPU 的多核优势，需要重新实现一个不带 GIL 的 Python 解释器。这个问题按照官方的说法，在 Python 发布 4.0 版本时会得到解决，就让我们拭目以待吧。当下，对于 CPython 而言，如果希望充分发挥 CPU 的多核优势，可以考虑使用多进程，因为每个进程都对应一个 Python 解释器，因此每个进程都有自己独立的 GIL，这样就可以突破 GIL 的限制。在下一个章节中，我们会为大家介绍关于多进程的相关知识，并对多线程和多进程的代码及其执行效果进行比较。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/63.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9C%A8%E7%88%AC%E8%99%AB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/",
            "url": "https://scottalive.github.io/computer-science/python/basic/63.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9C%A8%E7%88%AC%E8%99%AB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/",
            "title": "并发编程在爬虫中的应用",
            "date_published": "2025-04-16T19:07:49.000Z",
            "content_html": "<h2 id=\"并发编程在爬虫中的应用\"><a class=\"anchor\" href=\"#并发编程在爬虫中的应用\">#</a> 并发编程在爬虫中的应用</h2>\n<p>之前的课程，我们已经为大家介绍了 Python 中的多线程、多进程和异步编程，通过这三种手段，我们可以实现并发或并行编程，这一方面可以加速代码的执行，另一方面也可以带来更好的用户体验。爬虫程序是典型的 I/O 密集型任务，对于 I/O 密集型任务来说，多线程和异步 I/O 都是很好的选择，因为当程序的某个部分因 I/O 操作阻塞时，程序的其他部分仍然可以运转，这样我们不用在等待和阻塞中浪费大量的时间。下面我们以爬取 “<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pbWFnZS5zby5jb20v\">360 图片</span>” 网站的图片并保存到本地为例，为大家分别展示使用单线程、多线程和异步 I/O 编程的爬虫程序有什么区别，同时也对它们的执行效率进行简单的对比。</p>\n<p>“360 图片” 网站的页面使用了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvR3VpZGUvQUpBWA==\">Ajax</span> 技术，这是很多网站都会使用的一种异步加载数据和局部刷新页面的技术。简单的说，页面上的图片都是通过 JavaScript 代码异步获取 JSON 数据并动态渲染生成的，而且整个页面还使用了瀑布式加载（一边向下滚动，一边加载更多的图片）。我们在浏览器的 “开发者工具” 中可以找到提供动态内容的数据接口，如下图所示，我们需要的图片信息就在服务器返回的 JSON 数据中。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vamFja2ZydWVkL215cGljL3Jhdy9tYXN0ZXIvMjAyMTEyMDUyMjEzNTIucG5n\">https://gitee.com/jackfrued/mypic/raw/master/20211205221352.png</span>&quot; style=&quot;zoom:50%;&quot;&gt;</p>\n<p>例如，要获取 “美女” 频道的图片，我们可以请求如下所示的 URL，其中参数 <code>ch</code>  表示请求的频道， <code>=</code>  后面的参数值 <code>beauty</code>  就代表了 “美女” 频道，参数 <code>sn</code>  相当于是页码， <code>0</code>  表示第一页（共 <code>30</code>  张图片）， <code>30</code>  表示第二页， <code>60</code>  表示第三页，以此类推。</p>\n<pre><code>https://image.so.com/zjl?ch=beauty&amp;sn=0\n</code></pre>\n<h3 id=\"单线程版本\"><a class=\"anchor\" href=\"#单线程版本\">#</a> 单线程版本</h3>\n<p>通过上面的 URL 下载 “美女” 频道共 <code>90</code>  张图片。</p>\n<pre><code class=\"language-Python\">&quot;&quot;&quot;\nexample04.py - 单线程版本爬虫\n&quot;&quot;&quot;\nimport os\n\nimport requests\n\n\ndef download_picture(url):\n    filename = url[url.rfind('/') + 1:]\n    resp = requests.get(url)\n    if resp.status_code == 200:\n        with open(f'images/beauty/&#123;filename&#125;', 'wb') as file:\n            file.write(resp.content)\n\n\ndef main():\n    if not os.path.exists('images/beauty'):\n        os.makedirs('images/beauty')\n    for page in range(3):\n        resp = requests.get(f'https://image.so.com/zjl?ch=beauty&amp;sn=&#123;page * 30&#125;')\n        if resp.status_code == 200:\n            pic_dict_list = resp.json()['list']\n            for pic_dict in pic_dict_list:\n                download_picture(pic_dict['qhimg_url'])\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>在 macOS 或 Linux 系统上，我们可以使用 <code>time</code>  命令来了解上面代码的执行时间以及 CPU 的利用率，如下所示。</p>\n<pre><code class=\"language-Bash\">time python3 example04.py \n</code></pre>\n<p>下面是单线程爬虫代码在我的电脑上执行的结果。</p>\n<pre><code>python3 example04.py  2.36s user 0.39s system 12% cpu 21.578 total\n</code></pre>\n<p>这里我们只需要关注代码的总耗时为 <code>21.578</code>  秒，CPU 利用率为 <code>12%</code> 。</p>\n<h3 id=\"多线程版本\"><a class=\"anchor\" href=\"#多线程版本\">#</a> 多线程版本</h3>\n<p>我们使用之前讲到过的线程池技术，将上面的代码修改为多线程版本。</p>\n<pre><code class=\"language-Python\">&quot;&quot;&quot;\nexample05.py - 多线程版本爬虫\n&quot;&quot;&quot;\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\n\nimport requests\n\n\ndef download_picture(url):\n    filename = url[url.rfind('/') + 1:]\n    resp = requests.get(url)\n    if resp.status_code == 200:\n        with open(f'images/beauty/&#123;filename&#125;', 'wb') as file:\n            file.write(resp.content)\n\n\ndef main():\n    if not os.path.exists('images/beauty'):\n        os.makedirs('images/beauty')\n    with ThreadPoolExecutor(max_workers=16) as pool:\n        for page in range(3):\n            resp = requests.get(f'https://image.so.com/zjl?ch=beauty&amp;sn=&#123;page * 30&#125;')\n            if resp.status_code == 200:\n                pic_dict_list = resp.json()['list']\n                for pic_dict in pic_dict_list:\n                    pool.submit(download_picture, pic_dict['qhimg_url'])\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>执行如下所示的命令。</p>\n<pre><code class=\"language-Bash\">time python3 example05.py\n</code></pre>\n<p>代码的执行结果如下所示：</p>\n<pre><code>python3 example05.py  2.65s user 0.40s system 95% cpu 3.193 total\n</code></pre>\n<h3 id=\"异步io版本\"><a class=\"anchor\" href=\"#异步io版本\">#</a> 异步 I/O 版本</h3>\n<p>我们使用 <code>aiohttp</code>  将上面的代码修改为异步 I/O 的版本。为了以异步 I/O 的方式实现网络资源的获取和写文件操作，我们首先得安装三方库 <code>aiohttp</code>  和 <code>aiofile</code> ，命令如下所示。</p>\n<pre><code class=\"language-Bash\">pip install aiohttp aiofile\n</code></pre>\n<p><code>aiohttp</code>  的用法在之前的课程中已经做过简要介绍， <code>aiofile</code>  模块中的 <code>async_open</code>  函数跟 Python 内置函数 <code>open</code>  的用法大致相同，只不过它支持异步操作。下面是异步 I/O 版本的爬虫代码。</p>\n<pre><code class=\"language-Python\">&quot;&quot;&quot;\nexample06.py - 异步I/O版本爬虫\n&quot;&quot;&quot;\nimport asyncio\nimport json\nimport os\n\nimport aiofile\nimport aiohttp\n\n\nasync def download_picture(session, url):\n    filename = url[url.rfind('/') + 1:]\n    async with session.get(url, ssl=False) as resp:\n        if resp.status == 200:\n            data = await resp.read()\n            async with aiofile.async_open(f'images/beauty/&#123;filename&#125;', 'wb') as file:\n                await file.write(data)\n\n\nasync def fetch_json():\n    async with aiohttp.ClientSession() as session:\n        for page in range(3):\n            async with session.get(\n                url=f'https://image.so.com/zjl?ch=beauty&amp;sn=&#123;page * 30&#125;',\n                ssl=False\n            ) as resp:\n                if resp.status == 200:\n                    json_str = await resp.text()\n                    result = json.loads(json_str)\n                    for pic_dict in result['list']:\n                        await download_picture(session, pic_dict['qhimg_url'])\n\n\ndef main():\n    if not os.path.exists('images/beauty'):\n        os.makedirs('images/beauty')\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(fetch_json())\n    loop.close()\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>执行如下所示的命令。</p>\n<pre><code class=\"language-Bash\">time python3 example06.py\n</code></pre>\n<p>代码的执行结果如下所示：</p>\n<pre><code>python3 example06.py  0.82s user 0.21s system 27% cpu 3.782 total\n</code></pre>\n<h3 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h3>\n<p>通过上面三段代码执行结果的比较，我们可以得出一个结论，使用多线程和异步 I/O 都可以改善爬虫程序的性能，因为我们不用将时间浪费在因 I/O 操作造成的等待和阻塞上，而 <code>time</code>  命令的执行结果也告诉我们，单线程的代码 CPU 利用率仅仅只有 <code>12%</code> ，而多线程版本的 CPU 利用率则高达 <code>95%</code> ；单线程版本的爬虫执行时间约 <code>21</code>  秒，而多线程和异步 I/O 的版本仅执行了 <code>3</code>  秒钟。另外，在运行时间差别不大的情况下，多线程的代码比异步 I/O 的代码耗费了更多的 CPU 资源，这是因为多线程的调度和切换也需要花费 CPU 时间。至此，三种方式在 I/O 密集型任务上的优劣已经一目了然，当然这只是在我的电脑上跑出来的结果。如果网络状况不是很理想或者目标网站响应很慢，那么使用多线程和异步 I/O 的优势将更为明显，有兴趣的读者可以自行试验。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/62.%E7%94%A8Python%E8%A7%A3%E6%9E%90HTML%E9%A1%B5%E9%9D%A2-2/",
            "url": "https://scottalive.github.io/computer-science/python/basic/62.%E7%94%A8Python%E8%A7%A3%E6%9E%90HTML%E9%A1%B5%E9%9D%A2-2/",
            "title": "用Python解析HTML页面",
            "date_published": "2025-04-15T19:07:49.000Z",
            "content_html": "<h2 id=\"用python解析html页面\"><a class=\"anchor\" href=\"#用python解析html页面\">#</a> 用 Python 解析 HTML 页面</h2>\n<p>在前面的课程中，我们讲到了使用 <code>request</code>  三方库获取网络资源，还介绍了一些前端的基础知识。接下来，我们继续探索如何解析 HTML 代码，从页面中提取出有用的信息。之前，我们尝试过用正则表达式的捕获组操作提取页面内容，但是写出一个正确的正则表达式也是一件让人头疼的事情。为了解决这个问题，我们得先深入的了解一下 HTML 页面的结构，并在此基础上研究另外的解析页面的方法。</p>\n<h3 id=\"html-页面的结构\"><a class=\"anchor\" href=\"#html-页面的结构\">#</a> HTML 页面的结构</h3>\n<p>我们在浏览器中打开任意一个网站，然后通过鼠标右键菜单，选择 “显示网页源代码” 菜单项，就可以看到网页对应的 HTML 代码。</p>\n<p><img data-src=\"https://gitee.com/jackfrued/mypic/raw/master/20210822094218.png\" alt=\"image-20210822094218269\" /></p>\n<p>代码的第 <code>1</code>  行是文档类型声明，第 <code>2</code>  行的 <code>&lt;html&gt;</code>  标签是整个页面根标签的开始标签，最后一行是根标签的结束标签 <code>&lt;/html&gt;</code> 。 <code>&lt;html&gt;</code>  标签下面有两个子标签 <code>&lt;head&gt;</code>  和 <code>&lt;body&gt;</code> ，放在 <code>&lt;body&gt;</code>  标签下的内容会显示在浏览器窗口中，这部分内容是网页的主体；放在 <code>&lt;head&gt;</code>  标签下的内容不会显示在浏览器窗口中，但是却包含了页面重要的元信息，通常称之为网页的头部。HTML 页面大致的代码结构如下所示。</p>\n<pre><code class=\"language-HTML\">&lt;!doctype html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;!-- 页面的元信息，如字符编码、标题、关键字、媒体查询等 --&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;!-- 页面的主体，显示在浏览器窗口中的内容 --&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>标签、层叠样式表（CSS）、JavaScript 是构成 HTML 页面的三要素，其中标签用来承载页面要显示的内容，CSS 负责对页面的渲染，而 JavaScript 用来控制页面的交互式行为。要实现 HTML 页面的解析，可以使用 XPath 的语法，它原本是 XML 的一种查询语法，可以根据 HTML 标签的层次结构提取标签中的内容或标签属性；此外，也可以使用 CSS 选择器来定位页面元素，就跟用 CSS 渲染页面元素是同样的道理。</p>\n<h3 id=\"xpath-解析\"><a class=\"anchor\" href=\"#xpath-解析\">#</a> XPath 解析</h3>\n<p>XPath 是在 XML（eXtensible Markup Language）文档中查找信息的一种语法，XML 跟 HTML 类似也是一种用标签承载数据的标签语言，不同之处在于 XML 的标签是可扩展的，可以自定义的，而且 XML 对语法有更严格的要求。XPath 使用路径表达式来选取 XML 文档中的节点或者节点集，这里所说的节点包括元素、属性、文本、命名空间、处理指令、注释、根节点等。下面我们通过一个例子来说明如何使用 XPath 对页面进行解析。</p>\n<pre><code class=\"language-XML\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;bookstore&gt;\n    &lt;book&gt;\n      &lt;title lang=&quot;eng&quot;&gt;Harry Potter&lt;/title&gt;\n      &lt;price&gt;29.99&lt;/price&gt;\n    &lt;/book&gt;\n    &lt;book&gt;\n      &lt;title lang=&quot;zh&quot;&gt;Learning XML&lt;/title&gt;\n      &lt;price&gt;39.95&lt;/price&gt;\n    &lt;/book&gt;\n&lt;/bookstore&gt;\n</code></pre>\n<p>对于上面的 XML 文件，我们可以用如下所示的 XPath 语法获取文档中的节点。</p>\n<table>\n<thead>\n<tr>\n<th>路径表达式</th>\n<th>结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>/bookstore</code></td>\n<td>选取根元素 bookstore。<strong>注意</strong>：假如路径起始于正斜杠 (/)，则此路径始终代表到某元素的绝对路径！</td>\n</tr>\n<tr>\n<td><code>//book</code></td>\n<td>选取所有 book 子元素，而不管它们在文档中的位置。</td>\n</tr>\n<tr>\n<td><code>//@lang</code></td>\n<td>选取名为 lang 的所有属性。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[1]</code></td>\n<td>选取属于 bookstore 子元素的第一个 book 元素。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[last()]</code></td>\n<td>选取属于 bookstore 子元素的最后一个 book 元素。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[last()-1]</code></td>\n<td>选取属于 bookstore 子元素的倒数第二个 book 元素。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[position()&lt;3]</code></td>\n<td>选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td>\n</tr>\n<tr>\n<td><code>//title[@lang]</code></td>\n<td>选取所有拥有名为 lang 的属性的 title 元素。</td>\n</tr>\n<tr>\n<td><code>//title[@lang='eng']</code></td>\n<td>选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[price&gt;35.00]</code></td>\n<td>选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book[price&gt;35.00]/title</code></td>\n<td>选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n</tbody>\n</table>\n<p>XPath 还支持通配符用法，如下所示。</p>\n<table>\n<thead>\n<tr>\n<th>路径表达式</th>\n<th>结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>/bookstore/*</code></td>\n<td>选取 bookstore 元素的所有子元素。</td>\n</tr>\n<tr>\n<td><code>//*</code></td>\n<td>选取文档中的所有元素。</td>\n</tr>\n<tr>\n<td><code>//title[@*]</code></td>\n<td>选取所有带有属性的 title 元素。</td>\n</tr>\n</tbody>\n</table>\n<p>如果要选取多个节点，可以使用如下所示的方法。</p>\n<table>\n<thead>\n<tr>\n<th>路径表达式</th>\n<th>结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>//book/title \\| //book/price</code></td>\n<td>选取 book 元素的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td><code>//title \\| //price</code></td>\n<td>选取文档中的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td><code>/bookstore/book/title \\| //price</code></td>\n<td>选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>说明</strong>：上面的例子来自于 “菜鸟教程” 网站上的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS94cGF0aC94cGF0aC10dXRvcmlhbC5odG1s\">XPath 教程</span>，有兴趣的读者可以自行阅读原文。</p>\n</blockquote>\n<p>当然，如果不理解或不熟悉 XPath 语法，可以在浏览器的开发者工具中按照如下所示的方法查看元素的 XPath 语法，下图是在 Chrome 浏览器的开发者工具中查看豆瓣网电影详情信息中影片标题的 XPath 语法。</p>\n<p><img data-src=\"https://gitee.com/jackfrued/mypic/raw/master/20210822093707.png\" alt=\"\" /></p>\n<p>实现 XPath 解析需要三方库 <code>lxml</code>  的支持，可以使用下面的命令安装 <code>lxml</code> 。</p>\n<pre><code class=\"language-Bash\">pip install lxml\n</code></pre>\n<p>下面我们用 XPath 解析方式改写之前获取豆瓣电影 Top250 的代码，如下所示。</p>\n<pre><code class=\"language-Python\">from lxml import etree\nimport requests\n\nfor page in range(1, 11):\n    resp = requests.get(\n        url=f'https://movie.douban.com/top250?start=&#123;(page - 1) * 25&#125;',\n        headers=&#123;'User-Agent': 'BaiduSpider'&#125;\n    )\n    tree = etree.HTML(resp.text)\n    # 通过XPath语法从页面中提取电影标题\n    title_spans = tree.xpath('//*[@id=&quot;content&quot;]/div/div[1]/ol/li/div/div[2]/div[1]/a/span[1]')\n    # 通过XPath语法从页面中提取电影评分\n    rank_spans = tree.xpath('//*[@id=&quot;content&quot;]/div/div[1]/ol/li[1]/div/div[2]/div[2]/div/span[2]')\n    for title_span, rank_span in zip(title_spans, rank_spans):\n        print(title_span.text, rank_span.text)\n</code></pre>\n<h3 id=\"css-选择器解析\"><a class=\"anchor\" href=\"#css-选择器解析\">#</a> CSS 选择器解析</h3>\n<p>对于熟悉 CSS 选择器和 JavaScript 的开发者来说，通过 CSS 选择器获取页面元素可能是更为简单的选择，因为浏览器中运行的 JavaScript 本身就可以 <code>document</code>  对象的 <code>querySelector()</code>  和 <code>querySelectorAll()</code>  方法基于 CSS 选择器获取页面元素。在 Python 中，我们可以利用三方库 <code>beautifulsoup4</code>  或 <code>pyquery</code>  来做同样的事情。Beautiful Soup 可以用来解析 HTML 和 XML 文档，修复含有未闭合标签等错误的文档，通过为待解析的页面在内存中创建一棵树结构，实现对从页面中提取数据操作的封装。可以用下面的命令来安装 Beautiful Soup。</p>\n<pre><code class=\"language-Python\">pip install beautifulsoup4\n</code></pre>\n<p>下面是使用 <code>bs4</code>  改写的获取豆瓣电影 Top250 电影名称的代码。</p>\n<pre><code class=\"language-Python\">import bs4\nimport requests\n\nfor page in range(1, 11):\n    resp = requests.get(\n        url=f'https://movie.douban.com/top250?start=&#123;(page - 1) * 25&#125;',\n        headers=&#123;'User-Agent': 'BaiduSpider'&#125;\n    )\n    # 创建BeautifulSoup对象\n    soup = bs4.BeautifulSoup(resp.text, 'lxml')\n    # 通过CSS选择器从页面中提取包含电影标题的span标签\n    title_spans = soup.select('div.info &gt; div.hd &gt; a &gt; span:nth-child(1)')\n    # 通过CSS选择器从页面中提取包含电影评分的span标签\n    rank_spans = soup.select('div.info &gt; div.bd &gt; div &gt; span.rating_num')\n    for title_span, rank_span in zip(title_spans, rank_spans):\n        print(title_span.text, rank_span.text)\n</code></pre>\n<p>关于 BeautifulSoup 更多的知识，可以参考它的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3J1bW15LmNvbS9zb2Z0d2FyZS9CZWF1dGlmdWxTb3VwL2JzNC9kb2Muemgv\">官方文档</span>。</p>\n<h3 id=\"简单的总结\"><a class=\"anchor\" href=\"#简单的总结\">#</a> 简单的总结</h3>\n<p>下面我们对三种解析方式做一个简单比较。</p>\n<table>\n<thead>\n<tr>\n<th>解析方式</th>\n<th>对应的模块</th>\n<th>速度</th>\n<th>使用难度</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>正则表达式解析</td>\n<td><code>re</code></td>\n<td>快</td>\n<td>困难</td>\n</tr>\n<tr>\n<td>XPath 解析</td>\n<td><code>lxml</code></td>\n<td>快</td>\n<td>一般</td>\n</tr>\n<tr>\n<td>CSS 选择器解析</td>\n<td><code>bs4</code>  或 <code>pyquery</code></td>\n<td>不确定</td>\n<td>简单</td>\n</tr>\n</tbody>\n</table>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        },
        {
            "id": "https://scottalive.github.io/computer-science/python/basic/62.%E7%94%A8Python%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90-1/",
            "url": "https://scottalive.github.io/computer-science/python/basic/62.%E7%94%A8Python%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90-1/",
            "title": "用Python获取网络数据",
            "date_published": "2025-04-14T19:07:49.000Z",
            "content_html": "<h2 id=\"用python获取网络数据\"><a class=\"anchor\" href=\"#用python获取网络数据\">#</a> 用 Python 获取网络数据</h2>\n<p>网络数据采集是 Python 语言非常擅长的领域，上节课我们讲到，实现网络数据采集的程序通常称之为网络爬虫或蜘蛛程序。即便是在大数据时代，数据对于中小企业来说仍然是硬伤和短板，有些数据需要通过开放或付费的数据接口来获得，其他的行业数据和竞对数据则必须要通过网络数据采集的方式来获得。不管使用哪种方式获取网络数据资源，Python 语言都是非常好的选择，因为 Python 的标准库和三方库都对网络数据采集提供了良好的支持。</p>\n<h3 id=\"requests库\"><a class=\"anchor\" href=\"#requests库\">#</a> requests 库</h3>\n<p>要使用 Python 获取网络数据，我们推荐大家使用名为 <code>requests</code>  的三方库，这个库我们在之前的课程中其实已经使用过了。按照官方网站的解释， <code>requests</code>  是基于 Python 标准库进行了封装，简化了通过 HTTP 或 HTTPS 访问网络资源的操作。上课我们提到过，HTTP 是一个请求响应式的协议，当我们在浏览器中输入正确的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9MZWFybi9Db21tb25fcXVlc3Rpb25zL1doYXRfaXNfYV9VUkw=\">URL</span>（通常也称为网址）并按下 Enter 键时，我们就向网络上的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9MZWFybi9Db21tb25fcXVlc3Rpb25zL1doYXRfaXNfYV93ZWJfc2VydmVy\">Web 服务器</span>发送了一个 HTTP 请求，服务器在收到请求后会给我们一个 HTTP 响应。在 Chrome 浏览器中的菜单中打开 “开发者工具” 切换到 “Network” 选项卡就能够查看 HTTP 请求和响应到底是什么样子的，如下图所示。</p>\n<p><img data-src=\"https://gitee.com/jackfrued/mypic/raw/master/20210822093434.png\" alt=\"\" /></p>\n<p>通过 <code>requests</code>  库，我们可以让 Python 程序向浏览器一样向 Web 服务器发起请求，并接收服务器返回的响应，从响应中我们就可以提取出想要的数据。浏览器呈现给我们的网页是用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRNTA==\">HTML</span> 编写的，浏览器相当于是 HTML 的解释器环境，我们看到的网页中的内容都包含在 HTML 的标签中。在获取到 HTML 代码后，就可以从标签的属性或标签体中提取内容。下面例子演示了如何获取网页 HTML 代码，我们通过 <code>requests</code>  库的 <code>get</code>  函数，获取了搜狐首页的代码。</p>\n<pre><code class=\"language-Python\">import requests\n\nresp = requests.get('https://www.sohu.com/')\nif resp.status_code == 200:\n    print(resp.text)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面代码中的变量 <code>resp</code>  是一个 <code>Response</code>  对象（ <code>requests</code>  库封装的类型），通过该对象的 <code>status_code</code>  属性可以获取响应状态码，而该对象的 <code>text</code>  属性可以帮我们获取到页面的 HTML 代码。</p>\n</blockquote>\n<p>由于 <code>Response</code>  对象的 <code>text</code>  是一个字符串，所以我们可以利用之前讲过的正则表达式的知识，从页面的 HTML 代码中提取新闻的标题和链接，代码如下所示。</p>\n<pre><code class=\"language-Python\">import re\n\nimport requests\n\npattern = re.compile(r'&lt;a.*?href=&quot;(.*?)&quot;.*?title=&quot;(.*?)&quot;.*?&gt;')\nresp = requests.get('https://www.sohu.com/')\nif resp.status_code == 200:\n    all_matches = pattern.findall(resp.text)\n    for href, title in all_matches:\n        print(href)\n        print(title)\n</code></pre>\n<p>除了文本内容，我们也可以使用 <code>requests</code>  库通过 URL 获取二进制资源。下面的例子演示了如何获取百度 Logo 并保存到名为 <code>baidu.png</code>  的本地文件中。可以在百度的首页上右键点击百度 Logo，并通过 “复制图片地址” 菜单项获取图片的 URL。</p>\n<pre><code class=\"language-Python\">import requests\n\nresp = requests.get('https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png')\nwith open('baidu.png', 'wb') as file:\n    file.write(resp.content)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>： <code>Response</code>  对象的 <code>content</code>  属性可以获得服务器响应的二进制数据。</p>\n</blockquote>\n<p><code>requests</code>  库非常好用而且功能上也比较强大和完整，具体的内容我们在使用的过程中为大家一点点剖析。想解锁关于 <code>requests</code>  库更多的知识，可以阅读它的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnB5dGhvbi1yZXF1ZXN0cy5vcmcvemhfQ04vbGF0ZXN0Lw==\">官方文档</span>。</p>\n<h3 id=\"编写爬虫代码\"><a class=\"anchor\" href=\"#编写爬虫代码\">#</a> 编写爬虫代码</h3>\n<p>接下来，我们以 “豆瓣电影” 为例，为大家讲解如何编写爬虫代码。按照上面提供的方法，我们先使用 <code>requests</code>  获取到网页的 HTML 代码，然后将整个代码看成一个长字符串，这样我们就可以使用正则表达式的捕获组从字符串提取我们需要的内容。下面的代码演示了如何从<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ZpZS5kb3ViYW4uY29tLw==\">豆瓣电影</span>获取排前 250 名的电影的名称。<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ZpZS5kb3ViYW4uY29tL3RvcDI1MA==\">豆瓣电影 Top250</span> 的页面结构和对应代码如下图所示，可以看出，每页共展示了 25 部电影，如果要获取到 Top250 数据，我们共需要访问 10 个页面，对应的地址是<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ZpZS5kb3ViYW4uY29tL3RvcDI1MD9zdGFydD14eHg=\"> https://movie.douban.com/top250?start=xxx</span>，这里的 <code>xxx</code>  如果为 <code>0</code>  就是第一页，如果 <code>xxx</code>  的值是 <code>100</code> ，那么我们可以访问到第五页。为了代码简单易读，我们只获取电影的标题和评分。</p>\n<p><img data-src=\"https://gitee.com/jackfrued/mypic/raw/master/20210822093447.png\" alt=\"\" /></p>\n<pre><code class=\"language-Python\">import random\nimport re\nimport time\n\nimport requests\n\nfor page in range(1, 11):\n    resp = requests.get(\n        url=f'https://movie.douban.com/top250?start=&#123;(page - 1) * 25&#125;',\n        # 如果不设置HTTP请求头中的User-Agent，豆瓣会检测出不是浏览器而阻止我们的请求。\n        # 通过get函数的headers参数设置User-Agent的值，具体的值可以在浏览器的开发者工具查看到。\n        # 用爬虫访问大部分网站时，将爬虫伪装成来自浏览器的请求都是非常重要的一步。\n        headers=&#123;'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36'&#125;\n    )\n    # 通过正则表达式获取class属性为title且标签体不以&amp;开头的span标签并用捕获组提取标签内容\n    pattern1 = re.compile(r'&lt;span class=&quot;title&quot;&gt;([^&amp;]*?)&lt;/span&gt;')\n    titles = pattern1.findall(resp.text)\n    # 通过正则表达式获取class属性为rating_num的span标签并用捕获组提取标签内容\n    pattern2 = re.compile(r'&lt;span class=&quot;rating_num&quot;.*?&gt;(.*?)&lt;/span&gt;')\n    ranks = pattern2.findall(resp.text)\n    # 使用zip压缩两个列表，循环遍历所有的电影标题和评分\n    for title, rank in zip(titles, ranks):\n        print(title, rank)\n    # 随机休眠1-5秒，避免爬取页面过于频繁\n    time.sleep(random.random() * 4 + 1)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：通过分析豆瓣网的 robots 协议，我们发现豆瓣网并不拒绝百度爬虫获取它的数据，因此我们也可以将爬虫伪装成百度的爬虫，将 <code>get</code>  函数的 <code>headers</code>  参数修改为： <code>headers=&#123;'User-Agent': 'BaiduSpider'&#125;</code> 。</p>\n</blockquote>\n<h3 id=\"使用-ip-代理\"><a class=\"anchor\" href=\"#使用-ip-代理\">#</a> 使用 IP 代理</h3>\n<p>让爬虫程序隐匿自己的身份对编写爬虫程序来说是比较重要的，很多网站对爬虫都比较反感的，因为爬虫会耗费掉它们很多的网络带宽并制造很多无效的流量。要隐匿身份通常需要使用<strong>商业 IP 代理</strong>（如蘑菇代理、芝麻代理、快代理等），让被爬取的网站无法获取爬虫程序来源的真实 IP 地址，也就无法简单的通过 IP 地址对爬虫程序进行封禁。</p>\n<p>下面以<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5tb2d1cHJveHkuY29tLw==\">蘑菇代理</span>为例，为大家讲解商业 IP 代理的使用方法。首先需要在该网站注册一个账号，注册账号后就可以<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5tb2d1cHJveHkuY29tL2J1eQ==\">购买</span>相应的套餐来获得商业 IP 代理。作为商业用途，建议大家购买不限量套餐，这样可以根据实际需要获取足够多的代理 IP 地址；作为学习用途，可以购买包时套餐或根据自己的需求来决定。蘑菇代理提供了两种接入代理的方式，分别是 API 私密代理和 HTTP 隧道代理，前者是通过请求蘑菇代理的 API 接口获取代理服务器地址，后者是直接使用统一的入口（蘑菇代理提供的域名）进行接入。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vamFja2ZydWVkL215cGljL3Jhdy9tYXN0ZXIvMjAyMTA4MjkwODA2NDcucG5n\">https://gitee.com/jackfrued/mypic/raw/master/20210829080647.png</span>&quot; width=&quot;75%&quot;&gt;</p>\n<p>下面，我们以 HTTP 隧道代理为例，为大家讲解接入 IP 代理的方式，大家也可以直接参考蘑菇代理官网提供的代码来为爬虫设置代理。</p>\n<pre><code class=\"language-Python\">import requests\n\nAPP_KEY = 'Wnp******************************XFx'\nPROXY_HOST = 'secondtransfer.moguproxy.com:9001'\n\nfor page in range(1, 11):\n    resp = requests.get(\n        url=f'https://movie.douban.com/top250?start=&#123;(page - 1) * 25&#125;',\n        # 需要在HTTP请求头设置代理的身份认证方式\n        headers=&#123;\n            'Proxy-Authorization': f'Basic &#123;APP_KEY&#125;',\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36',\n            'Accept-Language': 'zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4'\n        &#125;,\n        # 设置代理服务器\n        proxies=&#123;\n            'http': f'http://&#123;PROXY_HOST&#125;',\n            'https': f'https://&#123;PROXY_HOST&#125;'\n        &#125;,\n        verify=False\n    )\n    pattern1 = re.compile(r'&lt;span class=&quot;title&quot;&gt;([^&amp;]*?)&lt;/span&gt;')\n    titles = pattern1.findall(resp.text)\n    pattern2 = re.compile(r'&lt;span class=&quot;rating_num&quot;.*?&gt;(.*?)&lt;/span&gt;')\n    ranks = pattern2.findall(resp.text)\n    for title, rank in zip(titles, ranks):\n        print(title, rank)\n</code></pre>\n<blockquote>\n<p><strong>说明</strong>：上面的代码需要修改 <code>APP_KEY</code>  为自己创建的订单对应的 <code>Appkey</code>  值，这个值可以在用户中心用户订单中查看到。蘑菇代理提供了免费的 API 代理和 HTTP 隧道代理试用，但是试用的代理接通率不能保证，建议大家还是直接购买一个在自己支付能力范围内的代理服务来体验。</p>\n</blockquote>\n<h3 id=\"简单的总结\"><a class=\"anchor\" href=\"#简单的总结\">#</a> 简单的总结</h3>\n<p>Python 语言能做的事情真的很多，就网络数据采集这一项而言，Python 几乎是一枝独秀的，大量的企业和个人都在使用 Python 从网络上获取自己需要的数据，这可能也是你将来日常工作的一部分。另外，用编写正则表达式的方式从网页中提取内容虽然可行，但是写出一个能够满足需求的正则表达式本身也不是件容易的事情，这一点对于新手来说尤为明显。在下一节课中，我们将会为大家介绍另外两种从页面中提取数据的方法，虽然从性能上来讲，它们可能不如正则表达式，但是却降低了编码的复杂性，相信大家会喜欢上它们的。</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "计算机科学",
                "Python",
                "Python基础",
                "编程笔记",
                "python"
            ]
        }
    ]
}